{"ast":null,"code":"var _jsxFileName = \"A:\\\\AI_LOGS\\\\hosting_1\\\\GIT_H3\\\\FrontendX\\\\src\\\\components\\\\admin\\\\StudentTestComponent .js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst StudentTestComponent = ({\n  testId,\n  onTestComplete,\n  socket\n}) => {\n  _s();\n  var _violations;\n  const API_URL = 'http://localhost:5000/api';\n  const [testData, setTestData] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [answers, setAnswers] = useState([]);\n  const [timeRemaining, setTimeRemaining] = useState(0);\n  const [testStatus, setTestStatus] = useState('loading');\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [violations, setViolations] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [lateJoinTime, setLateJoinTime] = useState(0);\n  const testContainerRef = useRef(null);\n  const startTimeRef = useRef(null);\n  const timerRef = useRef(null);\n  const visibilityTimeoutRef = useRef(null);\n\n  // Add CSS styles to head\n  useEffect(() => {\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = `\n      .test-container {\n        min-height: 100vh;\n        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n        display: flex;\n        flex-direction: column;\n        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n        user-select: none;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n      }\n\n      .security-bar {\n        background: linear-gradient(135deg, #dc2626, #b91c1c);\n        color: white;\n        padding: 0.75rem 1.5rem;\n        font-size: 0.875rem;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        box-shadow: 0 4px 20px rgba(220, 38, 38, 0.3);\n      }\n\n      .security-left {\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n      }\n\n      .security-right {\n        display: flex;\n        align-items: center;\n        gap: 1rem;\n      }\n\n      .security-badge {\n        padding: 0.25rem 0.75rem;\n        border-radius: 6px;\n        font-size: 0.75rem;\n        font-weight: 600;\n      }\n\n      .security-badge-blue {\n        background: rgba(59, 130, 246, 0.2);\n        border: 1px solid rgba(59, 130, 246, 0.3);\n      }\n\n      .security-badge-red {\n        background: rgba(239, 68, 68, 0.2);\n        border: 1px solid rgba(239, 68, 68, 0.3);\n      }\n\n      .header {\n        background: rgba(255, 255, 255, 0.8);\n        backdrop-filter: blur(20px);\n        border-bottom: 1px solid rgba(226, 232, 240, 0.5);\n        padding: 1.5rem 2rem;\n        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);\n      }\n\n      .header-content {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 1.5rem;\n      }\n\n      .header-title {\n        font-size: 1.5rem;\n        font-weight: 800;\n        color: #1f2937;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        margin: 0;\n        letter-spacing: -0.025em;\n      }\n\n      .header-difficulty {\n        font-size: 0.875rem;\n        font-weight: 500;\n        color: #6b7280;\n        margin-left: 0.5rem;\n      }\n\n      .header-progress {\n        color: #6b7280;\n        font-size: 0.95rem;\n        margin: 0.25rem 0 0;\n        font-weight: 500;\n      }\n\n      .timer {\n        font-size: 2rem;\n        font-weight: 800;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        margin-bottom: 0.25rem;\n      }\n\n      .timer-normal {\n        color: #3b82f6;\n      }\n\n      .timer-warning {\n        color: #f59e0b;\n      }\n\n      .timer-critical {\n        color: #ef4444;\n        animation: pulse 1s infinite;\n      }\n\n      .timer-label {\n        color: #6b7280;\n        font-size: 0.875rem;\n        margin: 0;\n        font-weight: 500;\n      }\n\n      .progress-container {\n        margin-top: 1rem;\n      }\n\n      .progress-bar {\n        width: 100%;\n        height: 8px;\n        background: linear-gradient(135deg, #e5e7eb, #d1d5db);\n        border-radius: 9999px;\n        overflow: hidden;\n      }\n\n      .progress-fill {\n        height: 100%;\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n        border-radius: 9999px;\n        transition: width 0.3s ease;\n        box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);\n      }\n\n      .content {\n        flex: 1;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 2rem;\n      }\n\n      .question-card {\n        background: rgba(255, 255, 255, 0.95);\n        backdrop-filter: blur(20px);\n        border: 1px solid rgba(226, 232, 240, 0.5);\n        border-radius: 24px;\n        padding: 3rem 2.5rem;\n        width: 100%;\n        max-width: 800px;\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);\n      }\n\n      .question-section {\n        margin-bottom: 3rem;\n      }\n\n      .question-text {\n        font-size: 2.5rem;\n        font-weight: 800;\n        color: #1f2937;\n        text-align: center;\n        margin: 0 0 3rem;\n        letter-spacing: -0.025em;\n        background: linear-gradient(135deg, #1f2937, #374151);\n        -webkit-background-clip: text;\n        -webkit-text-fill-color: transparent;\n        background-clip: text;\n      }\n\n      .answer-section {\n        width: 100%;\n      }\n\n      .options-container {\n        display: flex;\n        flex-direction: column;\n        gap: 1rem;\n      }\n\n      .option {\n        display: flex;\n        align-items: center;\n        padding: 1.25rem 1.5rem;\n        background: linear-gradient(135deg, #f8fafc, #f1f5f9);\n        border: 2px solid transparent;\n        border-radius: 16px;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        position: relative;\n        overflow: hidden;\n      }\n\n      .option:hover {\n        background: linear-gradient(135deg, #e0e7ff, #c7d2fe);\n        border-color: rgba(99, 102, 241, 0.3);\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);\n      }\n\n      .option-input {\n        margin-right: 1rem;\n        width: 1.25rem;\n        height: 1.25rem;\n        accent-color: #3b82f6;\n      }\n\n      .option-text {\n        font-size: 1.125rem;\n        font-weight: 500;\n        color: #374151;\n      }\n\n      .input-container {\n        text-align: center;\n      }\n\n      .answer-input {\n        width: 100%;\n        padding: 2rem 1.5rem;\n        font-size: 2rem;\n        font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;\n        font-weight: 600;\n        text-align: center;\n        background: linear-gradient(135deg, #ffffff, #f8fafc);\n        border: 3px solid transparent;\n        border-radius: 20px;\n        outline: none;\n        transition: all 0.3s ease;\n        color: #1f2937;\n        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);\n      }\n\n      .answer-input:focus {\n        border-color: #3b82f6;\n        background: #ffffff;\n        box-shadow: 0 12px 40px rgba(59, 130, 246, 0.2);\n        transform: translateY(-2px);\n      }\n\n      .input-hint {\n        margin: 1rem 0 0;\n        color: #6b7280;\n        font-size: 0.95rem;\n        font-weight: 500;\n      }\n\n      .navigation {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        gap: 1rem;\n      }\n\n      .nav-button {\n        padding: 0.875rem 2rem;\n        border-radius: 14px;\n        font-weight: 600;\n        font-size: 1rem;\n        border: none;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n      }\n\n      .nav-button-prev {\n        background: linear-gradient(135deg, #6b7280, #4b5563);\n        color: white;\n      }\n\n      .nav-button-prev:hover:not(:disabled) {\n        background: linear-gradient(135deg, #4b5563, #374151);\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);\n      }\n\n      .nav-button-prev:disabled {\n        opacity: 0.4;\n        cursor: not-allowed;\n        transform: none;\n      }\n\n      .nav-button-next {\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n        color: white;\n      }\n\n      .nav-button-next:hover {\n        background: linear-gradient(135deg, #2563eb, #1e40af);\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n      }\n\n      .nav-button-submit {\n        background: linear-gradient(135deg, #10b981, #047857);\n        color: white;\n      }\n\n      .nav-button-submit:hover:not(:disabled) {\n        background: linear-gradient(135deg, #059669, #065f46);\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);\n      }\n\n      .nav-button-submit:disabled {\n        opacity: 0.7;\n        cursor: not-allowed;\n        transform: none;\n      }\n\n      .submit-spinner {\n        width: 1rem;\n        height: 1rem;\n        border: 2px solid rgba(255, 255, 255, 0.3);\n        border-top: 2px solid #ffffff;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n\n      .progress-indicator {\n        color: #6b7280;\n        font-weight: 500;\n        font-size: 0.95rem;\n      }\n\n      .footer {\n        background: rgba(255, 255, 255, 0.8);\n        backdrop-filter: blur(20px);\n        border-top: 1px solid rgba(226, 232, 240, 0.5);\n        padding: 1.5rem 2rem;\n      }\n\n      .question-grid {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 0.75rem;\n        justify-content: center;\n      }\n\n      .question-number {\n        width: 3rem;\n        height: 3rem;\n        border-radius: 12px;\n        font-size: 0.95rem;\n        font-weight: 600;\n        border: 2px solid;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .question-number-current {\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n        color: white;\n        border-color: #3b82f6;\n        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);\n      }\n\n      .question-number-answered {\n        background: linear-gradient(135deg, #d1fae5, #a7f3d0);\n        color: #065f46;\n        border-color: #10b981;\n      }\n\n      .question-number-unanswered {\n        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);\n        color: #6b7280;\n        border-color: #d1d5db;\n      }\n\n      .question-number:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\n      }\n\n      .modal-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.6);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n        padding: 1rem;\n      }\n\n      .modal-card {\n        background: #ffffff;\n        border-radius: 24px;\n        padding: 2rem;\n        max-width: 500px;\n        width: 100%;\n        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);\n      }\n\n      .modal-header {\n        display: flex;\n        align-items: center;\n        gap: 1rem;\n        margin-bottom: 1.5rem;\n      }\n\n      .modal-title {\n        font-size: 1.25rem;\n        font-weight: 700;\n        color: #dc2626;\n        margin: 0;\n      }\n\n      .modal-text {\n        color: #374151;\n        line-height: 1.6;\n        margin: 0 0 1.5rem;\n      }\n\n      .violation-details {\n        background: linear-gradient(135deg, #fef2f2, #fee2e2);\n        border: 1px solid #fecaca;\n        border-radius: 12px;\n        padding: 1rem;\n        margin-bottom: 2rem;\n      }\n\n      .violation-latest {\n        color: #dc2626;\n        font-size: 0.9rem;\n        margin: 0 0 0.5rem;\n      }\n\n      .violation-count {\n        color: #b91c1c;\n        font-size: 0.9rem;\n        margin: 0 0 0.5rem;\n      }\n\n      .violation-warning {\n        color: #7f1d1d;\n        font-size: 0.9rem;\n        font-weight: 600;\n        margin: 0.5rem 0 0;\n      }\n\n      .modal-actions {\n        text-align: right;\n      }\n\n      .modal-button {\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n        color: white;\n        padding: 0.75rem 2rem;\n        border-radius: 12px;\n        font-weight: 600;\n        border: none;\n        cursor: pointer;\n        transition: all 0.3s ease;\n      }\n\n      .modal-button:hover {\n        background: linear-gradient(135deg, #2563eb, #1e40af);\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n      }\n\n      .loading-container {\n        min-height: 100vh;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n      }\n\n      .loading-content {\n        text-align: center;\n        background: rgba(255, 255, 255, 0.1);\n        backdrop-filter: blur(20px);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 20px;\n        padding: 3rem 2rem;\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\n      }\n\n      .loading-spinner {\n        width: 48px;\n        height: 48px;\n        border: 4px solid rgba(255, 255, 255, 0.3);\n        border-top: 4px solid #ffffff;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n        margin: 0 auto 1.5rem;\n      }\n\n      .loading-title {\n        font-size: 1.5rem;\n        font-weight: 600;\n        color: #ffffff;\n        margin: 0 0 0.5rem;\n        letter-spacing: -0.025em;\n      }\n\n      .loading-subtitle {\n        color: rgba(255, 255, 255, 0.8);\n        font-size: 0.95rem;\n        margin: 0;\n      }\n\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n\n      @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.7; }\n      }\n\n      @media (max-width: 768px) {\n        .header {\n          padding: 1rem 1.5rem;\n        }\n        \n        .header-content {\n          flex-direction: column;\n          gap: 1rem;\n          text-align: center;\n        }\n        \n        .question-text {\n          font-size: 1.75rem;\n        }\n        \n        .answer-input {\n          font-size: 1.5rem;\n          padding: 1.5rem 1rem;\n        }\n        \n        .navigation {\n          flex-direction: column;\n          gap: 1rem;\n        }\n        \n        .nav-button {\n          width: 100%;\n          justify-content: center;\n        }\n        \n        .question-grid {\n          gap: 0.5rem;\n        }\n        \n        .question-number {\n          width: 2.5rem;\n          height: 2.5rem;\n          font-size: 0.875rem;\n        }\n      }\n\n      @media (max-width: 480px) {\n        .content {\n          padding: 1rem;\n        }\n        \n        .question-card {\n          padding: 2rem 1.5rem;\n        }\n        \n        .security-bar {\n          padding: 0.5rem 1rem;\n          font-size: 0.8rem;\n        }\n        \n        .timer {\n          font-size: 1.5rem;\n        }\n        \n        .header-title {\n          font-size: 1.25rem;\n        }\n      }\n    `;\n    document.head.appendChild(styleSheet);\n    return () => {\n      document.head.removeChild(styleSheet);\n    };\n  }, []);\n\n  // Generate math questions based on test parameters\n  const generateQuestions = (testType, count, difficultyLevel) => {\n    const questions = [];\n    for (let i = 0; i < count; i++) {\n      let question, correctAnswer;\n      let num1, num2;\n\n      // Set difficulty ranges\n      switch (difficultyLevel) {\n        case 'easy':\n          num1 = Math.floor(Math.random() * 10) + 1;\n          num2 = Math.floor(Math.random() * 10) + 1;\n          break;\n        case 'medium':\n          num1 = Math.floor(Math.random() * 50) + 1;\n          num2 = Math.floor(Math.random() * 50) + 1;\n          break;\n        case 'double':\n          num1 = Math.floor(Math.random() * 99) + 1;\n          num2 = Math.floor(Math.random() * 99) + 1;\n          break;\n        default:\n          num1 = Math.floor(Math.random() * 20) + 1;\n          num2 = Math.floor(Math.random() * 20) + 1;\n      }\n\n      // Generate based on test type\n      switch (testType) {\n        case 'multiplication':\n          question = `${num1} √ó ${num2} = ?`;\n          correctAnswer = (num1 * num2).toString();\n          break;\n        case 'addition':\n          question = `${num1} + ${num2} = ?`;\n          correctAnswer = (num1 + num2).toString();\n          break;\n        case 'subtraction':\n          // Ensure positive result\n          if (num1 < num2) [num1, num2] = [num2, num1];\n          question = `${num1} - ${num2} = ?`;\n          correctAnswer = (num1 - num2).toString();\n          break;\n        case 'division':\n          // Ensure whole number division\n          const product = num1 * num2;\n          question = `${product} √∑ ${num1} = ?`;\n          correctAnswer = num2.toString();\n          break;\n        default:\n          question = `${num1} √ó ${num2} = ?`;\n          correctAnswer = (num1 * num2).toString();\n      }\n      questions.push({\n        question,\n        correctAnswer,\n        type: testType,\n        options: [] // Empty for math problems (text input)\n      });\n    }\n    return questions;\n  };\n\n  // Fetch test data from your existing backend\n  useEffect(() => {\n    const fetchTestData = async () => {\n      try {\n        var _testDetails$results;\n        const token = localStorage.getItem('token');\n        const deviceId = localStorage.getItem('deviceId');\n        if (!token) {\n          setTestStatus('error');\n          return;\n        }\n\n        // Fetch the test details first\n        const response = await fetch(`${API_URL}/student/tests/${testId}`, {\n          headers: {\n            'Authorization': token,\n            'X-Device-Id': deviceId,\n            'Content-Type': 'application/json'\n          }\n        });\n        if (!response.ok) {\n          if (response.status === 404) {\n            setTestStatus('no-test');\n            console.warn('Test not found or inactive');\n            return;\n          }\n          throw new Error('Failed to load test');\n        }\n        const testDetails = await response.json();\n\n        // Check if test is still active and not past end time\n        const now = new Date();\n        const testStart = new Date(testDetails.startTime);\n        const testEnd = new Date(testStart.getTime() + testDetails.duration * 60 * 1000);\n        if (now > testEnd) {\n          setTestStatus('test-ended');\n          return;\n        }\n\n        // Check if student already submitted\n        const userId = localStorage.getItem('userId') || 'anonymous';\n        const existingResult = (_testDetails$results = testDetails.results) === null || _testDetails$results === void 0 ? void 0 : _testDetails$results.find(r => r.studentId === userId);\n        if (existingResult) {\n          setTestStatus('already-submitted');\n          return;\n        }\n\n        // Calculate late join time if applicable\n        let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\n        let lateJoinSeconds = 0;\n        if (now > testStart) {\n          lateJoinSeconds = Math.floor((now - testStart) / 1000);\n          adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\n          setLateJoinTime(lateJoinSeconds);\n        }\n\n        // Generate questions if not provided\n        let questions = testDetails.questions || [];\n        if (questions.length === 0) {\n          questions = generateQuestions(testDetails.testType, testDetails.count, testDetails.difficultyLevel);\n        }\n        const processedTestData = {\n          ...testDetails,\n          questions,\n          gameType: testDetails.testType // For compatibility\n        };\n        setTestData(processedTestData);\n        setTimeRemaining(adjustedTimeRemaining);\n        setAnswers(new Array(questions.length).fill(''));\n        setTestStatus('active');\n        startTimeRef.current = Date.now();\n\n        // Notify admin via socket\n        socket === null || socket === void 0 ? void 0 : socket.emit('test-started', {\n          testId: testDetails._id,\n          studentId: userId,\n          lateJoinSeconds\n        });\n      } catch (error) {\n        console.error('Error loading test:', error);\n        setTestStatus('error');\n      }\n    };\n    if (testId) {\n      fetchTestData();\n    }\n  }, [testId, socket, API_URL]);\n\n  // Enhanced fullscreen handling\n  useEffect(() => {\n    const enterFullscreen = async () => {\n      try {\n        if (testContainerRef.current && !isFullscreen) {\n          if (testContainerRef.current.requestFullscreen) {\n            await testContainerRef.current.requestFullscreen();\n          } else if (testContainerRef.current.webkitRequestFullscreen) {\n            await testContainerRef.current.webkitRequestFullscreen();\n          } else if (testContainerRef.current.msRequestFullscreen) {\n            await testContainerRef.current.msRequestFullscreen();\n          }\n          setIsFullscreen(true);\n        }\n      } catch (error) {\n        console.warn('Fullscreen not supported:', error);\n        // Continue test even without fullscreen\n      }\n    };\n    if (testStatus === 'active' && testContainerRef.current) {\n      enterFullscreen();\n    }\n  }, [testStatus]);\n\n  // Handle fullscreen changes with stricter enforcement\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      const isCurrentlyFullscreen = Boolean(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);\n      setIsFullscreen(isCurrentlyFullscreen);\n      if (!isCurrentlyFullscreen && testStatus === 'active') {\n        addViolation('Exited fullscreen mode');\n\n        // Try to re-enter fullscreen immediately\n        if (testContainerRef.current) {\n          const enterFullscreen = async () => {\n            try {\n              if (testContainerRef.current.requestFullscreen) {\n                await testContainerRef.current.requestFullscreen();\n              } else if (testContainerRef.current.webkitRequestFullscreen) {\n                await testContainerRef.current.webkitRequestFullscreen();\n              }\n            } catch (error) {\n              // If can't re-enter after 3 violations, auto-submit\n              if (violations.length >= 2) {\n                handleAutoSubmit('Multiple fullscreen violations');\n              }\n            }\n          };\n          enterFullscreen();\n        }\n      }\n    };\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n    document.addEventListener('msfullscreenchange', handleFullscreenChange);\n    return () => {\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\n      document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\n      document.removeEventListener('msfullscreenchange', handleFullscreenChange);\n    };\n  }, [testStatus, violations]);\n\n  // Enhanced visibility handling\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden && testStatus === 'active') {\n        addViolation('Switched to another tab/window');\n\n        // Shorter timeout for tab switching - 3 seconds\n        visibilityTimeoutRef.current = setTimeout(() => {\n          if (document.hidden) {\n            handleAutoSubmit('Tab switching violation - remained hidden');\n          }\n        }, 3000);\n      } else if (!document.hidden && visibilityTimeoutRef.current) {\n        clearTimeout(visibilityTimeoutRef.current);\n        visibilityTimeoutRef.current = null;\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      if (visibilityTimeoutRef.current) {\n        clearTimeout(visibilityTimeoutRef.current);\n      }\n    };\n  }, [testStatus]);\n\n  // Enhanced browser navigation prevention\n  useEffect(() => {\n    const handleBeforeUnload = event => {\n      if (testStatus === 'active') {\n        event.preventDefault();\n        event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\n        return event.returnValue;\n      }\n    };\n    const handlePopState = event => {\n      if (testStatus === 'active') {\n        event.preventDefault();\n        window.history.pushState(null, '', window.location.pathname);\n        addViolation('Browser navigation attempt');\n        handleAutoSubmit('Navigation attempt during test');\n      }\n    };\n\n    // Push current state to prevent back navigation\n    window.history.pushState(null, '', window.location.pathname);\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    window.addEventListener('popstate', handlePopState);\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [testStatus]);\n\n  // Timer countdown with auto-submit\n  useEffect(() => {\n    if (testStatus === 'active' && timeRemaining > 0) {\n      timerRef.current = setInterval(() => {\n        setTimeRemaining(prev => {\n          if (prev <= 1) {\n            handleAutoSubmit('Time expired');\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n      return () => {\n        if (timerRef.current) {\n          clearInterval(timerRef.current);\n        }\n      };\n    }\n  }, [testStatus, timeRemaining]);\n\n  // Send progress updates to admin\n  // useEffect(() => {\n  //   if (testStatus === 'active' && socket) {\n  //     const progressInterval = setInterval(() => {\n  //       const answeredCount = answers.filter(a => a.trim() !== '').length;\n  //       const progress = (answeredCount / answers.length) * 100;\n\n  //       socket.emit('test-progress', {\n  //         testId,\n  //         studentId: localStorage.getItem('userId') || 'anonymous',\n  //         progress: Math.round(progress),\n  //         currentQuestion: currentQuestionIndex + 1,\n  //         answeredQuestions: answeredCount,\n  //         timeRemaining\n  //       });\n  //     }, 5000);\n\n  //     return () => clearInterval(progressInterval);\n  //   }\n  // }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\n\n  const addViolation = violation => {\n    setViolations(prev => {\n      const newViolations = [...prev, {\n        type: violation,\n        timestamp: new Date().toISOString()\n      }];\n\n      // Auto-submit after 3 violations\n      if (newViolations.length >= 3) {\n        setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\n      }\n      return newViolations;\n    });\n  };\n  const handleAutoSubmit = async reason => {\n    if (isSubmitting) return;\n    console.log(`Auto-submitting test: ${reason}`);\n    await submitTest(true, reason);\n  };\n  const handleAnswerChange = (questionIndex, value) => {\n    const newAnswers = [...answers];\n    newAnswers[questionIndex] = value.trim();\n    setAnswers(newAnswers);\n  };\n  const calculateScore = () => {\n    if (!testData) return {\n      correct: 0,\n      total: 0,\n      score: 0\n    };\n    let correct = 0;\n    testData.questions.forEach((question, index) => {\n      var _answers$index, _question$correctAnsw;\n      const userAnswer = (_answers$index = answers[index]) === null || _answers$index === void 0 ? void 0 : _answers$index.trim().toLowerCase();\n      const correctAnswer = (_question$correctAnsw = question.correctAnswer) === null || _question$correctAnsw === void 0 ? void 0 : _question$correctAnsw.trim().toLowerCase();\n      if (userAnswer === correctAnswer) {\n        correct++;\n      }\n    });\n    const total = testData.questions.length;\n    const score = total > 0 ? Math.round(correct / total * 100) : 0;\n    return {\n      correct,\n      total,\n      score\n    };\n  };\n\n  // const submitTest = async (isAutoSubmit = false, reason = '') => {\n  //   if (isSubmitting) return;\n\n  //   setIsSubmitting(true);\n\n  //   try {\n  //     const { correct, total, score } = calculateScore();\n  //     const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\n  //     const token = localStorage.getItem('token');\n  //     const deviceId = localStorage.getItem('deviceId');\n  //     const userId = localStorage.getItem('userId') || 'anonymous';\n\n  //     const submissionData = {\n  //       studentId: userId,\n  //       answers: answers.map((answer, index) => ({\n  //         questionIndex: index,\n  //         question: testData.questions[index].question,\n  //         userAnswer: answer,\n  //         correctAnswer: testData.questions[index].correctAnswer,\n  //         isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\n  //       })),\n  //       correctCount: correct,\n  //       totalQuestions: total,\n  //       score,\n  //       timeSpent,\n  //       lateJoinTime,\n  //       violations,\n  //       isAutoSubmit,\n  //       autoSubmitReason: reason,\n  //       submittedAt: new Date().toISOString()\n  //     };\n\n  //     const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\n  //       method: 'POST',\n  //       headers: {\n  //         'Authorization': token,\n  //         'X-Device-Id': deviceId,\n  //         'Content-Type': 'application/json'\n  //       },\n  //       body: JSON.stringify(submissionData)\n  //     });\n\n  //     if (!response.ok) {\n  //       throw new Error(`Submission failed: ${response.status}`);\n  //     }\n\n  //     // Update performance data if API exists\n  //     try {\n  //       const performanceUpdate = {\n  //         totalGames: 1,\n  //         totalCorrect: correct,\n  //         totalScore: score,\n  //         gameType: testData.testType,\n  //         difficulty: testData.difficultyLevel || 'medium',\n  //         speed: 2,\n  //         count: total\n  //       };\n\n  //       await fetch(`${API_URL}/performance/${userId}`, {\n  //         method: 'POST',\n  //         headers: {\n  //           'Authorization': token,\n  //           'X-Device-Id': deviceId,\n  //           'Content-Type': 'application/json'\n  //         },\n  //         body: JSON.stringify(performanceUpdate)\n  //       });\n  //     } catch (perfError) {\n  //       console.warn('Performance update failed:', perfError);\n  //       // Continue even if performance update fails\n  //     }\n\n  //     // Notify admin via socket\n  //     socket?.emit('test-submitted', {\n  //       testId,\n  //       studentId: userId,\n  //       score,\n  //       correctCount: correct,\n  //       totalQuestions: total,\n  //       isAutoSubmit,\n  //       reason,\n  //       timeSpent,\n  //       violations: violations.length\n  //     });\n\n  //     setTestStatus('submitted');\n\n  //     // Exit fullscreen\n  //     if (document.fullscreenElement) {\n  //       document.exitFullscreen();\n  //     } else if (document.webkitFullscreenElement) {\n  //       document.webkitExitFullscreen();\n  //     } else if (document.msExitFullscreen) {\n  //       document.msExitFullscreen();\n  //     }\n\n  //     // Call completion callback\n  //     onTestComplete?.({\n  //       score,\n  //       correct,\n  //       total,\n  //       isAutoSubmit,\n  //       reason,\n  //       timeSpent,\n  //       violations: violations.length\n  //     });\n\n  //   } catch (error) {\n  //     console.error('Error submitting test:', error);\n\n  //     // Fallback: save to localStorage\n  //     try {\n  //       const { correct, total, score } = calculateScore();\n  //       const fallbackData = {\n  //         testId,\n  //         score,\n  //         correct,\n  //         total,\n  //         submittedAt: new Date().toISOString(),\n  //         isAutoSubmit,\n  //         reason\n  //       };\n\n  //       const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\n  //       existingFallbacks.push(fallbackData);\n  //       localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\n\n  //       console.log('Test saved to localStorage as fallback');\n  //     } catch (localError) {\n  //       console.error('Error saving fallback:', localError);\n  //     }\n\n  //     setTestStatus('error');\n  //   } finally {\n  //     setIsSubmitting(false);\n  //   }\n  // };\n\n  // ‚úÖ FIXED: Test submission with retry logic and better error handling\n  const submitTest = async (isAutoSubmit = false, reason = '') => {\n    if (isSubmitting) return;\n    setIsSubmitting(true);\n    try {\n      var _lastError;\n      const {\n        correct,\n        total,\n        score\n      } = calculateScore();\n      const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\n      const token = localStorage.getItem('token');\n      const deviceId = localStorage.getItem('deviceId');\n      const userId = localStorage.getItem('userId') || 'anonymous';\n      console.log('üì§ Submitting test:', {\n        testId,\n        score,\n        correctCount: correct,\n        timeSpent\n      });\n\n      // ‚úÖ Prepare minimal submission data\n      const submissionData = {\n        studentId: userId,\n        answers: answers.map((answer, index) => ({\n          questionIndex: index,\n          question: testData.questions[index].question,\n          userAnswer: answer,\n          correctAnswer: testData.questions[index].correctAnswer,\n          isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\n        })),\n        correctCount: correct,\n        totalQuestions: total,\n        score,\n        timeSpent,\n        lateJoinTime,\n        violations,\n        isAutoSubmit,\n        autoSubmitReason: reason,\n        submittedAt: new Date().toISOString()\n      };\n\n      // ‚úÖ Retry logic with exponential backoff\n      let attempt = 0;\n      const maxAttempts = 3;\n      let lastError = null;\n      while (attempt < maxAttempts) {\n        try {\n          console.log(`üîÑ Submission attempt ${attempt + 1}/${maxAttempts}`);\n\n          // ‚úÖ Create AbortController for timeout\n          const controller = new AbortController();\n          const timeoutId = setTimeout(() => controller.abort(), 20000); // 20 second timeout\n\n          const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\n            method: 'POST',\n            headers: {\n              'Authorization': token,\n              'X-Device-Id': deviceId,\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(submissionData),\n            signal: controller.signal\n          });\n          clearTimeout(timeoutId);\n          if (!response.ok) {\n            const errorData = await response.json().catch(() => ({}));\n            throw new Error(errorData.message || `Submission failed: ${response.status}`);\n          }\n          const result = await response.json();\n          console.log('‚úÖ Test submitted successfully:', result);\n\n          // ‚úÖ Success - notify admin via socket\n          socket === null || socket === void 0 ? void 0 : socket.emit('test-submitted', {\n            testId,\n            studentId: userId,\n            score,\n            correctCount: correct,\n            totalQuestions: total,\n            isAutoSubmit,\n            reason,\n            timeSpent,\n            violations: violations.length\n          });\n          setTestStatus('submitted');\n\n          // Exit fullscreen\n          try {\n            if (document.fullscreenElement) {\n              await document.exitFullscreen();\n            } else if (document.webkitFullscreenElement) {\n              await document.webkitExitFullscreen();\n            }\n          } catch (fsError) {\n            console.warn('Fullscreen exit error:', fsError);\n          }\n\n          // Call completion callback\n          onTestComplete === null || onTestComplete === void 0 ? void 0 : onTestComplete({\n            score,\n            correct,\n            total,\n            isAutoSubmit,\n            reason,\n            timeSpent,\n            violations: violations.length\n          });\n          return; // Success - exit function\n        } catch (fetchError) {\n          lastError = fetchError;\n          console.error(`‚ùå Attempt ${attempt + 1} failed:`, fetchError.message);\n          if (fetchError.name === 'AbortError') {\n            console.log('‚è±Ô∏è Request timed out');\n          }\n\n          // Don't retry on certain errors\n          if (fetchError.message.includes('already submitted')) {\n            console.log('‚ö†Ô∏è Test already submitted - treating as success');\n            setTestStatus('submitted');\n            onTestComplete === null || onTestComplete === void 0 ? void 0 : onTestComplete({\n              score,\n              correct,\n              total,\n              isAutoSubmit,\n              reason,\n              timeSpent,\n              violations: violations.length\n            });\n            return;\n          }\n          attempt++;\n          if (attempt < maxAttempts) {\n            // Exponential backoff: 1s, 2s, 4s\n            const delay = Math.pow(2, attempt) * 1000;\n            console.log(`‚è≥ Waiting ${delay}ms before retry...`);\n            await new Promise(resolve => setTimeout(resolve, delay));\n          }\n        }\n      }\n\n      // ‚úÖ All retries failed - save to localStorage as fallback\n      throw new Error(((_lastError = lastError) === null || _lastError === void 0 ? void 0 : _lastError.message) || 'Max retries exceeded');\n    } catch (error) {\n      console.error('‚ùå Final submission error:', error);\n\n      // ‚úÖ Fallback: Save to localStorage\n      try {\n        const {\n          correct,\n          total,\n          score\n        } = calculateScore();\n        const fallbackData = {\n          testId,\n          studentId: localStorage.getItem('userId'),\n          score,\n          correctCount: correct,\n          totalQuestions: total,\n          answers: answers.map((answer, index) => ({\n            question: testData.questions[index].question,\n            userAnswer: answer,\n            correctAnswer: testData.questions[index].correctAnswer\n          })),\n          submittedAt: new Date().toISOString(),\n          isAutoSubmit,\n          reason,\n          timeSpent: Math.round((Date.now() - startTimeRef.current) / 1000),\n          violations,\n          status: 'pending-sync'\n        };\n        const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\n        existingFallbacks.push(fallbackData);\n        localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\n        console.log('üíæ Test saved to localStorage as fallback');\n\n        // Show user-friendly message\n        alert('Test saved locally!\\n\\n' + 'Your answers have been saved on this device. ' + 'Please inform your teacher about this submission.\\n\\n' + `Score: ${score}% (${correct}/${total} correct)`);\n        setTestStatus('submitted');\n        onTestComplete === null || onTestComplete === void 0 ? void 0 : onTestComplete({\n          score,\n          correct,\n          total,\n          isAutoSubmit,\n          reason,\n          timeSpent: fallbackData.timeSpent,\n          violations: violations.length\n        });\n      } catch (localError) {\n        console.error('‚ùå Error saving fallback:', localError);\n        setTestStatus('error');\n      }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  const formatTime = seconds => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Enhanced keyboard and mouse prevention\n  useEffect(() => {\n    const preventContextMenu = e => {\n      if (testStatus === 'active') {\n        e.preventDefault();\n        addViolation('Right-click attempt');\n        return false;\n      }\n    };\n    const preventKeyboardShortcuts = e => {\n      if (testStatus === 'active') {\n        // Prevent common shortcuts\n        if (e.ctrlKey || e.metaKey || e.altKey) {\n          e.preventDefault();\n          addViolation('Keyboard shortcut attempt');\n          return false;\n        }\n\n        // Prevent function keys\n        if (e.key.startsWith('F') && e.key.length > 1) {\n          e.preventDefault();\n          addViolation('Function key attempt');\n          return false;\n        }\n      }\n    };\n    const preventSelection = e => {\n      if (testStatus === 'active') {\n        e.preventDefault();\n        return false;\n      }\n    };\n    document.addEventListener('contextmenu', preventContextMenu);\n    document.addEventListener('keydown', preventKeyboardShortcuts);\n    document.addEventListener('selectstart', preventSelection);\n    document.addEventListener('dragstart', preventSelection);\n    return () => {\n      document.removeEventListener('contextmenu', preventContextMenu);\n      document.removeEventListener('keydown', preventKeyboardShortcuts);\n      document.removeEventListener('selectstart', preventSelection);\n      document.removeEventListener('dragstart', preventSelection);\n    };\n  }, [testStatus]);\n\n  // Status screens\n  if (testStatus === 'loading') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1394,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"loading-title\",\n          children: \"Loading Test...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1395,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"loading-subtitle\",\n          children: \"Preparing your exam questions\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1396,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1393,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1392,\n      columnNumber: 7\n    }, this);\n  }\n  if (testStatus === 'no-test') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(255, 255, 255, 0.3)',\n          borderRadius: '24px',\n          padding: '3rem 2rem',\n          maxWidth: '400px',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Clock, {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            color: '#3b82f6',\n            margin: '0 auto 1.5rem',\n            display: 'block'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1406,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#1f2937',\n            margin: '0 0 0.75rem',\n            letterSpacing: '-0.025em'\n          },\n          children: \"Test Not Found\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1407,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem',\n            lineHeight: 1.6\n          },\n          children: \"The requested test could not be found or is not available.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1408,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => window.history.back(),\n          style: {\n            padding: '0.75rem 2rem',\n            borderRadius: '12px',\n            fontWeight: 600,\n            fontSize: '0.95rem',\n            border: 'none',\n            cursor: 'pointer',\n            transition: 'all 0.2s',\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\n            color: 'white'\n          },\n          children: \"Go Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1409,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1405,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1404,\n      columnNumber: 7\n    }, this);\n  }\n  if (testStatus === 'test-ended') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(255, 255, 255, 0.3)',\n          borderRadius: '24px',\n          padding: '3rem 2rem',\n          maxWidth: '400px',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            color: '#f59e0b',\n            margin: '0 auto 1.5rem',\n            display: 'block'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1421,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#1f2937',\n            margin: '0 0 0.75rem',\n            letterSpacing: '-0.025em'\n          },\n          children: \"Test Time Expired\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1422,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem',\n            lineHeight: 1.6\n          },\n          children: \"The time limit for this test has already passed.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1423,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => window.history.back(),\n          style: {\n            padding: '0.75rem 2rem',\n            borderRadius: '12px',\n            fontWeight: 600,\n            fontSize: '0.95rem',\n            border: 'none',\n            cursor: 'pointer',\n            transition: 'all 0.2s',\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\n            color: 'white'\n          },\n          children: \"Go Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1424,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1420,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1419,\n      columnNumber: 7\n    }, this);\n  }\n  if (testStatus === 'already-submitted') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #10b981 0%, #047857 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(255, 255, 255, 0.3)',\n          borderRadius: '24px',\n          padding: '3rem 2rem',\n          maxWidth: '400px',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Send, {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            color: '#10b981',\n            margin: '0 auto 1.5rem',\n            display: 'block'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1436,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#1f2937',\n            margin: '0 0 0.75rem',\n            letterSpacing: '-0.025em'\n          },\n          children: \"Test Already Submitted\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1437,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem',\n            lineHeight: 1.6\n          },\n          children: \"You have already completed this test successfully.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1438,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => window.history.back(),\n          style: {\n            padding: '0.75rem 2rem',\n            borderRadius: '12px',\n            fontWeight: 600,\n            fontSize: '0.95rem',\n            border: 'none',\n            cursor: 'pointer',\n            transition: 'all 0.2s',\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\n            color: 'white'\n          },\n          children: \"Go Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1439,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1435,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1434,\n      columnNumber: 7\n    }, this);\n  }\n  if (testStatus === 'error') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n        padding: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(255, 255, 255, 0.3)',\n          borderRadius: '24px',\n          padding: '3rem 2rem',\n          maxWidth: '400px',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            color: '#ef4444',\n            margin: '0 auto 1.5rem',\n            display: 'block'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1451,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#dc2626',\n            margin: '0 0 0.75rem',\n            letterSpacing: '-0.025em'\n          },\n          children: \"Test Error\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1452,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem',\n            lineHeight: 1.6\n          },\n          children: \"Unable to load or submit the test. Please contact your teacher.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1453,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '0.75rem',\n            justifyContent: 'center',\n            flexWrap: 'wrap'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => window.location.reload(),\n            style: {\n              padding: '0.75rem 1.5rem',\n              borderRadius: '10px',\n              fontWeight: 600,\n              border: 'none',\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n              background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n              color: 'white'\n            },\n            children: \"Try Again\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1455,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => window.history.back(),\n            style: {\n              padding: '0.75rem 1.5rem',\n              borderRadius: '10px',\n              fontWeight: 600,\n              border: '1px solid rgba(107, 114, 128, 0.3)',\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n              background: 'rgba(107, 114, 128, 0.1)',\n              color: '#374151'\n            },\n            children: \"Go Back\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1458,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1454,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1450,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1449,\n      columnNumber: 7\n    }, this);\n  }\n  if (testStatus === 'submitted') {\n    const {\n      correct,\n      total,\n      score\n    } = calculateScore();\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #10b981 0%, #047857 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n        padding: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(255, 255, 255, 0.3)',\n          borderRadius: '24px',\n          padding: '3rem 2rem',\n          maxWidth: '400px',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            borderRadius: '50%',\n            background: 'rgba(0, 0, 0, 0.1)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            margin: '0 auto 2rem'\n          },\n          children: /*#__PURE__*/_jsxDEV(Send, {\n            style: {\n              color: '#10b981',\n              width: '2rem',\n              height: '2rem'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1474,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1473,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#1f2937',\n            margin: '0 0 1rem'\n          },\n          children: \"Test Submitted Successfully!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1476,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem'\n          },\n          children: \"Your test has been submitted and saved.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1477,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(0, 0, 0, 0.05)',\n            borderRadius: '12px',\n            padding: '1rem',\n            margin: '0 0 1.5rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '2rem',\n              fontWeight: 600,\n              color: '#10b981',\n              marginBottom: '0.5rem'\n            },\n            children: [score, \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1480,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '0.875rem',\n              color: '#6b7280'\n            },\n            children: [correct, \" out of \", total, \" questions correct\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1481,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1479,\n          columnNumber: 11\n        }, this), lateJoinTime > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(59, 130, 246, 0.1)',\n            border: '1px solid rgba(59, 130, 246, 0.3)',\n            borderRadius: '8px',\n            padding: '0.75rem',\n            margin: '0 0 1rem'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              fontSize: '0.875rem',\n              color: '#1e40af',\n              margin: 0\n            },\n            children: [\"You joined \", Math.floor(lateJoinTime / 60), \":\", (lateJoinTime % 60).toString().padStart(2, '0'), \" late\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1488,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1487,\n          columnNumber: 13\n        }, this), violations.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(245, 158, 11, 0.1)',\n            border: '1px solid rgba(245, 158, 11, 0.3)',\n            borderRadius: '8px',\n            padding: '0.75rem',\n            margin: '0 0 1rem'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              fontSize: '0.875rem',\n              color: '#92400e',\n              margin: 0\n            },\n            children: [violations.length, \" violation\", violations.length > 1 ? 's' : '', \" recorded\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1496,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1495,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => window.history.back(),\n          style: {\n            background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n            color: 'white',\n            padding: '0.75rem 2rem',\n            borderRadius: '12px',\n            fontWeight: 600,\n            border: 'none',\n            cursor: 'pointer',\n            transition: 'all 0.3s'\n          },\n          children: \"Return to Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1502,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1472,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1471,\n      columnNumber: 7\n    }, this);\n  }\n  if (!testData) return null;\n  const currentQuestion = testData.questions[currentQuestionIndex];\n  const progress = (currentQuestionIndex + 1) / testData.questions.length * 100;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: testContainerRef,\n    className: \"test-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"security-bar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"security-left\",\n        children: [/*#__PURE__*/_jsxDEV(Lock, {\n          style: {\n            width: '1rem',\n            height: '1rem'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1523,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontWeight: 500\n          },\n          children: \"EXAM MODE - Do not close window, switch tabs, or use keyboard shortcuts\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1524,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1522,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"security-right\",\n        children: [lateJoinTime > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"security-badge security-badge-blue\",\n          children: [\"Late: +\", Math.floor(lateJoinTime / 60), \":\", (lateJoinTime % 60).toString().padStart(2, '0')]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1528,\n          columnNumber: 13\n        }, this), violations.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"security-badge security-badge-red\",\n          children: [violations.length, \" violation(s)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1533,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1526,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1521,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"header-title\",\n            children: [/*#__PURE__*/_jsxDEV(Calculator, {\n              style: {\n                width: '1.25rem',\n                height: '1.25rem',\n                color: '#3b82f6'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1545,\n              columnNumber: 15\n            }, this), testData.testType.charAt(0).toUpperCase() + testData.testType.slice(1), \" Test\", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"header-difficulty\",\n              children: [\"(\", testData.difficultyLevel, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1547,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1544,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"header-progress\",\n            children: [\"Question \", currentQuestionIndex + 1, \" of \", testData.questions.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1551,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1543,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'right'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `timer ${timeRemaining < 60 ? 'timer-critical' : timeRemaining < 300 ? 'timer-warning' : 'timer-normal'}`,\n            children: [/*#__PURE__*/_jsxDEV(Clock, {\n              style: {\n                width: '1.5rem',\n                height: '1.5rem'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1561,\n              columnNumber: 15\n            }, this), formatTime(timeRemaining)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1557,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"timer-label\",\n            children: \"Time remaining\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1564,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1556,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1542,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-container\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-bar\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"progress-fill\",\n            style: {\n              width: `${progress}%`\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1571,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1570,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1569,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1541,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"question-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"question-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"question-text\",\n            children: currentQuestion.question\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1583,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"answer-section\",\n            children: currentQuestion.options && currentQuestion.options.length > 0 ?\n            /*#__PURE__*/\n            // Multiple choice\n            _jsxDEV(\"div\", {\n              className: \"options-container\",\n              children: currentQuestion.options.map((option, index) => /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"option\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"radio\",\n                  name: `question-${currentQuestionIndex}`,\n                  value: option,\n                  checked: answers[currentQuestionIndex] === option,\n                  onChange: e => handleAnswerChange(currentQuestionIndex, e.target.value),\n                  className: \"option-input\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1597,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"option-text\",\n                  children: option\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1605,\n                  columnNumber: 23\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1593,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1591,\n              columnNumber: 17\n            }, this) :\n            /*#__PURE__*/\n            // Text input for math problems\n            _jsxDEV(\"div\", {\n              className: \"input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: answers[currentQuestionIndex],\n                onChange: e => handleAnswerChange(currentQuestionIndex, e.target.value),\n                className: \"answer-input\",\n                placeholder: \"Enter your answer\",\n                autoFocus: true,\n                onKeyPress: e => {\n                  // Allow only numbers and basic math symbols\n                  const allowedChars = /[0-9\\-+.]/;\n                  if (!allowedChars.test(e.key) && e.key !== 'Backspace' && e.key !== 'Enter') {\n                    e.preventDefault();\n                  }\n                  // Submit on Enter if it's the last question\n                  if (e.key === 'Enter' && currentQuestionIndex === testData.questions.length - 1) {\n                    submitTest(false);\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1612,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"input-hint\",\n                children: \"Enter numbers only. Press Enter to move to next question.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1631,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1611,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1588,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1582,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"navigation\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setCurrentQuestionIndex(Math.max(0, currentQuestionIndex - 1)),\n            disabled: currentQuestionIndex === 0,\n            className: `nav-button nav-button-prev ${currentQuestionIndex === 0 ? '' : ''}`,\n            children: \"Previous\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1641,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"progress-indicator\",\n            children: [answers.filter(a => a.trim() !== '').length, \" of \", testData.questions.length, \" answered\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1649,\n            columnNumber: 13\n          }, this), currentQuestionIndex < testData.questions.length - 1 ? /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setCurrentQuestionIndex(currentQuestionIndex + 1),\n            className: \"nav-button nav-button-next\",\n            children: \"Next\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1654,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => submitTest(false),\n            disabled: isSubmitting,\n            className: \"nav-button nav-button-submit\",\n            children: isSubmitting ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"submit-spinner\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1668,\n                columnNumber: 21\n              }, this), \"Submitting...\"]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Send, {\n                style: {\n                  width: '1rem',\n                  height: '1rem'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1673,\n                columnNumber: 21\n              }, this), \"Submit Test\"]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1661,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1640,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1581,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1580,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"footer\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"question-grid\",\n        children: testData.questions.map((_, index) => {\n          var _answers$index2;\n          return /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setCurrentQuestionIndex(index),\n            className: `question-number ${index === currentQuestionIndex ? 'question-number-current' : (_answers$index2 = answers[index]) !== null && _answers$index2 !== void 0 && _answers$index2.trim() ? 'question-number-answered' : 'question-number-unanswered'}`,\n            children: index + 1\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1687,\n            columnNumber: 13\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1685,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1684,\n      columnNumber: 7\n    }, this), violations.length > 0 && violations.length % 2 === 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-header\",\n          children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n            style: {\n              width: '2rem',\n              height: '2rem',\n              color: '#ef4444'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1709,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"modal-title\",\n            children: \"Security Violation Detected\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1710,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1708,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"modal-text\",\n          children: \"You have attempted to leave the test environment or use prohibited features. This violation has been recorded.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1712,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"violation-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"violation-latest\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Latest Violation:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1718,\n              columnNumber: 17\n            }, this), \" \", (_violations = violations[violations.length - 1]) === null || _violations === void 0 ? void 0 : _violations.type]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1717,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"violation-count\",\n            children: [\"Total violations: \", violations.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1720,\n            columnNumber: 15\n          }, this), violations.length >= 2 && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"violation-warning\",\n            children: \"Warning: One more violation will auto-submit your test!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1724,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1716,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-actions\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              // Modal will auto-close, violation is already recorded\n            },\n            className: \"modal-button\",\n            children: \"Continue Test\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1730,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1729,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1707,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1706,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1516,\n    columnNumber: 5\n  }, this);\n};\n_s(StudentTestComponent, \"KTbol++3NCTC0m79gzC2LsX0OjQ=\");\n_c = StudentTestComponent;\nconst TestContainer = ({\n  studentId,\n  socket\n}) => {\n  _s2();\n  const API_URL = 'http://localhost:5000/api';\n  const [activeTest, setActiveTest] = useState(null);\n  const [showTest, setShowTest] = useState(false);\n  const [testResult, setTestResult] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Check for active tests using your existing API structure\n  useEffect(() => {\n    const checkForActiveTests = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const token = localStorage.getItem('token');\n        const deviceId = localStorage.getItem('deviceId');\n        if (!token) {\n          console.log('No token found');\n          setError('No authentication token found. Please log in again.');\n          setLoading(false);\n          return;\n        }\n        console.log('Checking for active tests...');\n        console.log('Token:', token ? 'Present' : 'Missing');\n        console.log('Device ID:', deviceId);\n\n        // Check for active tests that target this student\n        const response = await fetch(`${API_URL}/student/tests/active`, {\n          method: 'GET',\n          headers: {\n            'Authorization': token,\n            'X-Device-Id': deviceId,\n            'Content-Type': 'application/json'\n          }\n        });\n        console.log('Response status:', response.status);\n        if (!response.ok) {\n          if (response.status === 401) {\n            setError('Authentication failed. Please log in again.');\n            return;\n          } else if (response.status === 403) {\n            setError('Access denied. Please contact your teacher.');\n            return;\n          }\n          throw new Error(`Failed to fetch tests: ${response.status}`);\n        }\n        const tests = await response.json();\n        console.log('Received tests:', tests);\n        if (tests && tests.length > 0) {\n          // Filter tests that are actually active and not expired\n          const currentTime = new Date();\n          const availableTests = tests.filter(test => {\n            const testStart = new Date(test.startTime);\n            const testEnd = new Date(testStart.getTime() + test.duration * 60 * 1000);\n            console.log('Test:', test._id);\n            console.log('Current time:', currentTime);\n            console.log('Test start:', testStart);\n            console.log('Test end:', testEnd);\n            console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\n            return currentTime >= testStart && currentTime < testEnd;\n          });\n          if (availableTests.length > 0) {\n            console.log('Setting active test:', availableTests[0]);\n            setActiveTest(availableTests[0]);\n          } else {\n            console.log('No available tests (all expired or not yet started)');\n          }\n        } else {\n          console.log('No tests found');\n        }\n      } catch (error) {\n        console.error('Error checking for active tests:', error);\n        setError(`Error loading tests: ${error.message}`);\n      } finally {\n        setLoading(false);\n      }\n    };\n    checkForActiveTests();\n\n    // Check every 30 seconds for new tests\n    // const interval = setInterval(checkForActiveTests, 30000);\n    // return () => clearInterval(interval);\n  }, [API_URL]);\n\n  // Listen for test events from admin (if socket is available)\n  useEffect(() => {\n    if (socket) {\n      const handleTestLaunched = testData => {\n        console.log('Test launched event received:', testData);\n        setActiveTest(testData);\n      };\n      const handleTestEnded = data => {\n        console.log('Test ended event received:', data);\n        if (activeTest && activeTest._id === data.testId) {\n          setActiveTest(null);\n          setShowTest(false);\n        }\n      };\n      socket.on('test-launched', handleTestLaunched);\n      socket.on('test-ended', handleTestEnded);\n      return () => {\n        socket.off('test-launched', handleTestLaunched);\n        socket.off('test-ended', handleTestEnded);\n      };\n    }\n  }, [socket, activeTest]);\n  const handleStartTest = () => {\n    console.log('Starting test:', activeTest);\n    setShowTest(true);\n  };\n  const handleTestComplete = result => {\n    console.log('Test completed:', result);\n    setTestResult(result);\n    setShowTest(false);\n    setActiveTest(null);\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          background: 'rgba(255, 255, 255, 0.8)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(226, 232, 240, 0.5)',\n          borderRadius: '20px',\n          padding: '2rem',\n          boxShadow: '0 10px 40px rgba(0, 0, 0, 0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '32px',\n            height: '32px',\n            border: '3px solid rgba(59, 130, 246, 0.3)',\n            borderTop: '3px solid #3b82f6',\n            borderRadius: '50%',\n            animation: 'spin 1s linear infinite',\n            margin: '0 auto 1rem'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1883,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#374151',\n            fontWeight: 500,\n            margin: '0 0 0.25rem'\n          },\n          children: \"Checking for active tests...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1884,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#9ca3af',\n            fontSize: '0.875rem',\n            margin: 0\n          },\n          children: \"This may take a moment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1885,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1882,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1881,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n        padding: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(254, 202, 202, 0.5)',\n          borderRadius: '20px',\n          padding: '2rem',\n          textAlign: 'center',\n          maxWidth: '400px',\n          boxShadow: '0 10px 40px rgba(239, 68, 68, 0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n          style: {\n            width: '3rem',\n            height: '3rem',\n            color: '#ef4444',\n            margin: '0 auto 1rem'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1895,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.5rem',\n            fontWeight: 700,\n            color: '#dc2626',\n            margin: '0 0 0.5rem'\n          },\n          children: \"Error\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1896,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 2rem',\n            lineHeight: 1.5\n          },\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1897,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '0.75rem',\n            justifyContent: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => window.location.reload(),\n            style: {\n              padding: '0.75rem 1.5rem',\n              borderRadius: '10px',\n              fontWeight: 600,\n              border: 'none',\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n              background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n              color: 'white'\n            },\n            children: \"Retry\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1899,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setError(null),\n            style: {\n              padding: '0.75rem 1.5rem',\n              borderRadius: '10px',\n              fontWeight: 600,\n              border: '1px solid rgba(107, 114, 128, 0.3)',\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n              background: 'rgba(107, 114, 128, 0.1)',\n              color: '#374151'\n            },\n            children: \"Dismiss\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1905,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1898,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1894,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1893,\n      columnNumber: 7\n    }, this);\n  }\n  if (showTest && activeTest) {\n    return /*#__PURE__*/_jsxDEV(StudentTestComponent, {\n      testId: activeTest._id || activeTest.id,\n      onTestComplete: handleTestComplete,\n      socket: socket\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1919,\n      columnNumber: 7\n    }, this);\n  }\n  if (testResult) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #dcfdf7 0%, #a7f3d0 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n        padding: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(167, 243, 208, 0.5)',\n          borderRadius: '20px',\n          padding: '2rem',\n          textAlign: 'center',\n          maxWidth: '400px',\n          boxShadow: '0 10px 40px rgba(16, 185, 129, 0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.75rem',\n            fontWeight: 700,\n            color: '#065f46',\n            margin: '0 0 1rem'\n          },\n          children: \"Test Complete!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1931,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '3rem',\n            fontWeight: 800,\n            background: 'linear-gradient(135deg, #059669, #047857)',\n            WebkitBackgroundClip: 'text',\n            WebkitTextFillColor: 'transparent',\n            backgroundClip: 'text',\n            margin: '0 0 0.5rem'\n          },\n          children: [testResult.score, \"%\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1932,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 1.5rem'\n          },\n          children: [\"You answered \", testResult.correct, \" out of \", testResult.total, \" questions correctly.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1935,\n          columnNumber: 11\n        }, this), testResult.isAutoSubmit && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            borderRadius: '10px',\n            padding: '0.75rem',\n            margin: '0 0 1rem',\n            border: '1px solid rgba(245, 158, 11, 0.3)',\n            background: 'rgba(245, 158, 11, 0.1)'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              margin: 0,\n              fontSize: '0.875rem',\n              fontWeight: 500,\n              color: '#92400e'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Note:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1941,\n              columnNumber: 17\n            }, this), \" Test was auto-submitted due to: \", testResult.reason]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1940,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1939,\n          columnNumber: 13\n        }, this), testResult.violations > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            borderRadius: '10px',\n            padding: '0.75rem',\n            margin: '0 0 1rem',\n            border: '1px solid rgba(239, 68, 68, 0.3)',\n            background: 'rgba(239, 68, 68, 0.1)'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              margin: 0,\n              fontSize: '0.875rem',\n              fontWeight: 500,\n              color: '#b91c1c'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Security Violations:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1948,\n              columnNumber: 17\n            }, this), \" \", testResult.violations, \" recorded\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1947,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1946,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setTestResult(null),\n          style: {\n            background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n            color: 'white',\n            padding: '0.875rem 2rem',\n            borderRadius: '12px',\n            fontWeight: 600,\n            border: 'none',\n            cursor: 'pointer',\n            transition: 'all 0.3s'\n          },\n          children: \"Continue\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1952,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1930,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1929,\n      columnNumber: 7\n    }, this);\n  }\n  if (activeTest) {\n    const now = new Date();\n    const testStart = new Date(activeTest.startTime);\n    const testEnd = new Date(testStart.getTime() + activeTest.duration * 60 * 1000);\n    const isTestTime = now >= testStart && now < testEnd;\n    const isTestOver = now >= testEnd;\n    console.log('Active test found:', {\n      testId: activeTest._id,\n      now: now.toISOString(),\n      start: testStart.toISOString(),\n      end: testEnd.toISOString(),\n      isTestTime,\n      isTestOver\n    });\n    if (isTestOver) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          minHeight: '100vh',\n          background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n          padding: '1rem'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(255, 255, 255, 0.95)',\n            backdropFilter: 'blur(20px)',\n            border: '1px solid rgba(253, 230, 138, 0.5)',\n            borderRadius: '20px',\n            padding: '2rem',\n            textAlign: 'center',\n            maxWidth: '400px',\n            boxShadow: '0 10px 40px rgba(245, 158, 11, 0.1)'\n          },\n          children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n            style: {\n              width: '4rem',\n              height: '4rem',\n              color: '#f59e0b',\n              margin: '0 auto 1rem'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1983,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n            style: {\n              fontSize: '1.5rem',\n              fontWeight: 700,\n              color: '#92400e',\n              margin: '0 0 0.5rem'\n            },\n            children: \"Test Expired\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1984,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: '#6b7280',\n              margin: '0 0 2rem'\n            },\n            children: \"The time limit for this test has passed.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1985,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setActiveTest(null),\n            style: {\n              background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n              color: 'white',\n              padding: '0.75rem 2rem',\n              borderRadius: '12px',\n              fontWeight: 600,\n              border: 'none',\n              cursor: 'pointer',\n              transition: 'all 0.3s'\n            },\n            children: \"Continue\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1986,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1982,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1981,\n        columnNumber: 9\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minHeight: '100vh',\n        background: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n        padding: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: 'rgba(255, 255, 255, 0.95)',\n          backdropFilter: 'blur(20px)',\n          border: '1px solid rgba(191, 219, 254, 0.5)',\n          borderRadius: '20px',\n          padding: '2rem',\n          textAlign: 'center',\n          maxWidth: '500px',\n          boxShadow: '0 10px 40px rgba(59, 130, 246, 0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '4rem',\n            height: '4rem',\n            background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n            borderRadius: '50%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            margin: '0 auto 1rem',\n            boxShadow: '0 8px 25px rgba(59, 130, 246, 0.3)'\n          },\n          children: /*#__PURE__*/_jsxDEV(Calculator, {\n            style: {\n              width: '2rem',\n              height: '2rem',\n              color: 'white'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2001,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2000,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            fontSize: '1.75rem',\n            fontWeight: 700,\n            color: '#1e40af',\n            margin: '0 0 0.5rem'\n          },\n          children: \"Test Available\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2003,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0 0 0.5rem'\n          },\n          children: [activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1), \" \\u2022 \", activeTest.duration, \" minutes \\u2022 \", activeTest.count, \" questions\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2004,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#9ca3af',\n            fontSize: '0.875rem',\n            margin: '0 0 1.5rem'\n          },\n          children: [\"Difficulty: \", activeTest.difficultyLevel]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2007,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'linear-gradient(135deg, #eff6ff, #dbeafe)',\n            border: '1px solid rgba(147, 197, 253, 0.3)',\n            borderRadius: '12px',\n            padding: '1rem',\n            margin: '0 0 1.5rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: '#1e40af',\n              fontSize: '0.875rem',\n              margin: '0 0 0.25rem'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Test ID:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2013,\n              columnNumber: 15\n            }, this), \" \", activeTest._id]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2012,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: '#1e40af',\n              fontSize: '0.875rem',\n              margin: '0'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Started:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2016,\n              columnNumber: 15\n            }, this), \" \", testStart.toLocaleString()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2015,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2011,\n          columnNumber: 11\n        }, this), isTestTime ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: '#6b7280',\n              fontSize: '0.95rem',\n              margin: '0 0 1rem',\n              lineHeight: 1.5\n            },\n            children: \"Click below to start your test. Ensure you're in a quiet environment with stable internet.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2022,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              background: 'linear-gradient(135deg, #fef3c7, #fde68a)',\n              border: '1px solid rgba(245, 158, 11, 0.3)',\n              borderRadius: '12px',\n              padding: '0.75rem',\n              margin: '0 0 1.5rem'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                color: '#92400e',\n                fontSize: '0.875rem',\n                margin: 0\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Important:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2027,\n                columnNumber: 19\n              }, this), \" Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2026,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2025,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleStartTest,\n            style: {\n              background: 'linear-gradient(135deg, #10b981, #047857)',\n              color: 'white',\n              padding: '1rem 2.5rem',\n              borderRadius: '12px',\n              fontWeight: 600,\n              fontSize: '1.125rem',\n              border: 'none',\n              cursor: 'pointer',\n              transition: 'all 0.3s'\n            },\n            children: \"Start Test\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2030,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              color: '#6b7280',\n              fontSize: '0.95rem',\n              margin: '0 0 1rem',\n              lineHeight: 1.5\n            },\n            children: [\"Test starts at: \", testStart.toLocaleString()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2039,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              background: 'linear-gradient(135deg, #fef3c7, #fde68a)',\n              border: '1px solid rgba(245, 158, 11, 0.3)',\n              borderRadius: '12px',\n              padding: '0.75rem'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                color: '#92400e',\n                fontSize: '0.875rem',\n                margin: 0\n              },\n              children: \"Please wait for the scheduled start time.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2043,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2042,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1999,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1998,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      minHeight: '100vh',\n      background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n      padding: '1rem'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        textAlign: 'center',\n        background: 'rgba(255, 255, 255, 0.8)',\n        backdropFilter: 'blur(20px)',\n        border: '1px solid rgba(226, 232, 240, 0.5)',\n        borderRadius: '20px',\n        padding: '2rem',\n        maxWidth: '500px',\n        boxShadow: '0 10px 40px rgba(0, 0, 0, 0.05)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: '4rem',\n          height: '4rem',\n          background: 'linear-gradient(135deg, #f1f5f9, #e2e8f0)',\n          borderRadius: '50%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          margin: '0 auto 1rem'\n        },\n        children: /*#__PURE__*/_jsxDEV(Clock, {\n          style: {\n            width: '2rem',\n            height: '2rem',\n            color: '#9ca3af'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2058,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2057,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          fontSize: '1.25rem',\n          fontWeight: 600,\n          color: '#6b7280',\n          margin: '0 0 0.5rem'\n        },\n        children: \"No Active Tests\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2060,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#9ca3af',\n          margin: '0 0 2rem'\n        },\n        children: \"Check back later for new assignments.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2061,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: 'linear-gradient(135deg, #f9fafb, #f3f4f6)',\n          border: '1px solid rgba(209, 213, 219, 0.5)',\n          borderRadius: '12px',\n          padding: '1rem',\n          margin: '0 0 1.5rem',\n          textAlign: 'left',\n          fontSize: '0.75rem'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#374151',\n            margin: '0 0 0.5rem',\n            fontSize: '0.75rem'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Debug Info:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2064,\n            columnNumber: 86\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2064,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0.25rem 0',\n            fontSize: '0.75rem'\n          },\n          children: [\"Token: \", localStorage.getItem('token') ? 'Present' : 'Missing']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2065,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0.25rem 0',\n            fontSize: '0.75rem'\n          },\n          children: [\"Device ID: \", localStorage.getItem('deviceId') || 'Missing']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2066,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0.25rem 0',\n            fontSize: '0.75rem'\n          },\n          children: [\"User ID: \", localStorage.getItem('userId') || 'Missing']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2067,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#6b7280',\n            margin: '0.25rem 0',\n            fontSize: '0.75rem'\n          },\n          children: [\"Last checked: \", new Date().toLocaleTimeString()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2068,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2063,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location.reload(),\n        style: {\n          background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',\n          color: 'white',\n          padding: '0.75rem 1.5rem',\n          borderRadius: '10px',\n          fontWeight: 600,\n          border: 'none',\n          cursor: 'pointer',\n          transition: 'all 0.3s'\n        },\n        children: \"Refresh\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2071,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2056,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2055,\n    columnNumber: 5\n  }, this);\n};\n_s2(TestContainer, \"oDoCXgXHqwaYpewFH1vIsoCDmuE=\");\n_c2 = TestContainer;\nexport default TestContainer;\n\n// import React, { useState, useEffect, useRef } from 'react';\n// import { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\n\n// const StudentTestComponent = ({ testId, onTestComplete, socket }) => {\n//   const API_URL = 'http://localhost:5000/api';\n\n//   const [testData, setTestData] = useState(null);\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n//   const [answers, setAnswers] = useState([]);\n//   const [timeRemaining, setTimeRemaining] = useState(0);\n//   const [testStatus, setTestStatus] = useState('loading');\n//   const [isFullscreen, setIsFullscreen] = useState(false);\n//   const [violations, setViolations] = useState([]);\n//   const [isSubmitting, setIsSubmitting] = useState(false);\n//   const [lateJoinTime, setLateJoinTime] = useState(0);\n\n//   const testContainerRef = useRef(null);\n//   const startTimeRef = useRef(null);\n//   const timerRef = useRef(null);\n//   const visibilityTimeoutRef = useRef(null);\n\n//   // Generate math questions based on test parameters\n//   const generateQuestions = (testType, count, difficultyLevel) => {\n//     const questions = [];\n\n//     for (let i = 0; i < count; i++) {\n//       let question, correctAnswer;\n//       let num1, num2;\n\n//       // Set difficulty ranges\n//       switch (difficultyLevel) {\n//         case 'easy':\n//           num1 = Math.floor(Math.random() * 10) + 1;\n//           num2 = Math.floor(Math.random() * 10) + 1;\n//           break;\n//         case 'medium':\n//           num1 = Math.floor(Math.random() * 50) + 1;\n//           num2 = Math.floor(Math.random() * 50) + 1;\n//           break;\n//         case 'double':\n//           num1 = Math.floor(Math.random() * 99) + 1;\n//           num2 = Math.floor(Math.random() * 99) + 1;\n//           break;\n//         default:\n//           num1 = Math.floor(Math.random() * 20) + 1;\n//           num2 = Math.floor(Math.random() * 20) + 1;\n//       }\n\n//       // Generate based on test type\n//       switch (testType) {\n//         case 'multiplication':\n//           question = `${num1} √ó ${num2} = ?`;\n//           correctAnswer = (num1 * num2).toString();\n//           break;\n//         case 'addition':\n//           question = `${num1} + ${num2} = ?`;\n//           correctAnswer = (num1 + num2).toString();\n//           break;\n//         case 'subtraction':\n//           // Ensure positive result\n//           if (num1 < num2) [num1, num2] = [num2, num1];\n//           question = `${num1} - ${num2} = ?`;\n//           correctAnswer = (num1 - num2).toString();\n//           break;\n//         case 'division':\n//           // Ensure whole number division\n//           const product = num1 * num2;\n//           question = `${product} √∑ ${num1} = ?`;\n//           correctAnswer = num2.toString();\n//           break;\n//         default:\n//           question = `${num1} √ó ${num2} = ?`;\n//           correctAnswer = (num1 * num2).toString();\n//       }\n\n//       questions.push({\n//         question,\n//         correctAnswer,\n//         type: testType,\n//         options: [] // Empty for math problems (text input)\n//       });\n//     }\n\n//     return questions;\n//   };\n\n//   // Fetch test data from your existing backend\n//   useEffect(() => {\n//     const fetchTestData = async () => {\n//       try {\n//         const token = localStorage.getItem('token');\n//         const deviceId = localStorage.getItem('deviceId');\n\n//         if (!token) {\n//           setTestStatus('error');\n//           return;\n//         }\n\n//         // Fetch the test details first\n//         const response = await fetch(`${API_URL}/student/tests/${testId}`, {\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           }\n//         });\n\n//         if (!response.ok) {\n//           if (response.status === 404) {\n//             setTestStatus('no-test');\n//             console.warn('Test not found or inactive');\n//             return;\n//           }\n//           throw new Error('Failed to load test');\n//         }\n\n//         const testDetails = await response.json();\n\n//         // Check if test is still active and not past end time\n//         const now = new Date();\n//         const testStart = new Date(testDetails.startTime);\n//         const testEnd = new Date(testStart.getTime() + (testDetails.duration * 60 * 1000));\n\n//         if (now > testEnd) {\n//           setTestStatus('test-ended');\n//           return;\n//         }\n\n//         // Check if student already submitted\n//         const userId = localStorage.getItem('userId') || 'anonymous';\n//         const existingResult = testDetails.results?.find(r => r.studentId === userId);\n//         if (existingResult) {\n//           setTestStatus('already-submitted');\n//           return;\n//         }\n\n//         // Calculate late join time if applicable\n//         let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\n//         let lateJoinSeconds = 0;\n\n//         if (now > testStart) {\n//           lateJoinSeconds = Math.floor((now - testStart) / 1000);\n//           adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\n//           setLateJoinTime(lateJoinSeconds);\n//         }\n\n//         // Generate questions if not provided\n//         let questions = testDetails.questions || [];\n//         if (questions.length === 0) {\n//           questions = generateQuestions(\n//             testDetails.testType, \n//             testDetails.count, \n//             testDetails.difficultyLevel\n//           );\n//         }\n\n//         const processedTestData = {\n//           ...testDetails,\n//           questions,\n//           gameType: testDetails.testType // For compatibility\n//         };\n\n//         setTestData(processedTestData);\n//         setTimeRemaining(adjustedTimeRemaining);\n//         setAnswers(new Array(questions.length).fill(''));\n//         setTestStatus('active');\n//         startTimeRef.current = Date.now();\n\n//         // Notify admin via socket\n//         socket?.emit('test-started', { \n//           testId: testDetails._id,\n//           studentId: userId,\n//           lateJoinSeconds\n//         });\n\n//       } catch (error) {\n//         console.error('Error loading test:', error);\n//         setTestStatus('error');\n//       }\n//     };\n\n//     if (testId) {\n//       fetchTestData();\n//     }\n//   }, [testId, socket, API_URL]);\n\n//   // Enhanced fullscreen handling\n//   useEffect(() => {\n//     const enterFullscreen = async () => {\n//       try {\n//         if (testContainerRef.current && !isFullscreen) {\n//           if (testContainerRef.current.requestFullscreen) {\n//             await testContainerRef.current.requestFullscreen();\n//           } else if (testContainerRef.current.webkitRequestFullscreen) {\n//             await testContainerRef.current.webkitRequestFullscreen();\n//           } else if (testContainerRef.current.msRequestFullscreen) {\n//             await testContainerRef.current.msRequestFullscreen();\n//           }\n//           setIsFullscreen(true);\n//         }\n//       } catch (error) {\n//         console.warn('Fullscreen not supported:', error);\n//         // Continue test even without fullscreen\n//       }\n//     };\n\n//     if (testStatus === 'active' && testContainerRef.current) {\n//       enterFullscreen();\n//     }\n//   }, [testStatus]);\n\n//   // Handle fullscreen changes with stricter enforcement\n//   useEffect(() => {\n//     const handleFullscreenChange = () => {\n//       const isCurrentlyFullscreen = Boolean(\n//         document.fullscreenElement || \n//         document.webkitFullscreenElement || \n//         document.msFullscreenElement\n//       );\n//       setIsFullscreen(isCurrentlyFullscreen);\n\n//       if (!isCurrentlyFullscreen && testStatus === 'active') {\n//         addViolation('Exited fullscreen mode');\n\n//         // Try to re-enter fullscreen immediately\n//         if (testContainerRef.current) {\n//           const enterFullscreen = async () => {\n//             try {\n//               if (testContainerRef.current.requestFullscreen) {\n//                 await testContainerRef.current.requestFullscreen();\n//               } else if (testContainerRef.current.webkitRequestFullscreen) {\n//                 await testContainerRef.current.webkitRequestFullscreen();\n//               }\n//             } catch (error) {\n//               // If can't re-enter after 3 violations, auto-submit\n//               if (violations.length >= 2) {\n//                 handleAutoSubmit('Multiple fullscreen violations');\n//               }\n//             }\n//           };\n//           enterFullscreen();\n//         }\n//       }\n//     };\n\n//     document.addEventListener('fullscreenchange', handleFullscreenChange);\n//     document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n//     document.addEventListener('msfullscreenchange', handleFullscreenChange);\n\n//     return () => {\n//       document.removeEventListener('fullscreenchange', handleFullscreenChange);\n//       document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\n//       document.removeEventListener('msfullscreenchange', handleFullscreenChange);\n//     };\n//   }, [testStatus, violations]);\n\n//   // Enhanced visibility handling\n//   useEffect(() => {\n//     const handleVisibilityChange = () => {\n//       if (document.hidden && testStatus === 'active') {\n//         addViolation('Switched to another tab/window');\n\n//         // Shorter timeout for tab switching - 3 seconds\n//         visibilityTimeoutRef.current = setTimeout(() => {\n//           if (document.hidden) {\n//             handleAutoSubmit('Tab switching violation - remained hidden');\n//           }\n//         }, 3000);\n//       } else if (!document.hidden && visibilityTimeoutRef.current) {\n//         clearTimeout(visibilityTimeoutRef.current);\n//         visibilityTimeoutRef.current = null;\n//       }\n//     };\n\n//     document.addEventListener('visibilitychange', handleVisibilityChange);\n//     return () => {\n//       document.removeEventListener('visibilitychange', handleVisibilityChange);\n//       if (visibilityTimeoutRef.current) {\n//         clearTimeout(visibilityTimeoutRef.current);\n//       }\n//     };\n//   }, [testStatus]);\n\n//   // Enhanced browser navigation prevention\n//   useEffect(() => {\n//     const handleBeforeUnload = (event) => {\n//       if (testStatus === 'active') {\n//         event.preventDefault();\n//         event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\n//         return event.returnValue;\n//       }\n//     };\n\n//     const handlePopState = (event) => {\n//       if (testStatus === 'active') {\n//         event.preventDefault();\n//         window.history.pushState(null, '', window.location.pathname);\n//         addViolation('Browser navigation attempt');\n//         handleAutoSubmit('Navigation attempt during test');\n//       }\n//     };\n\n//     // Push current state to prevent back navigation\n//     window.history.pushState(null, '', window.location.pathname);\n\n//     window.addEventListener('beforeunload', handleBeforeUnload);\n//     window.addEventListener('popstate', handlePopState);\n\n//     return () => {\n//       window.removeEventListener('beforeunload', handleBeforeUnload);\n//       window.removeEventListener('popstate', handlePopState);\n//     };\n//   }, [testStatus]);\n\n//   // Timer countdown with auto-submit\n//   useEffect(() => {\n//     if (testStatus === 'active' && timeRemaining > 0) {\n//       timerRef.current = setInterval(() => {\n//         setTimeRemaining(prev => {\n//           if (prev <= 1) {\n//             handleAutoSubmit('Time expired');\n//             return 0;\n//           }\n//           return prev - 1;\n//         });\n//       }, 1000);\n\n//       return () => {\n//         if (timerRef.current) {\n//           clearInterval(timerRef.current);\n//         }\n//       };\n//     }\n//   }, [testStatus, timeRemaining]);\n\n//   // Send progress updates to admin\n//   useEffect(() => {\n//     if (testStatus === 'active' && socket) {\n//       const progressInterval = setInterval(() => {\n//         const answeredCount = answers.filter(a => a.trim() !== '').length;\n//         const progress = (answeredCount / answers.length) * 100;\n\n//         socket.emit('test-progress', {\n//           testId,\n//           studentId: localStorage.getItem('userId') || 'anonymous',\n//           progress: Math.round(progress),\n//           currentQuestion: currentQuestionIndex + 1,\n//           answeredQuestions: answeredCount,\n//           timeRemaining\n//         });\n//       }, 5000);\n\n//       return () => clearInterval(progressInterval);\n//     }\n//   }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\n\n//   const addViolation = (violation) => {\n//     setViolations(prev => {\n//       const newViolations = [...prev, {\n//         type: violation,\n//         timestamp: new Date().toISOString()\n//       }];\n\n//       // Auto-submit after 3 violations\n//       if (newViolations.length >= 3) {\n//         setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\n//       }\n\n//       return newViolations;\n//     });\n//   };\n\n//   const handleAutoSubmit = async (reason) => {\n//     if (isSubmitting) return;\n\n//     console.log(`Auto-submitting test: ${reason}`);\n//     await submitTest(true, reason);\n//   };\n\n//   const handleAnswerChange = (questionIndex, value) => {\n//     const newAnswers = [...answers];\n//     newAnswers[questionIndex] = value.trim();\n//     setAnswers(newAnswers);\n//   };\n\n//   const calculateScore = () => {\n//     if (!testData) return { correct: 0, total: 0, score: 0 };\n\n//     let correct = 0;\n//     testData.questions.forEach((question, index) => {\n//       const userAnswer = answers[index]?.trim().toLowerCase();\n//       const correctAnswer = question.correctAnswer?.trim().toLowerCase();\n\n//       if (userAnswer === correctAnswer) {\n//         correct++;\n//       }\n//     });\n\n//     const total = testData.questions.length;\n//     const score = total > 0 ? Math.round((correct / total) * 100) : 0;\n\n//     return { correct, total, score };\n//   };\n\n//   const submitTest = async (isAutoSubmit = false, reason = '') => {\n//     if (isSubmitting) return;\n\n//     setIsSubmitting(true);\n\n//     try {\n//       const { correct, total, score } = calculateScore();\n//       const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\n//       const token = localStorage.getItem('token');\n//       const deviceId = localStorage.getItem('deviceId');\n//       const userId = localStorage.getItem('userId') || 'anonymous';\n\n//       const submissionData = {\n//         studentId: userId,\n//         answers: answers.map((answer, index) => ({\n//           questionIndex: index,\n//           question: testData.questions[index].question,\n//           userAnswer: answer,\n//           correctAnswer: testData.questions[index].correctAnswer,\n//           isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\n//         })),\n//         correctCount: correct,\n//         totalQuestions: total,\n//         score,\n//         timeSpent,\n//         lateJoinTime,\n//         violations,\n//         isAutoSubmit,\n//         autoSubmitReason: reason,\n//         submittedAt: new Date().toISOString()\n//       };\n\n//       const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\n//         method: 'POST',\n//         headers: {\n//           'Authorization': token,\n//           'X-Device-Id': deviceId,\n//           'Content-Type': 'application/json'\n//         },\n//         body: JSON.stringify(submissionData)\n//       });\n\n//       if (!response.ok) {\n//         throw new Error(`Submission failed: ${response.status}`);\n//       }\n\n//       // Update performance data if API exists\n//       try {\n//         const performanceUpdate = {\n//           totalGames: 1,\n//           totalCorrect: correct,\n//           totalScore: score,\n//           gameType: testData.testType,\n//           difficulty: testData.difficultyLevel || 'medium',\n//           speed: 2,\n//           count: total\n//         };\n\n//         await fetch(`${API_URL}/performance/${userId}`, {\n//           method: 'POST',\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           },\n//           body: JSON.stringify(performanceUpdate)\n//         });\n//       } catch (perfError) {\n//         console.warn('Performance update failed:', perfError);\n//         // Continue even if performance update fails\n//       }\n\n//       // Notify admin via socket\n//       socket?.emit('test-submitted', {\n//         testId,\n//         studentId: userId,\n//         score,\n//         correctCount: correct,\n//         totalQuestions: total,\n//         isAutoSubmit,\n//         reason,\n//         timeSpent,\n//         violations: violations.length\n//       });\n\n//       setTestStatus('submitted');\n\n//       // Exit fullscreen\n//       if (document.fullscreenElement) {\n//         document.exitFullscreen();\n//       } else if (document.webkitFullscreenElement) {\n//         document.webkitExitFullscreen();\n//       } else if (document.msExitFullscreen) {\n//         document.msExitFullscreen();\n//       }\n\n//       // Call completion callback\n//       onTestComplete?.({\n//         score,\n//         correct,\n//         total,\n//         isAutoSubmit,\n//         reason,\n//         timeSpent,\n//         violations: violations.length\n//       });\n\n//     } catch (error) {\n//       console.error('Error submitting test:', error);\n\n//       // Fallback: save to localStorage\n//       try {\n//         const { correct, total, score } = calculateScore();\n//         const fallbackData = {\n//           testId,\n//           score,\n//           correct,\n//           total,\n//           submittedAt: new Date().toISOString(),\n//           isAutoSubmit,\n//           reason\n//         };\n\n//         const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\n//         existingFallbacks.push(fallbackData);\n//         localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\n\n//         console.log('Test saved to localStorage as fallback');\n//       } catch (localError) {\n//         console.error('Error saving fallback:', localError);\n//       }\n\n//       setTestStatus('error');\n//     } finally {\n//       setIsSubmitting(false);\n//     }\n//   };\n\n//   const formatTime = (seconds) => {\n//     const mins = Math.floor(seconds / 60);\n//     const secs = seconds % 60;\n//     return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n//   };\n\n//   // Enhanced keyboard and mouse prevention\n//   useEffect(() => {\n//     const preventContextMenu = (e) => {\n//       if (testStatus === 'active') {\n//         e.preventDefault();\n//         addViolation('Right-click attempt');\n//         return false;\n//       }\n//     };\n\n//     const preventKeyboardShortcuts = (e) => {\n//       if (testStatus === 'active') {\n//         // Prevent common shortcuts\n//         if (e.ctrlKey || e.metaKey || e.altKey) {\n//           e.preventDefault();\n//           addViolation('Keyboard shortcut attempt');\n//           return false;\n//         }\n\n//         // Prevent function keys\n//         if (e.key.startsWith('F') && e.key.length > 1) {\n//           e.preventDefault();\n//           addViolation('Function key attempt');\n//           return false;\n//         }\n//       }\n//     };\n\n//     const preventSelection = (e) => {\n//       if (testStatus === 'active') {\n//         e.preventDefault();\n//         return false;\n//       }\n//     };\n\n//     document.addEventListener('contextmenu', preventContextMenu);\n//     document.addEventListener('keydown', preventKeyboardShortcuts);\n//     document.addEventListener('selectstart', preventSelection);\n//     document.addEventListener('dragstart', preventSelection);\n\n//     return () => {\n//       document.removeEventListener('contextmenu', preventContextMenu);\n//       document.removeEventListener('keydown', preventKeyboardShortcuts);\n//       document.removeEventListener('selectstart', preventSelection);\n//       document.removeEventListener('dragstart', preventSelection);\n//     };\n//   }, [testStatus]);\n\n//   // Status screens\n//   if (testStatus === 'loading') {\n//     return (\n//       <div className=\"stc__loading-container\">\n//         <div className=\"stc__loading-content\">\n//           <div className=\"stc__loading-spinner\"></div>\n//           <h2 className=\"stc__loading-title\">Loading Test...</h2>\n//           <p className=\"stc__loading-subtitle\">Preparing your exam questions</p>\n//         </div>\n//         <style jsx>{`\n//           .stc__loading-container {\n//             min-height: 100vh;\n//             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//           }\n//           .stc__loading-content {\n//             text-align: center;\n//             background: rgba(255, 255, 255, 0.1);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(255, 255, 255, 0.2);\n//             border-radius: 20px;\n//             padding: 3rem 2rem;\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\n//           }\n//           .stc__loading-spinner {\n//             width: 48px;\n//             height: 48px;\n//             border: 4px solid rgba(255, 255, 255, 0.3);\n//             border-top: 4px solid #ffffff;\n//             border-radius: 50%;\n//             animation: stc-spin 1s linear infinite;\n//             margin: 0 auto 1.5rem;\n//           }\n//           .stc__loading-title {\n//             font-size: 1.5rem;\n//             font-weight: 600;\n//             color: #ffffff;\n//             margin: 0 0 0.5rem;\n//             letter-spacing: -0.025em;\n//           }\n//           .stc__loading-subtitle {\n//             color: rgba(255, 255, 255, 0.8);\n//             font-size: 0.95rem;\n//             margin: 0;\n//           }\n//           @keyframes stc-spin {\n//             0% { transform: rotate(0deg); }\n//             100% { transform: rotate(360deg); }\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'no-test') {\n//     return (\n//       <div className=\"stc__status-container stc__status-container--info\">\n//         <div className=\"stc__status-card\">\n//           <Clock className=\"stc__status-icon stc__status-icon--info\" />\n//           <h2 className=\"stc__status-title\">Test Not Found</h2>\n//           <p className=\"stc__status-text\">The requested test could not be found or is not available.</p>\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\n//             Go Back\n//           </button>\n//         </div>\n//         <style jsx>{`\n//           .stc__status-container {\n//             min-height: 100vh;\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//             padding: 1rem;\n//           }\n//           .stc__status-container--info {\n//             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n//           }\n//           .stc__status-card {\n//             background: rgba(255, 255, 255, 0.95);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(255, 255, 255, 0.3);\n//             border-radius: 24px;\n//             padding: 3rem 2rem;\n//             text-align: center;\n//             max-width: 400px;\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\n//           }\n//           .stc__status-icon {\n//             width: 4rem;\n//             height: 4rem;\n//             margin: 0 auto 1.5rem;\n//             display: block;\n//           }\n//           .stc__status-icon--info {\n//             color: #3b82f6;\n//           }\n//           .stc__status-title {\n//             font-size: 1.5rem;\n//             font-weight: 700;\n//             color: #1f2937;\n//             margin: 0 0 0.75rem;\n//             letter-spacing: -0.025em;\n//           }\n//           .stc__status-text {\n//             color: #6b7280;\n//             margin: 0 0 2rem;\n//             line-height: 1.6;\n//           }\n//           .stc__status-button {\n//             padding: 0.75rem 2rem;\n//             border-radius: 12px;\n//             font-weight: 600;\n//             font-size: 0.95rem;\n//             border: none;\n//             cursor: pointer;\n//             transition: all 0.2s;\n//           }\n//           .stc__status-button--primary {\n//             background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\n//             color: white;\n//           }\n//           .stc__status-button--primary:hover {\n//             transform: translateY(-2px);\n//             box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'test-ended') {\n//     return (\n//       <div className=\"stc__status-container stc__status-container--warning\">\n//         <div className=\"stc__status-card\">\n//           <AlertTriangle className=\"stc__status-icon stc__status-icon--warning\" />\n//           <h2 className=\"stc__status-title\">Test Time Expired</h2>\n//           <p className=\"stc__status-text\">The time limit for this test has already passed.</p>\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\n//             Go Back\n//           </button>\n//         </div>\n//         <style jsx>{`\n//           .stc__status-container--warning {\n//             background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n//           }\n//           .stc__status-icon--warning {\n//             color: #f59e0b;\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'already-submitted') {\n//     return (\n//       <div className=\"stc__status-container stc__status-container--success\">\n//         <div className=\"stc__status-card\">\n//           <Send className=\"stc__status-icon stc__status-icon--success\" />\n//           <h2 className=\"stc__status-title\">Test Already Submitted</h2>\n//           <p className=\"stc__status-text\">You have already completed this test successfully.</p>\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\n//             Go Back\n//           </button>\n//         </div>\n//         <style jsx>{`\n//           .stc__status-container--success {\n//             background: linear-gradient(135deg, #10b981 0%, #047857 100%);\n//           }\n//           .stc__status-icon--success {\n//             color: #10b981;\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'error') {\n//     return (\n//       <div className=\"stc__status-container stc__status-container--error\">\n//         <div className=\"stc__status-card\">\n//           <AlertTriangle className=\"stc__status-icon stc__status-icon--error\" />\n//           <h2 className=\"stc__status-title\">Test Error</h2>\n//           <p className=\"stc__status-text\">Unable to load or submit the test. Please contact your teacher.</p>\n//           <div className=\"stc__status-buttons\">\n//             <button onClick={() => window.location.reload()} className=\"stc__status-button stc__status-button--primary\">\n//               Try Again\n//             </button>\n//             <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--secondary\">\n//               Go Back\n//             </button>\n//           </div>\n//         </div>\n//         <style jsx>{`\n//           .stc__status-container--error {\n//             background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n//           }\n//           .stc__status-icon--error {\n//             color: #ef4444;\n//           }\n//           .stc__status-buttons {\n//             display: flex;\n//             gap: 0.75rem;\n//             justify-content: center;\n//             flex-wrap: wrap;\n//           }\n//           .stc__status-button--secondary {\n//             background: rgba(107, 114, 128, 0.1);\n//             color: #374151;\n//             border: 1px solid rgba(107, 114, 128, 0.3);\n//           }\n//           .stc__status-button--secondary:hover {\n//             background: rgba(107, 114, 128, 0.2);\n//             transform: translateY(-1px);\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'submitted') {\n//     const { correct, total, score } = calculateScore();\n\n//     return (\n//       <>\n//         <div className=\"stc__completion-container\">\n//           <div className=\"stc__completion-card\">\n//             <div className=\"stc__completion-icon-wrapper\">\n//               <Send className=\"stc__completion-icon\" />\n//             </div>\n//             <h2 className=\"stc__completion-title\">Test Submitted Successfully!</h2>\n//             <p className=\"stc__completion-subtitle\">Your test has been submitted and saved.</p>\n\n//             <div className=\"stc__score-display\">\n//               <div className=\"stc__score-value\">{score}%</div>\n//               <div className=\"stc__score-details\">\n//                 {correct} out of {total} questions correct\n//               </div>\n//             </div>\n\n//             {lateJoinTime > 0 && (\n//               <div className=\"stc__info-badge stc__info-badge--blue\">\n//                 <p className=\"stc__info-text\">\n//                   You joined {Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')} late\n//                 </p>\n//               </div>\n//             )}\n\n//             {violations.length > 0 && (\n//               <div className=\"stc__info-badge stc__info-badge--yellow\">\n//                 <p className=\"stc__info-text\">\n//                   {violations.length} violation{violations.length > 1 ? 's' : ''} recorded\n//                 </p>\n//               </div>\n//             )}\n\n//             <button onClick={() => window.history.back()} className=\"stc__completion-button stc__completion-button--primary\">   \n//               Return to Dashboard\n//             </button>\n//           </div>\n//         </div>\n\n//         <style jsx>{`\n//           .stc__completion-container {\n//             min-height: 100vh;\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//             padding: 1rem;\n//             background: linear-gradient(135deg, #10b981 0%, #047857 100%);\n//           }\n//           .stc__completion-card {\n//             background: rgba(255, 255, 255, 0.95);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(255, 255, 255, 0.3);\n//             border-radius: 24px;\n//             padding: 3rem 2rem;\n//             text-align: center;\n//             max-width: 400px;\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\n//           }\n//           .stc__completion-icon-wrapper {\n//             width: 4rem;\n//             height: 4rem;\n//             border-radius: 50%;\n//             background: rgba(0, 0, 0, 0.1);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             margin: 0 auto 2rem;\n//           }\n//           .stc__completion-icon {\n//             color: #10b981;\n//             width: 2rem;\n//             height: 2rem;\n//           }\n//           .stc__completion-title {\n//             font-size: 1.5rem;\n//             margin-bottom: 1rem;\n//           }\n//           .stc__completion-subtitle {\n//             font-size: 1rem;\n//             margin-bottom: 2rem;\n//           }\n//           .stc__score-display {\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             margin-bottom: 2rem;\n//           }\n//           .stc__score-value {\n//             font-size: 2rem;\n//             font-weight: 600;\n//             margin-right: 1rem;\n//           }\n//           .stc__score-details {\n//             font-size: 0.875rem;\n//           }\n//           .stc__info-badge {\n//             display: inline-block;\n//             padding: 0.25rem 0.5rem;\n//             border-radius: 4px;\n//             margin-right: 0.5rem;\n//             margin-bottom: 0.5rem;\n//             font-size: 0.875rem;\n//             font-weight: 500;\n//           }\n//           .stc__info-badge--blue {\n//             background: rgba(0, 0, 255, 0.1);\n//             color: #0000ff;\n//           }\n//           .stc__info-badge--yellow {\n//             background: rgba(255, 255, 0, 0.1);\n//             color: #ffff00;\n//           }\n//           .stc__completion-button {\n//             cursor: pointer;\n//             border: none;\n//             border-radius: 4px;\n//             padding: 0.5rem 1rem;\n//             font-size: 1rem;\n//             font-weight: 500;\n//             margin-top: 2rem;\n//           }\n//           .stc__completion-button--primary {\n//             background: #10b981;\n//             color: #fff;\n//           }\n//           .stc__completion-button--primary:hover {\n//             background: #047857;\n//           }\n//         `}</style>\n//       </>\n//     );\n//   };\n//   };\n\n//   const TestContainer = ({ studentId, socket }) => {\n//   const API_URL = 'http://localhost:5000/api';\n//   const [activeTest, setActiveTest] = useState(null);\n//   const [showTest, setShowTest] = useState(false);\n//   const [testResult, setTestResult] = useState(null);\n//   const [loading, setLoading] = useState(true);\n//   const [error, setError] = useState(null);\n\n//   // Check for active tests using your existing API structure\n//   useEffect(() => {\n//     const checkForActiveTests = async () => {\n//       try {\n//         setLoading(true);\n//         setError(null);\n\n//         const token = localStorage.getItem('token');\n//         const deviceId = localStorage.getItem('deviceId');\n\n//         if (!token) {\n//           console.log('No token found');\n//           setError('No authentication token found. Please log in again.');\n//           setLoading(false);\n//           return;\n//         }\n\n//         console.log('Checking for active tests...');\n//         console.log('Token:', token ? 'Present' : 'Missing');\n//         console.log('Device ID:', deviceId);\n\n//         // Check for active tests that target this student\n//         const response = await fetch(`${API_URL}/student/tests/active`, {\n//           method: 'GET',\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           }\n//         });\n\n//         console.log('Response status:', response.status);\n\n//         if (!response.ok) {\n//           if (response.status === 401) {\n//             setError('Authentication failed. Please log in again.');\n//             return;\n//           } else if (response.status === 403) {\n//             setError('Access denied. Please contact your teacher.');\n//             return;\n//           }\n//           throw new Error(`Failed to fetch tests: ${response.status}`);\n//         }\n\n//         const tests = await response.json();\n//         console.log('Received tests:', tests);\n\n//         if (tests && tests.length > 0) {\n//           // Filter tests that are actually active and not expired\n//           const currentTime = new Date();\n//           const availableTests = tests.filter(test => {\n//             const testStart = new Date(test.startTime);\n//             const testEnd = new Date(testStart.getTime() + (test.duration * 60 * 1000));\n\n//             console.log('Test:', test._id);\n//             console.log('Current time:', currentTime);\n//             console.log('Test start:', testStart);\n//             console.log('Test end:', testEnd);\n//             console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\n\n//             return currentTime >= testStart && currentTime < testEnd;\n//           });\n\n//           if (availableTests.length > 0) {\n//             console.log('Setting active test:', availableTests[0]);\n//             setActiveTest(availableTests[0]);\n//           } else {\n//             console.log('No available tests (all expired or not yet started)');\n//           }\n//         } else {\n//           console.log('No tests found');\n//         }\n//       } catch (error) {\n//         console.error('Error checking for active tests:', error);\n//         setError(`Error loading tests: ${error.message}`);\n//       } finally {\n//         setLoading(false);\n//       }\n//     };\n\n//     checkForActiveTests();\n\n//     // Check every 30 seconds for new tests\n//     const interval = setInterval(checkForActiveTests, 30000);\n//     return () => clearInterval(interval);\n//   }, [API_URL]);\n\n//   // Listen for test events from admin (if socket is available)\n//   useEffect(() => {\n//     if (socket) {\n//       const handleTestLaunched = (testData) => {\n//         console.log('Test launched event received:', testData);\n//         setActiveTest(testData);\n//       };\n\n//       const handleTestEnded = (data) => {\n//         console.log('Test ended event received:', data);\n//         if (activeTest && activeTest._id === data.testId) {\n//           setActiveTest(null);\n//           setShowTest(false);\n//         }\n//       };\n\n//       socket.on('test-launched', handleTestLaunched);\n//       socket.on('test-ended', handleTestEnded);\n\n//       return () => {\n//         socket.off('test-launched', handleTestLaunched);\n//         socket.off('test-ended', handleTestEnded);\n//       };\n//     }\n//   }, [socket, activeTest]);\n\n//   const handleStartTest = () => {\n//     console.log('Starting test:', activeTest);\n//     setShowTest(true);\n//   };\n\n//   const handleTestComplete = (result) => {\n//     console.log('Test completed:', result);\n//     setTestResult(result);\n//     setShowTest(false);\n//     setActiveTest(null);\n//   };\n\n//   if (loading) {\n//     return (\n//       <div className=\"tc__loading-container\">\n//         <div className=\"tc__loading-content\">\n//           <div className=\"tc__loading-spinner\"></div>\n//           <p className=\"tc__loading-text\">Checking for active tests...</p>\n//           <p className=\"tc__loading-subtext\">This may take a moment</p>\n//         </div>\n//         <style jsx>{`\n//           .tc__loading-container {\n//             min-height: 100vh;\n//             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//           }\n//           .tc__loading-content {\n//             text-align: center;\n//             background: rgba(255, 255, 255, 0.8);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(226, 232, 240, 0.5);\n//             border-radius: 20px;\n//             padding: 2rem;\n//             box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);\n//           }\n//           .tc__loading-spinner {\n//             width: 32px;\n//             height: 32px;\n//             border: 3px solid rgba(59, 130, 246, 0.3);\n//             border-top: 3px solid #3b82f6;\n//             border-radius: 50%;\n//             animation: tc-spin 1s linear infinite;\n//             margin: 0 auto 1rem;\n//           }\n//           .tc__loading-text {\n//             color: #374151;\n//             font-weight: 500;\n//             margin: 0 0 0.25rem;\n//           }\n//           .tc__loading-subtext {\n//             color: #9ca3af;\n//             font-size: 0.875rem;\n//             margin: 0;\n//           }\n//           @keyframes tc-spin {\n//             0% { transform: rotate(0deg); }\n//             100% { transform: rotate(360deg); }\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (error) {\n//     return (\n//       <div className=\"tc__error-container\">\n//         <div className=\"tc__error-card\">\n//           <AlertTriangle className=\"tc__error-icon\" />\n//           <h2 className=\"tc__error-title\">Error</h2>\n//           <p className=\"tc__error-text\">{error}</p>\n//           <div className=\"tc__error-actions\">\n//             <button onClick={() => window.location.reload()} className=\"tc__error-button tc__error-button--primary\">\n//               Retry\n//             </button>\n//             <button onClick={() => setError(null)} className=\"tc__error-button tc__error-button--secondary\">\n//               Dismiss\n//             </button>\n//           </div>\n//         </div>\n//         <style jsx>{`\n//           .tc__error-container {\n//             min-height: 100vh;\n//             background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//             padding: 1rem;\n//           }\n//           .tc__error-card {\n//             background: rgba(255, 255, 255, 0.95);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(254, 202, 202, 0.5);\n//             border-radius: 20px;\n//             padding: 2rem;\n//             text-align: center;\n//             max-width: 400px;\n//             box-shadow: 0 10px 40px rgba(239, 68, 68, 0.1);\n//           }\n//           .tc__error-icon {\n//             width: 3rem;\n//             height: 3rem;\n//             color: #ef4444;\n//             margin: 0 auto 1rem;\n//           }\n//           .tc__error-title {\n//             font-size: 1.5rem;\n//             font-weight: 700;\n//             color: #dc2626;\n//             margin: 0 0 0.5rem;\n//           }\n//           .tc__error-text {\n//             color: #6b7280;\n//             margin: 0 0 2rem;\n//             line-height: 1.5;\n//           }\n//           .tc__error-actions {\n//             display: flex;\n//             gap: 0.75rem;\n//             justify-content: center;\n//           }\n//           .tc__error-button {\n//             padding: 0.75rem 1.5rem;\n//             border-radius: 10px;\n//             font-weight: 600;\n//             border: none;\n//             cursor: pointer;\n//             transition: all 0.2s;\n//           }\n//           .tc__error-button--primary {\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n//             color: white;\n//           }\n//           .tc__error-button--primary:hover {\n//             background: linear-gradient(135deg, #2563eb, #1e40af);\n//             transform: translateY(-1px);\n//           }\n//           .tc__error-button--secondary {\n//             background: rgba(107, 114, 128, 0.1);\n//             color: #374151;\n//             border: 1px solid rgba(107, 114, 128, 0.3);\n//           }\n//           .tc__error-button--secondary:hover {\n//             background: rgba(107, 114, 128, 0.2);\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (showTest && activeTest) {\n//     return (\n//       <StudentTestComponent\n//         testId={activeTest._id || activeTest.id}\n//         onTestComplete={handleTestComplete}\n//         socket={socket}\n//       />\n//     );\n//   }\n\n//   if (testResult) {\n//     return (\n//       <div className=\"tc__result-container\">\n//         <div className=\"tc__result-card\">\n//           <h2 className=\"tc__result-title\">Test Complete!</h2>\n//           <div className=\"tc__result-score\">{testResult.score}%</div>\n//           <p className=\"tc__result-details\">\n//             You answered {testResult.correct} out of {testResult.total} questions correctly.\n//           </p>\n//           {testResult.isAutoSubmit && (\n//             <div className=\"tc__result-info tc__result-info--warning\">\n//               <p className=\"tc__result-info-text\">\n//                 <strong>Note:</strong> Test was auto-submitted due to: {testResult.reason}\n//               </p>\n//             </div>\n//           )}\n//           {testResult.violations > 0 && (\n//             <div className=\"tc__result-info tc__result-info--error\">\n//               <p className=\"tc__result-info-text\">\n//                 <strong>Security Violations:</strong> {testResult.violations} recorded\n//               </p>\n//             </div>\n//           )}\n//           <button onClick={() => setTestResult(null)} className=\"tc__result-button\">\n//             Continue\n//           </button>\n//         </div>\n//         <style jsx>{`\n//           .tc__result-container {\n//             min-height: 100vh;\n//             background: linear-gradient(135deg, #dcfdf7 0%, #a7f3d0 100%);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//             padding: 1rem;\n//           }\n//           .tc__result-card {\n//             background: rgba(255, 255, 255, 0.95);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(167, 243, 208, 0.5);\n//             border-radius: 20px;\n//             padding: 2rem;\n//             text-align: center;\n//             max-width: 400px;\n//             box-shadow: 0 10px 40px rgba(16, 185, 129, 0.1);\n//           }\n//           .tc__result-title {\n//             font-size: 1.75rem;\n//             font-weight: 700;\n//             color: #065f46;\n//             margin: 0 0 1rem;\n//           }\n//           .tc__result-score {\n//             font-size: 3rem;\n//             font-weight: 800;\n//             background: linear-gradient(135deg, #059669, #047857);\n//             -webkit-background-clip: text;\n//             -webkit-text-fill-color: transparent;\n//             background-clip: text;\n//             margin: 0 0 0.5rem;\n//           }\n//           .tc__result-details {\n//             color: #6b7280;\n//             margin: 0 0 1.5rem;\n//           }\n//           .tc__result-info {\n//             border-radius: 10px;\n//             padding: 0.75rem;\n//             margin: 0 0 1rem;\n//             border: 1px solid;\n//           }\n//           .tc__result-info--warning {\n//             background: rgba(245, 158, 11, 0.1);\n//             border-color: rgba(245, 158, 11, 0.3);\n//           }\n//           .tc__result-info--error {\n//             background: rgba(239, 68, 68, 0.1);\n//             border-color: rgba(239, 68, 68, 0.3);\n//           }\n//           .tc__result-info-text {\n//             margin: 0;\n//             font-size: 0.875rem;\n//             font-weight: 500;\n//           }\n//           .tc__result-info--warning .tc__result-info-text {\n//             color: #92400e;\n//           }\n//           .tc__result-info--error .tc__result-info-text {\n//             color: #b91c1c;\n//           }\n//           .tc__result-button {\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n//             color: white;\n//             padding: 0.875rem 2rem;\n//             border-radius: 12px;\n//             font-weight: 600;\n//             border: none;\n//             cursor: pointer;\n//             transition: all 0.3s;\n//           }\n//           .tc__result-button:hover {\n//             background: linear-gradient(135deg, #2563eb, #1e40af);\n//             transform: translateY(-2px);\n//             box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   if (activeTest) {\n//     const now = new Date();\n//     const testStart = new Date(activeTest.startTime);\n//     const testEnd = new Date(testStart.getTime() + (activeTest.duration * 60 * 1000));\n//     const isTestTime = now >= testStart && now < testEnd;\n//     const isTestOver = now >= testEnd;\n\n//     console.log('Active test found:', {\n//       testId: activeTest._id,\n//       now: now.toISOString(),\n//       start: testStart.toISOString(),\n//       end: testEnd.toISOString(),\n//       isTestTime,\n//       isTestOver\n//     });\n\n//     if (isTestOver) {\n//       return (\n//         <div className=\"tc__expired-container\">\n//           <div className=\"tc__expired-card\">\n//             <AlertTriangle className=\"tc__expired-icon\" />\n//             <h2 className=\"tc__expired-title\">Test Expired</h2>\n//             <p className=\"tc__expired-text\">The time limit for this test has passed.</p>\n//             <button onClick={() => setActiveTest(null)} className=\"tc__expired-button\">\n//               Continue\n//             </button>\n//           </div>\n//           <style jsx>{`\n//             .tc__expired-container {\n//               min-height: 100vh;\n//               background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n//               display: flex;\n//               align-items: center;\n//               justify-content: center;\n//               font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//               padding: 1rem;\n//             }\n//             .tc__expired-card {\n//               background: rgba(255, 255, 255, 0.95);\n//               backdrop-filter: blur(20px);\n//               border: 1px solid rgba(253, 230, 138, 0.5);\n//               border-radius: 20px;\n//               padding: 2rem;\n//               text-align: center;\n//               max-width: 400px;\n//               box-shadow: 0 10px 40px rgba(245, 158, 11, 0.1);\n//             }\n//             .tc__expired-icon {\n//               width: 4rem;\n//               height: 4rem;\n//               color: #f59e0b;\n//               margin: 0 auto 1rem;\n//             }\n//             .tc__expired-title {\n//               font-size: 1.5rem;\n//               font-weight: 700;\n//               color: #92400e;\n//               margin: 0 0 0.5rem;\n//             }\n//             .tc__expired-text {\n//               color: #6b7280;\n//               margin: 0 0 2rem;\n//             }\n//             .tc__expired-button {\n//               background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n//               color: white;\n//               padding: 0.75rem 2rem;\n//               border-radius: 12px;\n//               font-weight: 600;\n//               border: none;\n//               cursor: pointer;\n//               transition: all 0.3s;\n//             }\n//             .tc__expired-button:hover {\n//               background: linear-gradient(135deg, #2563eb, #1e40af);\n//               transform: translateY(-2px);\n//               box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n//             }\n//           `}</style>\n//         </div>\n//       );\n//     }\n\n//     return (\n//       <div className=\"tc__waiting-container\">\n//         <div className=\"tc__waiting-card\">\n//           <div className=\"tc__waiting-icon-wrapper\">\n//             <Calculator className=\"tc__waiting-icon\" />\n//           </div>\n//           <h2 className=\"tc__waiting-title\">Test Available</h2>\n//           <p className=\"tc__waiting-subtitle\">\n//             {activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1)} ‚Ä¢ {activeTest.duration} minutes ‚Ä¢ {activeTest.count} questions\n//           </p>\n//           <p className=\"tc__waiting-difficulty\">\n//             Difficulty: {activeTest.difficultyLevel}\n//           </p>\n\n//           <div className=\"tc__waiting-info\">\n//             <p className=\"tc__waiting-info-text\">\n//               <strong>Test ID:</strong> {activeTest._id}\n//             </p>\n//             <p className=\"tc__waiting-info-text\">\n//               <strong>Started:</strong> {testStart.toLocaleString()}\n//             </p>\n//           </div>\n\n//           {isTestTime ? (\n//             <>\n//               <p className=\"tc__waiting-instruction\">\n//                 Click below to start your test. Ensure you're in a quiet environment with stable internet.\n//               </p>\n//               <div className=\"tc__waiting-warning\">\n//                 <p className=\"tc__waiting-warning-text\">\n//                   <strong>Important:</strong> Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\n//                 </p>\n//               </div>\n//               <button onClick={handleStartTest} className=\"tc__waiting-button tc__waiting-button--start\">\n//                 Start Test\n//               </button>\n//             </>\n//           ) : (\n//             <>\n//               <p className=\"tc__waiting-instruction\">\n//                 Test starts at: {testStart.toLocaleString()}\n//               </p>\n//               <div className=\"tc__waiting-info\">\n//                 <p className=\"tc__waiting-info-text\">\n//                   Please wait for the scheduled start time.\n//                 </p>\n//               </div>\n//             </>\n//           )}\n//         </div>\n//         <style jsx>{`\n//           .tc__waiting-container {\n//             min-height: 100vh;\n//             background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//             padding: 1rem;\n//           }\n//           .tc__waiting-card {\n//             background: rgba(255, 255, 255, 0.95);\n//             backdrop-filter: blur(20px);\n//             border: 1px solid rgba(191, 219, 254, 0.5);\n//             border-radius: 20px;\n//             padding: 2rem;\n//             text-align: center;\n//             max-width: 500px;\n//             box-shadow: 0 10px 40px rgba(59, 130, 246, 0.1);\n//           }\n//           .tc__waiting-icon-wrapper {\n//             width: 4rem;\n//             height: 4rem;\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n//             border-radius: 50%;\n//             display: flex;\n//             align-items: center;\n//             justify-content: center;\n//             margin: 0 auto 1rem;\n//             box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n//           }\n//           .tc__waiting-icon {\n//             width: 2rem;\n//             height: 2rem;\n//             color: white;\n//           }\n//           .tc__waiting-title {\n//             font-size: 1.75rem;\n//             font-weight: 700;\n//             color: #1e40af;\n//             margin: 0 0 0.5rem;\n//           }\n//           .tc__waiting-subtitle {\n//             color: #6b7280;\n//             margin: 0 0 0.5rem;\n//           }\n//           .tc__waiting-difficulty {\n//             color: #9ca3af;\n//             font-size: 0.875rem;\n//             margin: 0 0 1.5rem;\n//           }\n//           .tc__waiting-info {\n//             background: linear-gradient(135deg, #eff6ff, #dbeafe);\n//             border: 1px solid rgba(147, 197, 253, 0.3);\n//             border-radius: 12px;\n//             padding: 1rem;\n//             margin: 0 0 1.5rem;\n//           }\n//           .tc__waiting-info-text {\n//             color: #1e40af;\n//             font-size: 0.875rem;\n//             margin: 0 0 0.25rem;\n//           }\n//           .tc__waiting-info-text:last-child {\n//             margin-bottom: 0;\n//           }\n//           .tc__waiting-instruction {\n//             color: #6b7280;\n//             font-size: 0.95rem;\n//             margin: 0 0 1rem;\n//             line-height: 1.5;\n//           }\n//           .tc__waiting-warning {\n//             background: linear-gradient(135deg, #fef3c7, #fde68a);\n//             border: 1px solid rgba(245, 158, 11, 0.3);\n//             border-radius: 12px;\n//             padding: 0.75rem;\n//             margin: 0 0 1.5rem;\n//           }\n//           .tc__waiting-warning-text {\n//             color: #92400e;\n//             font-size: 0.875rem;\n//             margin: 0;\n//           }\n//           .tc__waiting-button {\n//             padding: 1rem 2.5rem;\n//             border-radius: 12px;\n//             font-weight: 600;\n//             font-size: 1.125rem;\n//             border: none;\n//             cursor: pointer;\n//             transition: all 0.3s;\n//           }\n//           .tc__waiting-button--start {\n//             background: linear-gradient(135deg, #10b981, #047857);\n//             color: white;\n//           }\n//           .tc__waiting-button--start:hover {\n//             background: linear-gradient(135deg, #059669, #065f46);\n//             transform: translateY(-2px);\n//             box-shadow: 0 12px 30px rgba(16, 185, 129, 0.3);\n//           }\n//         `}</style>\n//       </div>\n//     );\n//   }\n\n//   return (\n//     <div className=\"tc__empty-container\">\n//       <div className=\"tc__empty-content\">\n//         <div className=\"tc__empty-icon-wrapper\">\n//           <Clock className=\"tc__empty-icon\" />\n//         </div>\n//         <h2 className=\"tc__empty-title\">No Active Tests</h2>\n//         <p className=\"tc__empty-text\">Check back later for new assignments.</p>\n\n//         <div className=\"tc__debug-info\">\n//           <p className=\"tc__debug-title\"><strong>Debug Info:</strong></p>\n//           <p className=\"tc__debug-item\">Token: {localStorage.getItem('token') ? 'Present' : 'Missing'}</p>\n//           <p className=\"tc__debug-item\">Device ID: {localStorage.getItem('deviceId') || 'Missing'}</p>\n//           <p className=\"tc__debug-item\">User ID: {localStorage.getItem('userId') || 'Missing'}</p>\n//           <p className=\"tc__debug-item\">Last checked: {new Date().toLocaleTimeString()}</p>\n//         </div>\n\n//         <button onClick={() => window.location.reload()} className=\"tc__empty-button\">\n//           Refresh\n//         </button>\n//       </div>\n//       <style jsx>{`\n//         .tc__empty-container {\n//           min-height: 100vh;\n//           background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n//           display: flex;\n//           align-items: center;\n//           justify-content: center;\n//           font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n//           padding: 1rem;\n//         }\n//         .tc__empty-content {\n//           text-align: center;\n//           background: rgba(255, 255, 255, 0.8);\n//           backdrop-filter: blur(20px);\n//           border: 1px solid rgba(226, 232, 240, 0.5);\n//           border-radius: 20px;\n//           padding: 2rem;\n//           max-width: 500px;\n//           box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);\n//         }\n//         .tc__empty-icon-wrapper {\n//           width: 4rem;\n//           height: 4rem;\n//           background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\n//           border-radius: 50%;\n//           display: flex;\n//           align-items: center;\n//           justify-content: center;\n//           margin: 0 auto 1rem;\n//         }\n//         .tc__empty-icon {\n//           width: 2rem;\n//           height: 2rem;\n//           color: #9ca3af;\n//         }\n//         .tc__empty-title {\n//           font-size: 1.25rem;\n//           font-weight: 600;\n//           color: #6b7280;\n//           margin: 0 0 0.5rem;\n//         }\n//         .tc__empty-text {\n//           color: #9ca3af;\n//           margin: 0 0 2rem;\n//         }\n//         .tc__debug-info {\n//           background: linear-gradient(135deg, #f9fafb, #f3f4f6);\n//           border: 1px solid rgba(209, 213, 219, 0.5);\n//           border-radius: 12px;\n//           padding: 1rem;\n//           margin: 0 0 1.5rem;\n//           text-align: left;\n//           font-size: 0.75rem;\n//         }\n//         .tc__debug-title {\n//           color: #374151;\n//           margin: 0 0 0.5rem;\n//           font-size: 0.75rem;\n//         }\n//         .tc__debug-item {\n//           color: #6b7280;\n//           margin: 0.25rem 0;\n//           font-size: 0.75rem;\n//         }\n//         .tc__empty-button {\n//           background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n//           color: white;\n//           padding: 0.75rem 1.5rem;\n//           border-radius: 10px;\n//           font-weight: 600;\n//           border: none;\n//           cursor: pointer;\n//           transition: all 0.3s;\n//         }\n//         .tc__empty-button:hover {\n//           background: linear-gradient(135deg, #2563eb, #1e40af);\n//           transform: translateY(-2px);\n//           box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n//         }\n\n//         @media (max-width: 768px) {\n//           .tc__empty-content {\n//             padding: 1.5rem;\n//           }\n//           .tc__waiting-card {\n//             padding: 1.5rem;\n//           }\n//           .tc__result-card {\n//             padding: 1.5rem;\n//           }\n//         }\n\n//         @media (max-width: 480px) {\n//           .tc__empty-content,\n//           .tc__waiting-card,\n//           .tc__result-card,\n//           .tc__error-card,\n//           .tc__expired-card {\n//             padding: 1rem;\n//             margin: 0.5rem;\n//           }\n//           .tc__waiting-button {\n//             width: 100%;\n//             padding: 1rem;\n//           }\n//           .tc__result-score {\n//             font-size: 2.5rem;\n//           }\n//         }\n//       `}</style>\n//     </div>\n//   );\n// };\n\n// export default TestContainer;\n\n// import React, { useState, useEffect, useRef } from 'react';\n// import { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\n\n// const StudentTestComponent = ({ testId, onTestComplete, socket }) => {\n//   const API_URL = 'http://localhost:5000/api';\n\n//   const [testData, setTestData] = useState(null);\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n//   const [answers, setAnswers] = useState([]);\n//   const [timeRemaining, setTimeRemaining] = useState(0);\n//   const [testStatus, setTestStatus] = useState('loading');\n//   const [isFullscreen, setIsFullscreen] = useState(false);\n//   const [violations, setViolations] = useState([]);\n//   const [isSubmitting, setIsSubmitting] = useState(false);\n//   const [lateJoinTime, setLateJoinTime] = useState(0);\n\n//   const testContainerRef = useRef(null);\n//   const startTimeRef = useRef(null);\n//   const timerRef = useRef(null);\n//   const visibilityTimeoutRef = useRef(null);\n\n//   // Generate math questions based on test parameters\n//   const generateQuestions = (testType, count, difficultyLevel) => {\n//     const questions = [];\n\n//     for (let i = 0; i < count; i++) {\n//       let question, correctAnswer;\n//       let num1, num2;\n\n//       // Set difficulty ranges\n//       switch (difficultyLevel) {\n//         case 'easy':\n//           num1 = Math.floor(Math.random() * 10) + 1;\n//           num2 = Math.floor(Math.random() * 10) + 1;\n//           break;\n//         case 'medium':\n//           num1 = Math.floor(Math.random() * 50) + 1;\n//           num2 = Math.floor(Math.random() * 50) + 1;\n//           break;\n//         case 'double':\n//           num1 = Math.floor(Math.random() * 99) + 1;\n//           num2 = Math.floor(Math.random() * 99) + 1;\n//           break;\n//         default:\n//           num1 = Math.floor(Math.random() * 20) + 1;\n//           num2 = Math.floor(Math.random() * 20) + 1;\n//       }\n\n//       // Generate based on test type\n//       switch (testType) {\n//         case 'multiplication':\n//           question = `${num1} √ó ${num2} = ?`;\n//           correctAnswer = (num1 * num2).toString();\n//           break;\n//         case 'addition':\n//           question = `${num1} + ${num2} = ?`;\n//           correctAnswer = (num1 + num2).toString();\n//           break;\n//         case 'subtraction':\n//           // Ensure positive result\n//           if (num1 < num2) [num1, num2] = [num2, num1];\n//           question = `${num1} - ${num2} = ?`;\n//           correctAnswer = (num1 - num2).toString();\n//           break;\n//         case 'division':\n//           // Ensure whole number division\n//           const product = num1 * num2;\n//           question = `${product} √∑ ${num1} = ?`;\n//           correctAnswer = num2.toString();\n//           break;\n//         default:\n//           question = `${num1} √ó ${num2} = ?`;\n//           correctAnswer = (num1 * num2).toString();\n//       }\n\n//       questions.push({\n//         question,\n//         correctAnswer,\n//         type: testType,\n//         options: [] // Empty for math problems (text input)\n//       });\n//     }\n\n//     return questions;\n//   };\n\n//   // Fetch test data from your existing backend\n//   useEffect(() => {\n//     const fetchTestData = async () => {\n//       try {\n//         const token = localStorage.getItem('token');\n//         const deviceId = localStorage.getItem('deviceId');\n\n//         if (!token) {\n//           setTestStatus('error');\n//           return;\n//         }\n\n//         // Fetch the test details first\n//         const response = await fetch(`${API_URL}/student/tests/${testId}`, {\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           }\n//         });\n\n//         if (!response.ok) {\n//           if (response.status === 404) {\n//             setTestStatus('no-test');\n//             console.warn('Test not found or inactive');\n//             return;\n//           }\n//           throw new Error('Failed to load test');\n//         }\n\n//         const testDetails = await response.json();\n\n//         // Check if test is still active and not past end time\n//         const now = new Date();\n//         const testStart = new Date(testDetails.startTime);\n//         const testEnd = new Date(testStart.getTime() + (testDetails.duration * 60 * 1000));\n\n//         if (now > testEnd) {\n//           setTestStatus('test-ended');\n//           return;\n//         }\n\n//         // Check if student already submitted\n//         const userId = localStorage.getItem('userId') || 'anonymous';\n//         const existingResult = testDetails.results?.find(r => r.studentId === userId);\n//         if (existingResult) {\n//           setTestStatus('already-submitted');\n//           return;\n//         }\n\n//         // Calculate late join time if applicable\n//         let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\n//         let lateJoinSeconds = 0;\n\n//         if (now > testStart) {\n//           lateJoinSeconds = Math.floor((now - testStart) / 1000);\n//           adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\n//           setLateJoinTime(lateJoinSeconds);\n//         }\n\n//         // Generate questions if not provided\n//         let questions = testDetails.questions || [];\n//         if (questions.length === 0) {\n//           questions = generateQuestions(\n//             testDetails.testType, \n//             testDetails.count, \n//             testDetails.difficultyLevel\n//           );\n//         }\n\n//         const processedTestData = {\n//           ...testDetails,\n//           questions,\n//           gameType: testDetails.testType // For compatibility\n//         };\n\n//         setTestData(processedTestData);\n//         setTimeRemaining(adjustedTimeRemaining);\n//         setAnswers(new Array(questions.length).fill(''));\n//         setTestStatus('active');\n//         startTimeRef.current = Date.now();\n\n//         // Notify admin via socket\n//         socket?.emit('test-started', { \n//           testId: testDetails._id,\n//           studentId: userId,\n//           lateJoinSeconds\n//         });\n\n//       } catch (error) {\n//         console.error('Error loading test:', error);\n//         setTestStatus('error');\n//       }\n//     };\n\n//     if (testId) {\n//       fetchTestData();\n//     }\n//   }, [testId, socket, API_URL]);\n\n//   // Enhanced fullscreen handling\n//   useEffect(() => {\n//     const enterFullscreen = async () => {\n//       try {\n//         if (testContainerRef.current && !isFullscreen) {\n//           if (testContainerRef.current.requestFullscreen) {\n//             await testContainerRef.current.requestFullscreen();\n//           } else if (testContainerRef.current.webkitRequestFullscreen) {\n//             await testContainerRef.current.webkitRequestFullscreen();\n//           } else if (testContainerRef.current.msRequestFullscreen) {\n//             await testContainerRef.current.msRequestFullscreen();\n//           }\n//           setIsFullscreen(true);\n//         }\n//       } catch (error) {\n//         console.warn('Fullscreen not supported:', error);\n//         // Continue test even without fullscreen\n//       }\n//     };\n\n//     if (testStatus === 'active' && testContainerRef.current) {\n//       enterFullscreen();\n//     }\n//   }, [testStatus]);\n\n//   // Handle fullscreen changes with stricter enforcement\n//   useEffect(() => {\n//     const handleFullscreenChange = () => {\n//       const isCurrentlyFullscreen = Boolean(\n//         document.fullscreenElement || \n//         document.webkitFullscreenElement || \n//         document.msFullscreenElement\n//       );\n//       setIsFullscreen(isCurrentlyFullscreen);\n\n//       if (!isCurrentlyFullscreen && testStatus === 'active') {\n//         addViolation('Exited fullscreen mode');\n\n//         // Try to re-enter fullscreen immediately\n//         if (testContainerRef.current) {\n//           const enterFullscreen = async () => {\n//             try {\n//               if (testContainerRef.current.requestFullscreen) {\n//                 await testContainerRef.current.requestFullscreen();\n//               } else if (testContainerRef.current.webkitRequestFullscreen) {\n//                 await testContainerRef.current.webkitRequestFullscreen();\n//               }\n//             } catch (error) {\n//               // If can't re-enter after 3 violations, auto-submit\n//               if (violations.length >= 2) {\n//                 handleAutoSubmit('Multiple fullscreen violations');\n//               }\n//             }\n//           };\n//           enterFullscreen();\n//         }\n//       }\n//     };\n\n//     document.addEventListener('fullscreenchange', handleFullscreenChange);\n//     document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n//     document.addEventListener('msfullscreenchange', handleFullscreenChange);\n\n//     return () => {\n//       document.removeEventListener('fullscreenchange', handleFullscreenChange);\n//       document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\n//       document.removeEventListener('msfullscreenchange', handleFullscreenChange);\n//     };\n//   }, [testStatus, violations]);\n\n//   // Enhanced visibility handling\n//   useEffect(() => {\n//     const handleVisibilityChange = () => {\n//       if (document.hidden && testStatus === 'active') {\n//         addViolation('Switched to another tab/window');\n\n//         // Shorter timeout for tab switching - 3 seconds\n//         visibilityTimeoutRef.current = setTimeout(() => {\n//           if (document.hidden) {\n//             handleAutoSubmit('Tab switching violation - remained hidden');\n//           }\n//         }, 3000);\n//       } else if (!document.hidden && visibilityTimeoutRef.current) {\n//         clearTimeout(visibilityTimeoutRef.current);\n//         visibilityTimeoutRef.current = null;\n//       }\n//     };\n\n//     document.addEventListener('visibilitychange', handleVisibilityChange);\n//     return () => {\n//       document.removeEventListener('visibilitychange', handleVisibilityChange);\n//       if (visibilityTimeoutRef.current) {\n//         clearTimeout(visibilityTimeoutRef.current);\n//       }\n//     };\n//   }, [testStatus]);\n\n//   // Enhanced browser navigation prevention\n//   useEffect(() => {\n//     const handleBeforeUnload = (event) => {\n//       if (testStatus === 'active') {\n//         event.preventDefault();\n//         event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\n//         return event.returnValue;\n//       }\n//     };\n\n//     const handlePopState = (event) => {\n//       if (testStatus === 'active') {\n//         event.preventDefault();\n//         window.history.pushState(null, '', window.location.pathname);\n//         addViolation('Browser navigation attempt');\n//         handleAutoSubmit('Navigation attempt during test');\n//       }\n//     };\n\n//     // Push current state to prevent back navigation\n//     window.history.pushState(null, '', window.location.pathname);\n\n//     window.addEventListener('beforeunload', handleBeforeUnload);\n//     window.addEventListener('popstate', handlePopState);\n\n//     return () => {\n//       window.removeEventListener('beforeunload', handleBeforeUnload);\n//       window.removeEventListener('popstate', handlePopState);\n//     };\n//   }, [testStatus]);\n\n//   // Timer countdown with auto-submit\n//   useEffect(() => {\n//     if (testStatus === 'active' && timeRemaining > 0) {\n//       timerRef.current = setInterval(() => {\n//         setTimeRemaining(prev => {\n//           if (prev <= 1) {\n//             handleAutoSubmit('Time expired');\n//             return 0;\n//           }\n//           return prev - 1;\n//         });\n//       }, 1000);\n\n//       return () => {\n//         if (timerRef.current) {\n//           clearInterval(timerRef.current);\n//         }\n//       };\n//     }\n//   }, [testStatus, timeRemaining]);\n\n//   // Send progress updates to admin\n//   useEffect(() => {\n//     if (testStatus === 'active' && socket) {\n//       const progressInterval = setInterval(() => {\n//         const answeredCount = answers.filter(a => a.trim() !== '').length;\n//         const progress = (answeredCount / answers.length) * 100;\n\n//         socket.emit('test-progress', {\n//           testId,\n//           studentId: localStorage.getItem('userId') || 'anonymous',\n//           progress: Math.round(progress),\n//           currentQuestion: currentQuestionIndex + 1,\n//           answeredQuestions: answeredCount,\n//           timeRemaining\n//         });\n//       }, 5000);\n\n//       return () => clearInterval(progressInterval);\n//     }\n//   }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\n\n//   const addViolation = (violation) => {\n//     setViolations(prev => {\n//       const newViolations = [...prev, {\n//         type: violation,\n//         timestamp: new Date().toISOString()\n//       }];\n\n//       // Auto-submit after 3 violations\n//       if (newViolations.length >= 3) {\n//         setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\n//       }\n\n//       return newViolations;\n//     });\n//   };\n\n//   const handleAutoSubmit = async (reason) => {\n//     if (isSubmitting) return;\n\n//     console.log(`Auto-submitting test: ${reason}`);\n//     await submitTest(true, reason);\n//   };\n\n//   const handleAnswerChange = (questionIndex, value) => {\n//     const newAnswers = [...answers];\n//     newAnswers[questionIndex] = value.trim();\n//     setAnswers(newAnswers);\n//   };\n\n//   const calculateScore = () => {\n//     if (!testData) return { correct: 0, total: 0, score: 0 };\n\n//     let correct = 0;\n//     testData.questions.forEach((question, index) => {\n//       const userAnswer = answers[index]?.trim().toLowerCase();\n//       const correctAnswer = question.correctAnswer?.trim().toLowerCase();\n\n//       if (userAnswer === correctAnswer) {\n//         correct++;\n//       }\n//     });\n\n//     const total = testData.questions.length;\n//     const score = total > 0 ? Math.round((correct / total) * 100) : 0;\n\n//     return { correct, total, score };\n//   };\n\n//   const submitTest = async (isAutoSubmit = false, reason = '') => {\n//     if (isSubmitting) return;\n\n//     setIsSubmitting(true);\n\n//     try {\n//       const { correct, total, score } = calculateScore();\n//       const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\n//       const token = localStorage.getItem('token');\n//       const deviceId = localStorage.getItem('deviceId');\n//       const userId = localStorage.getItem('userId') || 'anonymous';\n\n//       const submissionData = {\n//         studentId: userId,\n//         answers: answers.map((answer, index) => ({\n//           questionIndex: index,\n//           question: testData.questions[index].question,\n//           userAnswer: answer,\n//           correctAnswer: testData.questions[index].correctAnswer,\n//           isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\n//         })),\n//         correctCount: correct,\n//         totalQuestions: total,\n//         score,\n//         timeSpent,\n//         lateJoinTime,\n//         violations,\n//         isAutoSubmit,\n//         autoSubmitReason: reason,\n//         submittedAt: new Date().toISOString()\n//       };\n\n//       const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\n//         method: 'POST',\n//         headers: {\n//           'Authorization': token,\n//           'X-Device-Id': deviceId,\n//           'Content-Type': 'application/json'\n//         },\n//         body: JSON.stringify(submissionData)\n//       });\n\n//       if (!response.ok) {\n//         throw new Error(`Submission failed: ${response.status}`);\n//       }\n\n//       // Update performance data if API exists\n//       try {\n//         const performanceUpdate = {\n//           totalGames: 1,\n//           totalCorrect: correct,\n//           totalScore: score,\n//           gameType: testData.testType,\n//           difficulty: testData.difficultyLevel || 'medium',\n//           speed: 2,\n//           count: total\n//         };\n\n//         await fetch(`${API_URL}/performance/${userId}`, {\n//           method: 'POST',\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           },\n//           body: JSON.stringify(performanceUpdate)\n//         });\n//       } catch (perfError) {\n//         console.warn('Performance update failed:', perfError);\n//         // Continue even if performance update fails\n//       }\n\n//       // Notify admin via socket\n//       socket?.emit('test-submitted', {\n//         testId,\n//         studentId: userId,\n//         score,\n//         correctCount: correct,\n//         totalQuestions: total,\n//         isAutoSubmit,\n//         reason,\n//         timeSpent,\n//         violations: violations.length\n//       });\n\n//       setTestStatus('submitted');\n\n//       // Exit fullscreen\n//       if (document.fullscreenElement) {\n//         document.exitFullscreen();\n//       } else if (document.webkitFullscreenElement) {\n//         document.webkitExitFullscreen();\n//       } else if (document.msExitFullscreen) {\n//         document.msExitFullscreen();\n//       }\n\n//       // Call completion callback\n//       onTestComplete?.({\n//         score,\n//         correct,\n//         total,\n//         isAutoSubmit,\n//         reason,\n//         timeSpent,\n//         violations: violations.length\n//       });\n\n//     } catch (error) {\n//       console.error('Error submitting test:', error);\n\n//       // Fallback: save to localStorage\n//       try {\n//         const { correct, total, score } = calculateScore();\n//         const fallbackData = {\n//           testId,\n//           score,\n//           correct,\n//           total,\n//           submittedAt: new Date().toISOString(),\n//           isAutoSubmit,\n//           reason\n//         };\n\n//         const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\n//         existingFallbacks.push(fallbackData);\n//         localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\n\n//         console.log('Test saved to localStorage as fallback');\n//       } catch (localError) {\n//         console.error('Error saving fallback:', localError);\n//       }\n\n//       setTestStatus('error');\n//     } finally {\n//       setIsSubmitting(false);\n//     }\n//   };\n\n//   const formatTime = (seconds) => {\n//     const mins = Math.floor(seconds / 60);\n//     const secs = seconds % 60;\n//     return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n//   };\n\n//   // Enhanced keyboard and mouse prevention\n//   useEffect(() => {\n//     const preventContextMenu = (e) => {\n//       if (testStatus === 'active') {\n//         e.preventDefault();\n//         addViolation('Right-click attempt');\n//         return false;\n//       }\n//     };\n\n//     const preventKeyboardShortcuts = (e) => {\n//       if (testStatus === 'active') {\n//         // Prevent common shortcuts\n//         if (e.ctrlKey || e.metaKey || e.altKey) {\n//           e.preventDefault();\n//           addViolation('Keyboard shortcut attempt');\n//           return false;\n//         }\n\n//         // Prevent function keys\n//         if (e.key.startsWith('F') && e.key.length > 1) {\n//           e.preventDefault();\n//           addViolation('Function key attempt');\n//           return false;\n//         }\n//       }\n//     };\n\n//     const preventSelection = (e) => {\n//       if (testStatus === 'active') {\n//         e.preventDefault();\n//         return false;\n//       }\n//     };\n\n//     document.addEventListener('contextmenu', preventContextMenu);\n//     document.addEventListener('keydown', preventKeyboardShortcuts);\n//     document.addEventListener('selectstart', preventSelection);\n//     document.addEventListener('dragstart', preventSelection);\n\n//     return () => {\n//       document.removeEventListener('contextmenu', preventContextMenu);\n//       document.removeEventListener('keydown', preventKeyboardShortcuts);\n//       document.removeEventListener('selectstart', preventSelection);\n//       document.removeEventListener('dragstart', preventSelection);\n//     };\n//   }, [testStatus]);\n\n//   // Status screens\n//   if (testStatus === 'loading') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\n//         <div className=\"text-center\">\n//           <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n//           <h2 className=\"text-xl font-semibold text-gray-700\">Loading Test...</h2>\n//           <p className=\"text-gray-500\">Preparing your exam questions</p>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'no-test') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\n//           <Clock className=\"h-16 w-16 text-blue-500 mx-auto mb-4\" />\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Not Found</h2>\n//           <p className=\"text-gray-500 mb-4\">The requested test could not be found or is not available.</p>\n//           <button \n//             onClick={() => window.history.back()} \n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//           >\n//             Go Back\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'test-ended') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-yellow-50\">\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\n//           <AlertTriangle className=\"h-16 w-16 text-yellow-500 mx-auto mb-4\" />\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Time Expired</h2>\n//           <p className=\"text-gray-500 mb-4\">The time limit for this test has already passed.</p>\n//           <button \n//             onClick={() => window.history.back()} \n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//           >\n//             Go Back\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'already-submitted') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-green-50\">\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\n//           <Send className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Already Submitted</h2>\n//           <p className=\"text-gray-500 mb-4\">You have already completed this test successfully.</p>\n//           <button \n//             onClick={() => window.history.back()} \n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//           >\n//             Go Back\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'error') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-red-50\">\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\n//           <AlertTriangle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Error</h2>\n//           <p className=\"text-gray-500 mb-4\">Unable to load or submit the test. Please contact your teacher.</p>\n//           <div className=\"space-x-2\">\n//             <button \n//               onClick={() => window.location.reload()} \n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//             >\n//               Try Again\n//             </button>\n//             <button \n//               onClick={() => window.history.back()} \n//               className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\n//             >\n//               Go Back\n//             </button>\n//           </div>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (testStatus === 'submitted') {\n//     const { correct, total, score } = calculateScore();\n\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-green-50\">\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg max-w-md\">\n//           <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n//             <Send className=\"h-8 w-8 text-green-600\" />\n//           </div>\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Submitted Successfully!</h2>\n//           <p className=\"text-gray-600 mb-6\">Your test has been submitted and saved.</p>\n\n//           <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n//             <div className=\"text-3xl font-bold text-blue-600 mb-2\">{score}%</div>\n//             <div className=\"text-sm text-gray-600\">\n//               {correct} out of {total} questions correct\n//             </div>\n//           </div>\n\n//           {lateJoinTime > 0 && (\n//             <div className=\"bg-blue-50 border border-blue-200 rounded p-3 mb-4\">\n//               <p className=\"text-sm text-blue-800\">\n//                 You joined {Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')} late\n//               </p>\n//             </div>\n//           )}\n\n//           {violations.length > 0 && (\n//             <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\n//               <p className=\"text-sm text-yellow-800\">\n//                 Security violations recorded: {violations.length}\n//               </p>\n//             </div>\n//           )}\n\n//           <button\n//             onClick={() => window.history.back()}\n//             className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\n//           >\n//             Continue\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (!testData) return null;\n\n//   const currentQuestion = testData.questions[currentQuestionIndex];\n//   const progress = ((currentQuestionIndex + 1) / testData.questions.length) * 100;\n\n//   return (\n//     <div \n//       ref={testContainerRef}\n//       className=\"min-h-screen bg-gray-50 flex flex-col\"\n//       style={{ userSelect: 'none', WebkitUserSelect: 'none', MozUserSelect: 'none' }}\n//     >\n//       {/* Security Status Bar */}\n//       <div className=\"bg-red-600 text-white px-4 py-2 text-sm flex items-center justify-between\">\n//         <div className=\"flex items-center gap-2\">\n//           <Lock className=\"h-4 w-4\" />\n//           <span>EXAM MODE - Do not close window, switch tabs, or use keyboard shortcuts</span>\n//         </div>\n//         <div className=\"flex items-center gap-4\">\n//           {lateJoinTime > 0 && (\n//             <span className=\"bg-blue-800 px-2 py-1 rounded text-xs\">\n//               Late: +{Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')}\n//             </span>\n//           )}\n//           {violations.length > 0 && (\n//             <span className=\"bg-red-800 px-2 py-1 rounded text-xs\">\n//               {violations.length} violation(s)\n//             </span>\n//           )}\n//         </div>\n//       </div>\n\n//       {/* Timer and Progress Header */}\n//       <div className=\"bg-white shadow-sm border-b px-6 py-4\">\n//         <div className=\"flex items-center justify-between\">\n//           <div>\n//             <h1 className=\"text-xl font-bold text-gray-800 flex items-center gap-2\">\n//               <Calculator className=\"h-5 w-5\" />\n//               {testData.testType.charAt(0).toUpperCase() + testData.testType.slice(1)} Test\n//               <span className=\"text-sm font-normal text-gray-500\">\n//                 ({testData.difficultyLevel})\n//               </span>\n//             </h1>\n//             <p className=\"text-sm text-gray-600\">\n//               Question {currentQuestionIndex + 1} of {testData.questions.length}\n//             </p>\n//           </div>\n\n//           <div className=\"text-right\">\n//             <div className={`text-2xl font-bold ${\n//               timeRemaining < 60 ? 'text-red-600 animate-pulse' : \n//               timeRemaining < 300 ? 'text-orange-600' : 'text-blue-600'\n//             }`}>\n//               <Clock className=\"inline h-6 w-6 mr-2\" />\n//               {formatTime(timeRemaining)}\n//             </div>\n//             <p className=\"text-sm text-gray-500\">Time remaining</p>\n//           </div>\n//         </div>\n\n//         {/* Progress Bar */}\n//         <div className=\"mt-4\">\n//           <div className=\"w-full bg-gray-200 rounded-full h-2\">\n//             <div \n//               className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n//               style={{ width: `${progress}%` }}\n//             ></div>\n//           </div>\n//         </div>\n//       </div>\n\n//       {/* Question Content */}\n//       <div className=\"flex-1 flex items-center justify-center p-6\">\n//         <div className=\"bg-white rounded-lg shadow-lg p-8 w-full max-w-2xl\">\n//           <div className=\"mb-6\">\n//             <h2 className=\"text-3xl font-bold text-gray-800 mb-6 text-center\">\n//               {currentQuestion.question}\n//             </h2>\n\n//             {/* Answer Input */}\n//             <div className=\"space-y-4\">\n//               {currentQuestion.options && currentQuestion.options.length > 0 ? (\n//                 // Multiple choice\n//                 <div className=\"space-y-3\">\n//                   {currentQuestion.options.map((option, index) => (\n//                     <label \n//                       key={index}\n//                       className=\"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50\"\n//                     >\n//                       <input\n//                         type=\"radio\"\n//                         name={`question-${currentQuestionIndex}`}\n//                         value={option}\n//                         checked={answers[currentQuestionIndex] === option}\n//                         onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\n//                         className=\"mr-3\"\n//                       />\n//                       <span className=\"text-lg\">{option}</span>\n//                     </label>\n//                   ))}\n//                 </div>\n//               ) : (\n//                 // Text input for math problems\n//                 <div>\n//                   <input\n//                     type=\"text\"\n//                     value={answers[currentQuestionIndex]}\n//                     onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\n//                     className=\"w-full p-6 text-2xl border-2 rounded-lg focus:border-blue-500 focus:outline-none text-center font-mono\"\n//                     placeholder=\"Enter your answer\"\n//                     autoFocus\n//                     onKeyPress={(e) => {\n//                       // Allow only numbers and basic math symbols\n//                       const allowedChars = /[0-9\\-+.]/;\n//                       if (!allowedChars.test(e.key) && e.key !== 'Backspace' && e.key !== 'Enter') {\n//                         e.preventDefault();\n//                       }\n//                       // Submit on Enter if it's the last question\n//                       if (e.key === 'Enter' && currentQuestionIndex === testData.questions.length - 1) {\n//                         submitTest(false);\n//                       }\n//                     }}\n//                   />\n//                   <p className=\"text-sm text-gray-500 mt-2 text-center\">\n//                     Enter numbers only. Press Enter to move to next question.\n//                   </p>\n//                 </div>\n//               )}\n//             </div>\n//           </div>\n\n//           {/* Navigation Buttons */}\n//           <div className=\"flex justify-between items-center\">\n//             <button\n//               onClick={() => setCurrentQuestionIndex(Math.max(0, currentQuestionIndex - 1))}\n//               disabled={currentQuestionIndex === 0}\n//               className=\"px-6 py-2 bg-gray-500 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600 transition-colors\"\n//             >\n//               Previous\n//             </button>\n\n//             <span className=\"text-gray-500\">\n//               {answers.filter(a => a.trim() !== '').length} of {testData.questions.length} answered\n//             </span>\n\n//             {currentQuestionIndex < testData.questions.length - 1 ? (\n//               <button\n//                 onClick={() => setCurrentQuestionIndex(currentQuestionIndex + 1)}\n//                 className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n//               >\n//                 Next\n//               </button>\n//             ) : (\n//               <button\n//                 onClick={() => submitTest(false)}\n//                 disabled={isSubmitting}\n//                 className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2 transition-colors\"\n//               >\n//                 {isSubmitting ? (\n//                   <>\n//                     <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\"></div>\n//                     Submitting...\n//                   </>\n//                 ) : (\n//                   <>\n//                     <Send className=\"h-4 w-4\" />\n//                     Submit Test\n//                   </>\n//                 )}\n//               </button>\n//             )}\n//           </div>\n//         </div>\n//       </div>\n\n//       {/* Question Navigation Footer */}\n//       <div className=\"bg-white border-t px-6 py-4\">\n//         <div className=\"flex flex-wrap gap-2 justify-center\">\n//           {testData.questions.map((_, index) => (\n//             <button\n//               key={index}\n//               onClick={() => setCurrentQuestionIndex(index)}\n//               className={`w-10 h-10 rounded-full text-sm font-medium transition-colors ${\n//                 index === currentQuestionIndex\n//                   ? 'bg-blue-600 text-white'\n//                   : answers[index]?.trim()\n//                   ? 'bg-green-100 text-green-800 border border-green-300'\n//                   : 'bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200'\n//               }`}\n//             >\n//               {index + 1}\n//             </button>\n//           ))}\n//         </div>\n//       </div>\n\n//       {/* Warning Modal for Violations */}\n//       {violations.length > 0 && violations.length % 2 === 1 && (\n//         <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n//           <div className=\"bg-white rounded-lg p-6 max-w-md mx-4\">\n//             <div className=\"flex items-center gap-3 mb-4\">\n//               <AlertTriangle className=\"h-8 w-8 text-red-500\" />\n//               <h3 className=\"text-lg font-bold text-red-800\">Security Violation Detected</h3>\n//             </div>\n//             <p className=\"text-gray-700 mb-4\">\n//               You have attempted to leave the test environment or use prohibited features. \n//               This violation has been recorded.\n//             </p>\n//             <div className=\"bg-red-50 border border-red-200 rounded p-3 mb-4\">\n//               <p className=\"text-sm text-red-800\">\n//                 <strong>Latest Violation:</strong> {violations[violations.length - 1]?.type}\n//               </p>\n//               <p className=\"text-sm text-red-600 mt-1\">\n//                 Total violations: {violations.length}\n//               </p>\n//               {violations.length >= 2 && (\n//                 <p className=\"text-sm text-red-700 mt-2 font-semibold\">\n//                   Warning: One more violation will auto-submit your test!\n//                 </p>\n//               )}\n//             </div>\n//             <div className=\"text-right\">\n//               <button\n//                 onClick={() => {\n//                   // Modal will auto-close, violation is already recorded\n//                 }}\n//                 className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//               >\n//                 Continue Test\n//               </button>\n//             </div>\n//           </div>\n//         </div>\n//       )}\n//     </div>\n//   );\n// };\n\n// // Enhanced Test Container Component\n// // Fixed TestContainer component in StudentTestComponent.js\n\n// // Enhanced Test Container Component\n// const TestContainer = ({ studentId, socket }) => {\n//   const API_URL = 'http://localhost:5000/api';\n//   const [activeTest, setActiveTest] = useState(null);\n//   const [showTest, setShowTest] = useState(false);\n//   const [testResult, setTestResult] = useState(null);\n//   const [loading, setLoading] = useState(true);\n//   const [error, setError] = useState(null);\n\n//   // Check for active tests using your existing API structure\n//   useEffect(() => {\n//     const checkForActiveTests = async () => {\n//       try {\n//         setLoading(true);\n//         setError(null);\n\n//         const token = localStorage.getItem('token');\n//         const deviceId = localStorage.getItem('deviceId');\n\n//         if (!token) {\n//           console.log('No token found');\n//           setError('No authentication token found. Please log in again.');\n//           setLoading(false);\n//           return;\n//         }\n\n//         console.log('Checking for active tests...');\n//         console.log('Token:', token ? 'Present' : 'Missing');\n//         console.log('Device ID:', deviceId);\n\n//         // Check for active tests that target this student\n//         const response = await fetch(`${API_URL}/student/tests/active`, {\n//           method: 'GET',\n//           headers: {\n//             'Authorization': token,\n//             'X-Device-Id': deviceId,\n//             'Content-Type': 'application/json'\n//           }\n//         });\n\n//         console.log('Response status:', response.status);\n\n//         if (!response.ok) {\n//           if (response.status === 401) {\n//             setError('Authentication failed. Please log in again.');\n//             return;\n//           } else if (response.status === 403) {\n//             setError('Access denied. Please contact your teacher.');\n//             return;\n//           }\n//           throw new Error(`Failed to fetch tests: ${response.status}`);\n//         }\n\n//         const tests = await response.json();\n//         console.log('Received tests:', tests);\n\n//         if (tests && tests.length > 0) {\n//           // Filter tests that are actually active and not expired\n//           const currentTime = new Date();\n//           const availableTests = tests.filter(test => {\n//             const testStart = new Date(test.startTime);\n//             const testEnd = new Date(testStart.getTime() + (test.duration * 60 * 1000));\n\n//             console.log('Test:', test._id);\n//             console.log('Current time:', currentTime);\n//             console.log('Test start:', testStart);\n//             console.log('Test end:', testEnd);\n//             console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\n\n//             return currentTime >= testStart && currentTime < testEnd;\n//           });\n\n//           if (availableTests.length > 0) {\n//             console.log('Setting active test:', availableTests[0]);\n//             setActiveTest(availableTests[0]);\n//           } else {\n//             console.log('No available tests (all expired or not yet started)');\n//           }\n//         } else {\n//           console.log('No tests found');\n//         }\n//       } catch (error) {\n//         console.error('Error checking for active tests:', error);\n//         setError(`Error loading tests: ${error.message}`);\n//       } finally {\n//         setLoading(false);\n//       }\n//     };\n\n//     checkForActiveTests();\n\n//     // Check every 30 seconds for new tests\n//     const interval = setInterval(checkForActiveTests, 30000);\n//     return () => clearInterval(interval);\n//   }, [API_URL]);\n\n//   // Listen for test events from admin (if socket is available)\n//   useEffect(() => {\n//     if (socket) {\n//       const handleTestLaunched = (testData) => {\n//         console.log('Test launched event received:', testData);\n//         setActiveTest(testData);\n//       };\n\n//       const handleTestEnded = (data) => {\n//         console.log('Test ended event received:', data);\n//         if (activeTest && activeTest._id === data.testId) {\n//           setActiveTest(null);\n//           setShowTest(false);\n//         }\n//       };\n\n//       socket.on('test-launched', handleTestLaunched);\n//       socket.on('test-ended', handleTestEnded);\n\n//       return () => {\n//         socket.off('test-launched', handleTestLaunched);\n//         socket.off('test-ended', handleTestEnded);\n//       };\n//     }\n//   }, [socket, activeTest]);\n\n//   const handleStartTest = () => {\n//     console.log('Starting test:', activeTest);\n//     setShowTest(true);\n//   };\n\n//   const handleTestComplete = (result) => {\n//     console.log('Test completed:', result);\n//     setTestResult(result);\n//     setShowTest(false);\n//     setActiveTest(null);\n//   };\n\n//   if (loading) {\n//     return (\n//       <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n//         <div className=\"text-center\">\n//           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n//           <p className=\"text-gray-600\">Checking for active tests...</p>\n//           <p className=\"text-xs text-gray-400 mt-2\">This may take a moment</p>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (error) {\n//     return (\n//       <div className=\"min-h-screen bg-red-50 flex items-center justify-center\">\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\n//           <AlertTriangle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\n//           <h2 className=\"text-xl font-bold text-gray-800 mb-2\">Error</h2>\n//           <p className=\"text-gray-600 mb-4\">{error}</p>\n//           <div className=\"space-x-2\">\n//             <button\n//               onClick={() => window.location.reload()}\n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//             >\n//               Retry\n//             </button>\n//             <button\n//               onClick={() => setError(null)}\n//               className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\n//             >\n//               Dismiss\n//             </button>\n//           </div>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (showTest && activeTest) {\n//     return (\n//       <StudentTestComponent\n//         testId={activeTest._id || activeTest.id}\n//         onTestComplete={handleTestComplete}\n//         socket={socket}\n//       />\n//     );\n//   }\n\n//   if (testResult) {\n//     return (\n//       <div className=\"min-h-screen bg-green-50 flex items-center justify-center\">\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Test Complete!</h2>\n//           <div className=\"text-6xl font-bold text-blue-600 mb-4\">{testResult.score}%</div>\n//           <p className=\"text-gray-600 mb-6\">\n//             You answered {testResult.correct} out of {testResult.total} questions correctly.\n//           </p>\n//           {testResult.isAutoSubmit && (\n//             <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\n//               <p className=\"text-sm text-yellow-800\">\n//                 <strong>Note:</strong> Test was auto-submitted due to: {testResult.reason}\n//               </p>\n//             </div>\n//           )}\n//           {testResult.violations > 0 && (\n//             <div className=\"bg-red-50 border border-red-200 rounded p-3 mb-4\">\n//               <p className=\"text-sm text-red-800\">\n//                 <strong>Security Violations:</strong> {testResult.violations} recorded\n//               </p>\n//             </div>\n//           )}\n//           <button\n//             onClick={() => setTestResult(null)}\n//             className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\n//           >\n//             Continue\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (activeTest) {\n//     const now = new Date();\n//     const testStart = new Date(activeTest.startTime);\n//     const testEnd = new Date(testStart.getTime() + (activeTest.duration * 60 * 1000));\n//     const isTestTime = now >= testStart && now < testEnd;\n//     const isTestOver = now >= testEnd;\n\n//     console.log('Active test found:', {\n//       testId: activeTest._id,\n//       now: now.toISOString(),\n//       start: testStart.toISOString(),\n//       end: testEnd.toISOString(),\n//       isTestTime,\n//       isTestOver\n//     });\n\n//     if (isTestOver) {\n//       return (\n//         <div className=\"min-h-screen bg-red-50 flex items-center justify-center\">\n//           <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\n//             <AlertTriangle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n//             <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Expired</h2>\n//             <p className=\"text-gray-600 mb-4\">\n//               The time limit for this test has passed.\n//             </p>\n//             <button \n//               onClick={() => setActiveTest(null)} \n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//             >\n//               Continue\n//             </button>\n//           </div>\n//         </div>\n//       );\n//     }\n\n//     return (\n//       <div className=\"min-h-screen bg-blue-50 flex items-center justify-center\">\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\n//           <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n//             <Calculator className=\"h-8 w-8 text-blue-600\" />\n//           </div>\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Available</h2>\n//           <p className=\"text-gray-600 mb-4\">\n//             {activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1)} ‚Ä¢ {activeTest.duration} minutes ‚Ä¢ {activeTest.count} questions\n//           </p>\n//           <p className=\"text-sm text-gray-500 mb-4\">\n//             Difficulty: {activeTest.difficultyLevel}\n//           </p>\n\n//           <div className=\"bg-blue-50 border border-blue-200 rounded p-3 mb-4\">\n//             <p className=\"text-sm text-blue-800\">\n//               <strong>Test ID:</strong> {activeTest._id}\n//             </p>\n//             <p className=\"text-sm text-blue-800\">\n//               <strong>Started:</strong> {testStart.toLocaleString()}\n//             </p>\n//           </div>\n\n//           {isTestTime ? (\n//             <>\n//               <p className=\"text-sm text-gray-500 mb-6\">\n//                 Click below to start your test. Ensure you're in a quiet environment with stable internet.\n//               </p>\n//               <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\n//                 <p className=\"text-sm text-yellow-800\">\n//                   <strong>Important:</strong> Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\n//                 </p>\n//               </div>\n//               <button\n//                 onClick={handleStartTest}\n//                 className=\"bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 text-lg font-medium\"\n//               >\n//                 Start Test\n//               </button>\n//             </>\n//           ) : (\n//             <>\n//               <p className=\"text-sm text-gray-500 mb-4\">\n//                 Test starts at: {testStart.toLocaleString()}\n//               </p>\n//               <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3\">\n//                 <p className=\"text-sm text-yellow-800\">\n//                   Please wait for the scheduled start time.\n//                 </p>\n//               </div>\n//             </>\n//           )}\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   return (\n//     <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n//       <div className=\"text-center\">\n//         <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n//           <Clock className=\"h-8 w-8 text-gray-400\" />\n//         </div>\n//         <h2 className=\"text-xl text-gray-600\">No Active Tests</h2>\n//         <p className=\"text-gray-500 mt-2\">Check back later for new assignments.</p>\n\n//         {/* Debug info */}\n//         <div className=\"mt-6 p-4 bg-gray-100 rounded text-xs text-left max-w-md\">\n//           <p><strong>Debug Info:</strong></p>\n//           <p>Token: {localStorage.getItem('token') ? 'Present' : 'Missing'}</p>\n//           <p>Device ID: {localStorage.getItem('deviceId') || 'Missing'}</p>\n//           <p>User ID: {localStorage.getItem('userId') || 'Missing'}</p>\n//           <p>Last checked: {new Date().toLocaleTimeString()}</p>\n//         </div>\n\n//         <button\n//           onClick={() => window.location.reload()}\n//           className=\"mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n//         >\n//           Refresh\n//         </button>\n//       </div>\n//     </div>\n//   );\n// };\n\n// export default TestContainer;\nvar _c, _c2;\n$RefreshReg$(_c, \"StudentTestComponent\");\n$RefreshReg$(_c2, \"TestContainer\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Clock","AlertTriangle","Send","Lock","Calculator","jsxDEV","_jsxDEV","Fragment","_Fragment","StudentTestComponent","testId","onTestComplete","socket","_s","_violations","API_URL","testData","setTestData","currentQuestionIndex","setCurrentQuestionIndex","answers","setAnswers","timeRemaining","setTimeRemaining","testStatus","setTestStatus","isFullscreen","setIsFullscreen","violations","setViolations","isSubmitting","setIsSubmitting","lateJoinTime","setLateJoinTime","testContainerRef","startTimeRef","timerRef","visibilityTimeoutRef","styleSheet","document","createElement","textContent","head","appendChild","removeChild","generateQuestions","testType","count","difficultyLevel","questions","i","question","correctAnswer","num1","num2","Math","floor","random","toString","product","push","type","options","fetchTestData","_testDetails$results","token","localStorage","getItem","deviceId","response","fetch","headers","ok","status","console","warn","Error","testDetails","json","now","Date","testStart","startTime","testEnd","getTime","duration","userId","existingResult","results","find","r","studentId","adjustedTimeRemaining","lateJoinSeconds","max","length","processedTestData","gameType","Array","fill","current","emit","_id","error","enterFullscreen","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","handleFullscreenChange","isCurrentlyFullscreen","Boolean","fullscreenElement","webkitFullscreenElement","msFullscreenElement","addViolation","handleAutoSubmit","addEventListener","removeEventListener","handleVisibilityChange","hidden","setTimeout","clearTimeout","handleBeforeUnload","event","preventDefault","returnValue","handlePopState","window","history","pushState","location","pathname","setInterval","prev","clearInterval","violation","newViolations","timestamp","toISOString","reason","log","submitTest","handleAnswerChange","questionIndex","value","newAnswers","trim","calculateScore","correct","total","score","forEach","index","_answers$index","_question$correctAnsw","userAnswer","toLowerCase","round","isAutoSubmit","_lastError","timeSpent","correctCount","submissionData","map","answer","isCorrect","totalQuestions","autoSubmitReason","submittedAt","attempt","maxAttempts","lastError","controller","AbortController","timeoutId","abort","method","body","JSON","stringify","signal","errorData","catch","message","result","exitFullscreen","webkitExitFullscreen","fsError","fetchError","name","includes","delay","pow","Promise","resolve","fallbackData","existingFallbacks","parse","setItem","alert","localError","formatTime","seconds","mins","secs","padStart","preventContextMenu","e","preventKeyboardShortcuts","ctrlKey","metaKey","altKey","key","startsWith","preventSelection","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","minHeight","background","display","alignItems","justifyContent","fontFamily","textAlign","backdropFilter","border","borderRadius","padding","maxWidth","boxShadow","width","height","color","margin","fontSize","fontWeight","letterSpacing","lineHeight","onClick","back","cursor","transition","gap","flexWrap","reload","marginBottom","currentQuestion","progress","ref","charAt","toUpperCase","slice","option","checked","onChange","target","placeholder","autoFocus","onKeyPress","allowedChars","test","disabled","filter","a","_","_answers$index2","_c","TestContainer","_s2","activeTest","setActiveTest","showTest","setShowTest","testResult","setTestResult","loading","setLoading","setError","checkForActiveTests","tests","currentTime","availableTests","handleTestLaunched","handleTestEnded","data","on","off","handleStartTest","handleTestComplete","borderTop","animation","id","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","isTestTime","isTestOver","start","end","toLocaleString","toLocaleTimeString","_c2","$RefreshReg$"],"sources":["A:/AI_LOGS/hosting_1/GIT_H3/FrontendX/src/components/admin/StudentTestComponent .js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\r\n\r\nconst StudentTestComponent = ({ testId, onTestComplete, socket }) => {\r\n  const API_URL = 'http://localhost:5000/api';\r\n  \r\n  const [testData, setTestData] = useState(null);\r\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\r\n  const [answers, setAnswers] = useState([]);\r\n  const [timeRemaining, setTimeRemaining] = useState(0);\r\n  const [testStatus, setTestStatus] = useState('loading');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [violations, setViolations] = useState([]);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [lateJoinTime, setLateJoinTime] = useState(0);\r\n  \r\n  const testContainerRef = useRef(null);\r\n  const startTimeRef = useRef(null);\r\n  const timerRef = useRef(null);\r\n  const visibilityTimeoutRef = useRef(null);\r\n\r\n  // Add CSS styles to head\r\n  useEffect(() => {\r\n    const styleSheet = document.createElement('style');\r\n    styleSheet.textContent = `\r\n      .test-container {\r\n        min-height: 100vh;\r\n        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n        display: flex;\r\n        flex-direction: column;\r\n        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n        user-select: none;\r\n        -webkit-user-select: none;\r\n        -moz-user-select: none;\r\n      }\r\n\r\n      .security-bar {\r\n        background: linear-gradient(135deg, #dc2626, #b91c1c);\r\n        color: white;\r\n        padding: 0.75rem 1.5rem;\r\n        font-size: 0.875rem;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        box-shadow: 0 4px 20px rgba(220, 38, 38, 0.3);\r\n      }\r\n\r\n      .security-left {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n      }\r\n\r\n      .security-right {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 1rem;\r\n      }\r\n\r\n      .security-badge {\r\n        padding: 0.25rem 0.75rem;\r\n        border-radius: 6px;\r\n        font-size: 0.75rem;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .security-badge-blue {\r\n        background: rgba(59, 130, 246, 0.2);\r\n        border: 1px solid rgba(59, 130, 246, 0.3);\r\n      }\r\n\r\n      .security-badge-red {\r\n        background: rgba(239, 68, 68, 0.2);\r\n        border: 1px solid rgba(239, 68, 68, 0.3);\r\n      }\r\n\r\n      .header {\r\n        background: rgba(255, 255, 255, 0.8);\r\n        backdrop-filter: blur(20px);\r\n        border-bottom: 1px solid rgba(226, 232, 240, 0.5);\r\n        padding: 1.5rem 2rem;\r\n        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);\r\n      }\r\n\r\n      .header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 1.5rem;\r\n      }\r\n\r\n      .header-title {\r\n        font-size: 1.5rem;\r\n        font-weight: 800;\r\n        color: #1f2937;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n        margin: 0;\r\n        letter-spacing: -0.025em;\r\n      }\r\n\r\n      .header-difficulty {\r\n        font-size: 0.875rem;\r\n        font-weight: 500;\r\n        color: #6b7280;\r\n        margin-left: 0.5rem;\r\n      }\r\n\r\n      .header-progress {\r\n        color: #6b7280;\r\n        font-size: 0.95rem;\r\n        margin: 0.25rem 0 0;\r\n        font-weight: 500;\r\n      }\r\n\r\n      .timer {\r\n        font-size: 2rem;\r\n        font-weight: 800;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n        margin-bottom: 0.25rem;\r\n      }\r\n\r\n      .timer-normal {\r\n        color: #3b82f6;\r\n      }\r\n\r\n      .timer-warning {\r\n        color: #f59e0b;\r\n      }\r\n\r\n      .timer-critical {\r\n        color: #ef4444;\r\n        animation: pulse 1s infinite;\r\n      }\r\n\r\n      .timer-label {\r\n        color: #6b7280;\r\n        font-size: 0.875rem;\r\n        margin: 0;\r\n        font-weight: 500;\r\n      }\r\n\r\n      .progress-container {\r\n        margin-top: 1rem;\r\n      }\r\n\r\n      .progress-bar {\r\n        width: 100%;\r\n        height: 8px;\r\n        background: linear-gradient(135deg, #e5e7eb, #d1d5db);\r\n        border-radius: 9999px;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .progress-fill {\r\n        height: 100%;\r\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n        border-radius: 9999px;\r\n        transition: width 0.3s ease;\r\n        box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);\r\n      }\r\n\r\n      .content {\r\n        flex: 1;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 2rem;\r\n      }\r\n\r\n      .question-card {\r\n        background: rgba(255, 255, 255, 0.95);\r\n        backdrop-filter: blur(20px);\r\n        border: 1px solid rgba(226, 232, 240, 0.5);\r\n        border-radius: 24px;\r\n        padding: 3rem 2.5rem;\r\n        width: 100%;\r\n        max-width: 800px;\r\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);\r\n      }\r\n\r\n      .question-section {\r\n        margin-bottom: 3rem;\r\n      }\r\n\r\n      .question-text {\r\n        font-size: 2.5rem;\r\n        font-weight: 800;\r\n        color: #1f2937;\r\n        text-align: center;\r\n        margin: 0 0 3rem;\r\n        letter-spacing: -0.025em;\r\n        background: linear-gradient(135deg, #1f2937, #374151);\r\n        -webkit-background-clip: text;\r\n        -webkit-text-fill-color: transparent;\r\n        background-clip: text;\r\n      }\r\n\r\n      .answer-section {\r\n        width: 100%;\r\n      }\r\n\r\n      .options-container {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 1rem;\r\n      }\r\n\r\n      .option {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 1.25rem 1.5rem;\r\n        background: linear-gradient(135deg, #f8fafc, #f1f5f9);\r\n        border: 2px solid transparent;\r\n        border-radius: 16px;\r\n        cursor: pointer;\r\n        transition: all 0.3s ease;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .option:hover {\r\n        background: linear-gradient(135deg, #e0e7ff, #c7d2fe);\r\n        border-color: rgba(99, 102, 241, 0.3);\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);\r\n      }\r\n\r\n      .option-input {\r\n        margin-right: 1rem;\r\n        width: 1.25rem;\r\n        height: 1.25rem;\r\n        accent-color: #3b82f6;\r\n      }\r\n\r\n      .option-text {\r\n        font-size: 1.125rem;\r\n        font-weight: 500;\r\n        color: #374151;\r\n      }\r\n\r\n      .input-container {\r\n        text-align: center;\r\n      }\r\n\r\n      .answer-input {\r\n        width: 100%;\r\n        padding: 2rem 1.5rem;\r\n        font-size: 2rem;\r\n        font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;\r\n        font-weight: 600;\r\n        text-align: center;\r\n        background: linear-gradient(135deg, #ffffff, #f8fafc);\r\n        border: 3px solid transparent;\r\n        border-radius: 20px;\r\n        outline: none;\r\n        transition: all 0.3s ease;\r\n        color: #1f2937;\r\n        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);\r\n      }\r\n\r\n      .answer-input:focus {\r\n        border-color: #3b82f6;\r\n        background: #ffffff;\r\n        box-shadow: 0 12px 40px rgba(59, 130, 246, 0.2);\r\n        transform: translateY(-2px);\r\n      }\r\n\r\n      .input-hint {\r\n        margin: 1rem 0 0;\r\n        color: #6b7280;\r\n        font-size: 0.95rem;\r\n        font-weight: 500;\r\n      }\r\n\r\n      .navigation {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        gap: 1rem;\r\n      }\r\n\r\n      .nav-button {\r\n        padding: 0.875rem 2rem;\r\n        border-radius: 14px;\r\n        font-weight: 600;\r\n        font-size: 1rem;\r\n        border: none;\r\n        cursor: pointer;\r\n        transition: all 0.3s ease;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n      }\r\n\r\n      .nav-button-prev {\r\n        background: linear-gradient(135deg, #6b7280, #4b5563);\r\n        color: white;\r\n      }\r\n\r\n      .nav-button-prev:hover:not(:disabled) {\r\n        background: linear-gradient(135deg, #4b5563, #374151);\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);\r\n      }\r\n\r\n      .nav-button-prev:disabled {\r\n        opacity: 0.4;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n\r\n      .nav-button-next {\r\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n        color: white;\r\n      }\r\n\r\n      .nav-button-next:hover {\r\n        background: linear-gradient(135deg, #2563eb, #1e40af);\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n      }\r\n\r\n      .nav-button-submit {\r\n        background: linear-gradient(135deg, #10b981, #047857);\r\n        color: white;\r\n      }\r\n\r\n      .nav-button-submit:hover:not(:disabled) {\r\n        background: linear-gradient(135deg, #059669, #065f46);\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);\r\n      }\r\n\r\n      .nav-button-submit:disabled {\r\n        opacity: 0.7;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n\r\n      .submit-spinner {\r\n        width: 1rem;\r\n        height: 1rem;\r\n        border: 2px solid rgba(255, 255, 255, 0.3);\r\n        border-top: 2px solid #ffffff;\r\n        border-radius: 50%;\r\n        animation: spin 1s linear infinite;\r\n      }\r\n\r\n      .progress-indicator {\r\n        color: #6b7280;\r\n        font-weight: 500;\r\n        font-size: 0.95rem;\r\n      }\r\n\r\n      .footer {\r\n        background: rgba(255, 255, 255, 0.8);\r\n        backdrop-filter: blur(20px);\r\n        border-top: 1px solid rgba(226, 232, 240, 0.5);\r\n        padding: 1.5rem 2rem;\r\n      }\r\n\r\n      .question-grid {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 0.75rem;\r\n        justify-content: center;\r\n      }\r\n\r\n      .question-number {\r\n        width: 3rem;\r\n        height: 3rem;\r\n        border-radius: 12px;\r\n        font-size: 0.95rem;\r\n        font-weight: 600;\r\n        border: 2px solid;\r\n        cursor: pointer;\r\n        transition: all 0.3s ease;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n\r\n      .question-number-current {\r\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n        color: white;\r\n        border-color: #3b82f6;\r\n        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);\r\n      }\r\n\r\n      .question-number-answered {\r\n        background: linear-gradient(135deg, #d1fae5, #a7f3d0);\r\n        color: #065f46;\r\n        border-color: #10b981;\r\n      }\r\n\r\n      .question-number-unanswered {\r\n        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);\r\n        color: #6b7280;\r\n        border-color: #d1d5db;\r\n      }\r\n\r\n      .question-number:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\r\n      }\r\n\r\n      .modal-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0, 0, 0, 0.6);\r\n        backdrop-filter: blur(8px);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 1000;\r\n        padding: 1rem;\r\n      }\r\n\r\n      .modal-card {\r\n        background: #ffffff;\r\n        border-radius: 24px;\r\n        padding: 2rem;\r\n        max-width: 500px;\r\n        width: 100%;\r\n        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);\r\n      }\r\n\r\n      .modal-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 1rem;\r\n        margin-bottom: 1.5rem;\r\n      }\r\n\r\n      .modal-title {\r\n        font-size: 1.25rem;\r\n        font-weight: 700;\r\n        color: #dc2626;\r\n        margin: 0;\r\n      }\r\n\r\n      .modal-text {\r\n        color: #374151;\r\n        line-height: 1.6;\r\n        margin: 0 0 1.5rem;\r\n      }\r\n\r\n      .violation-details {\r\n        background: linear-gradient(135deg, #fef2f2, #fee2e2);\r\n        border: 1px solid #fecaca;\r\n        border-radius: 12px;\r\n        padding: 1rem;\r\n        margin-bottom: 2rem;\r\n      }\r\n\r\n      .violation-latest {\r\n        color: #dc2626;\r\n        font-size: 0.9rem;\r\n        margin: 0 0 0.5rem;\r\n      }\r\n\r\n      .violation-count {\r\n        color: #b91c1c;\r\n        font-size: 0.9rem;\r\n        margin: 0 0 0.5rem;\r\n      }\r\n\r\n      .violation-warning {\r\n        color: #7f1d1d;\r\n        font-size: 0.9rem;\r\n        font-weight: 600;\r\n        margin: 0.5rem 0 0;\r\n      }\r\n\r\n      .modal-actions {\r\n        text-align: right;\r\n      }\r\n\r\n      .modal-button {\r\n        background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n        color: white;\r\n        padding: 0.75rem 2rem;\r\n        border-radius: 12px;\r\n        font-weight: 600;\r\n        border: none;\r\n        cursor: pointer;\r\n        transition: all 0.3s ease;\r\n      }\r\n\r\n      .modal-button:hover {\r\n        background: linear-gradient(135deg, #2563eb, #1e40af);\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n      }\r\n\r\n      .loading-container {\r\n        min-height: 100vh;\r\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n      }\r\n\r\n      .loading-content {\r\n        text-align: center;\r\n        background: rgba(255, 255, 255, 0.1);\r\n        backdrop-filter: blur(20px);\r\n        border: 1px solid rgba(255, 255, 255, 0.2);\r\n        border-radius: 20px;\r\n        padding: 3rem 2rem;\r\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\r\n      }\r\n\r\n      .loading-spinner {\r\n        width: 48px;\r\n        height: 48px;\r\n        border: 4px solid rgba(255, 255, 255, 0.3);\r\n        border-top: 4px solid #ffffff;\r\n        border-radius: 50%;\r\n        animation: spin 1s linear infinite;\r\n        margin: 0 auto 1.5rem;\r\n      }\r\n\r\n      .loading-title {\r\n        font-size: 1.5rem;\r\n        font-weight: 600;\r\n        color: #ffffff;\r\n        margin: 0 0 0.5rem;\r\n        letter-spacing: -0.025em;\r\n      }\r\n\r\n      .loading-subtitle {\r\n        color: rgba(255, 255, 255, 0.8);\r\n        font-size: 0.95rem;\r\n        margin: 0;\r\n      }\r\n\r\n      @keyframes spin {\r\n        0% { transform: rotate(0deg); }\r\n        100% { transform: rotate(360deg); }\r\n      }\r\n\r\n      @keyframes pulse {\r\n        0%, 100% { opacity: 1; }\r\n        50% { opacity: 0.7; }\r\n      }\r\n\r\n      @media (max-width: 768px) {\r\n        .header {\r\n          padding: 1rem 1.5rem;\r\n        }\r\n        \r\n        .header-content {\r\n          flex-direction: column;\r\n          gap: 1rem;\r\n          text-align: center;\r\n        }\r\n        \r\n        .question-text {\r\n          font-size: 1.75rem;\r\n        }\r\n        \r\n        .answer-input {\r\n          font-size: 1.5rem;\r\n          padding: 1.5rem 1rem;\r\n        }\r\n        \r\n        .navigation {\r\n          flex-direction: column;\r\n          gap: 1rem;\r\n        }\r\n        \r\n        .nav-button {\r\n          width: 100%;\r\n          justify-content: center;\r\n        }\r\n        \r\n        .question-grid {\r\n          gap: 0.5rem;\r\n        }\r\n        \r\n        .question-number {\r\n          width: 2.5rem;\r\n          height: 2.5rem;\r\n          font-size: 0.875rem;\r\n        }\r\n      }\r\n\r\n      @media (max-width: 480px) {\r\n        .content {\r\n          padding: 1rem;\r\n        }\r\n        \r\n        .question-card {\r\n          padding: 2rem 1.5rem;\r\n        }\r\n        \r\n        .security-bar {\r\n          padding: 0.5rem 1rem;\r\n          font-size: 0.8rem;\r\n        }\r\n        \r\n        .timer {\r\n          font-size: 1.5rem;\r\n        }\r\n        \r\n        .header-title {\r\n          font-size: 1.25rem;\r\n        }\r\n      }\r\n    `;\r\n    document.head.appendChild(styleSheet);\r\n    \r\n    return () => {\r\n      document.head.removeChild(styleSheet);\r\n    };\r\n  }, []);\r\n\r\n  // Generate math questions based on test parameters\r\n  const generateQuestions = (testType, count, difficultyLevel) => {\r\n    const questions = [];\r\n    \r\n    for (let i = 0; i < count; i++) {\r\n      let question, correctAnswer;\r\n      let num1, num2;\r\n      \r\n      // Set difficulty ranges\r\n      switch (difficultyLevel) {\r\n        case 'easy':\r\n          num1 = Math.floor(Math.random() * 10) + 1;\r\n          num2 = Math.floor(Math.random() * 10) + 1;\r\n          break;\r\n        case 'medium':\r\n          num1 = Math.floor(Math.random() * 50) + 1;\r\n          num2 = Math.floor(Math.random() * 50) + 1;\r\n          break;\r\n        case 'double':\r\n          num1 = Math.floor(Math.random() * 99) + 1;\r\n          num2 = Math.floor(Math.random() * 99) + 1;\r\n          break;\r\n        default:\r\n          num1 = Math.floor(Math.random() * 20) + 1;\r\n          num2 = Math.floor(Math.random() * 20) + 1;\r\n      }\r\n      \r\n      // Generate based on test type\r\n      switch (testType) {\r\n        case 'multiplication':\r\n          question = `${num1} √ó ${num2} = ?`;\r\n          correctAnswer = (num1 * num2).toString();\r\n          break;\r\n        case 'addition':\r\n          question = `${num1} + ${num2} = ?`;\r\n          correctAnswer = (num1 + num2).toString();\r\n          break;\r\n        case 'subtraction':\r\n          // Ensure positive result\r\n          if (num1 < num2) [num1, num2] = [num2, num1];\r\n          question = `${num1} - ${num2} = ?`;\r\n          correctAnswer = (num1 - num2).toString();\r\n          break;\r\n        case 'division':\r\n          // Ensure whole number division\r\n          const product = num1 * num2;\r\n          question = `${product} √∑ ${num1} = ?`;\r\n          correctAnswer = num2.toString();\r\n          break;\r\n        default:\r\n          question = `${num1} √ó ${num2} = ?`;\r\n          correctAnswer = (num1 * num2).toString();\r\n      }\r\n      \r\n      questions.push({\r\n        question,\r\n        correctAnswer,\r\n        type: testType,\r\n        options: [] // Empty for math problems (text input)\r\n      });\r\n    }\r\n    \r\n    return questions;\r\n  };\r\n\r\n  // Fetch test data from your existing backend\r\n  useEffect(() => {\r\n    const fetchTestData = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const deviceId = localStorage.getItem('deviceId');\r\n\r\n        if (!token) {\r\n          setTestStatus('error');\r\n          return;\r\n        }\r\n\r\n        // Fetch the test details first\r\n        const response = await fetch(`${API_URL}/student/tests/${testId}`, {\r\n          headers: {\r\n            'Authorization': token,\r\n            'X-Device-Id': deviceId,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        if (!response.ok) {\r\n          if (response.status === 404) {\r\n            setTestStatus('no-test');\r\n            console.warn('Test not found or inactive');\r\n            return;\r\n          }\r\n          throw new Error('Failed to load test');\r\n        }\r\n\r\n        const testDetails = await response.json();\r\n        \r\n        // Check if test is still active and not past end time\r\n        const now = new Date();\r\n        const testStart = new Date(testDetails.startTime);\r\n        const testEnd = new Date(testStart.getTime() + (testDetails.duration * 60 * 1000));\r\n        \r\n        if (now > testEnd) {\r\n          setTestStatus('test-ended');\r\n          return;\r\n        }\r\n\r\n        // Check if student already submitted\r\n        const userId = localStorage.getItem('userId') || 'anonymous';\r\n        const existingResult = testDetails.results?.find(r => r.studentId === userId);\r\n        if (existingResult) {\r\n          setTestStatus('already-submitted');\r\n          return;\r\n        }\r\n\r\n        // Calculate late join time if applicable\r\n        let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\r\n        let lateJoinSeconds = 0;\r\n        \r\n        if (now > testStart) {\r\n          lateJoinSeconds = Math.floor((now - testStart) / 1000);\r\n          adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\r\n          setLateJoinTime(lateJoinSeconds);\r\n        }\r\n\r\n        // Generate questions if not provided\r\n        let questions = testDetails.questions || [];\r\n        if (questions.length === 0) {\r\n          questions = generateQuestions(\r\n            testDetails.testType, \r\n            testDetails.count, \r\n            testDetails.difficultyLevel\r\n          );\r\n        }\r\n\r\n        const processedTestData = {\r\n          ...testDetails,\r\n          questions,\r\n          gameType: testDetails.testType // For compatibility\r\n        };\r\n\r\n        setTestData(processedTestData);\r\n        setTimeRemaining(adjustedTimeRemaining);\r\n        setAnswers(new Array(questions.length).fill(''));\r\n        setTestStatus('active');\r\n        startTimeRef.current = Date.now();\r\n        \r\n        // Notify admin via socket\r\n        socket?.emit('test-started', { \r\n          testId: testDetails._id,\r\n          studentId: userId,\r\n          lateJoinSeconds\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error('Error loading test:', error);\r\n        setTestStatus('error');\r\n      }\r\n    };\r\n\r\n    if (testId) {\r\n      fetchTestData();\r\n    }\r\n  }, [testId, socket, API_URL]);\r\n\r\n  // Enhanced fullscreen handling\r\n  useEffect(() => {\r\n    const enterFullscreen = async () => {\r\n      try {\r\n        if (testContainerRef.current && !isFullscreen) {\r\n          if (testContainerRef.current.requestFullscreen) {\r\n            await testContainerRef.current.requestFullscreen();\r\n          } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n            await testContainerRef.current.webkitRequestFullscreen();\r\n          } else if (testContainerRef.current.msRequestFullscreen) {\r\n            await testContainerRef.current.msRequestFullscreen();\r\n          }\r\n          setIsFullscreen(true);\r\n        }\r\n      } catch (error) {\r\n        console.warn('Fullscreen not supported:', error);\r\n        // Continue test even without fullscreen\r\n      }\r\n    };\r\n\r\n    if (testStatus === 'active' && testContainerRef.current) {\r\n      enterFullscreen();\r\n    }\r\n  }, [testStatus]);\r\n\r\n  // Handle fullscreen changes with stricter enforcement\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      const isCurrentlyFullscreen = Boolean(\r\n        document.fullscreenElement || \r\n        document.webkitFullscreenElement || \r\n        document.msFullscreenElement\r\n      );\r\n      setIsFullscreen(isCurrentlyFullscreen);\r\n      \r\n      if (!isCurrentlyFullscreen && testStatus === 'active') {\r\n        addViolation('Exited fullscreen mode');\r\n        \r\n        // Try to re-enter fullscreen immediately\r\n        if (testContainerRef.current) {\r\n          const enterFullscreen = async () => {\r\n            try {\r\n              if (testContainerRef.current.requestFullscreen) {\r\n                await testContainerRef.current.requestFullscreen();\r\n              } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n                await testContainerRef.current.webkitRequestFullscreen();\r\n              }\r\n            } catch (error) {\r\n              // If can't re-enter after 3 violations, auto-submit\r\n              if (violations.length >= 2) {\r\n                handleAutoSubmit('Multiple fullscreen violations');\r\n              }\r\n            }\r\n          };\r\n          enterFullscreen();\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n    document.addEventListener('msfullscreenchange', handleFullscreenChange);\r\n    \r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n      document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n      document.removeEventListener('msfullscreenchange', handleFullscreenChange);\r\n    };\r\n  }, [testStatus, violations]);\r\n\r\n  // Enhanced visibility handling\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden && testStatus === 'active') {\r\n        addViolation('Switched to another tab/window');\r\n        \r\n        // Shorter timeout for tab switching - 3 seconds\r\n        visibilityTimeoutRef.current = setTimeout(() => {\r\n          if (document.hidden) {\r\n            handleAutoSubmit('Tab switching violation - remained hidden');\r\n          }\r\n        }, 3000);\r\n      } else if (!document.hidden && visibilityTimeoutRef.current) {\r\n        clearTimeout(visibilityTimeoutRef.current);\r\n        visibilityTimeoutRef.current = null;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      if (visibilityTimeoutRef.current) {\r\n        clearTimeout(visibilityTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [testStatus]);\r\n\r\n  // Enhanced browser navigation prevention\r\n  useEffect(() => {\r\n    const handleBeforeUnload = (event) => {\r\n      if (testStatus === 'active') {\r\n        event.preventDefault();\r\n        event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\r\n        return event.returnValue;\r\n      }\r\n    };\r\n\r\n    const handlePopState = (event) => {\r\n      if (testStatus === 'active') {\r\n        event.preventDefault();\r\n        window.history.pushState(null, '', window.location.pathname);\r\n        addViolation('Browser navigation attempt');\r\n        handleAutoSubmit('Navigation attempt during test');\r\n      }\r\n    };\r\n\r\n    // Push current state to prevent back navigation\r\n    window.history.pushState(null, '', window.location.pathname);\r\n    \r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    window.addEventListener('popstate', handlePopState);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n      window.removeEventListener('popstate', handlePopState);\r\n    };\r\n  }, [testStatus]);\r\n\r\n  // Timer countdown with auto-submit\r\n  useEffect(() => {\r\n    if (testStatus === 'active' && timeRemaining > 0) {\r\n      timerRef.current = setInterval(() => {\r\n        setTimeRemaining(prev => {\r\n          if (prev <= 1) {\r\n            handleAutoSubmit('Time expired');\r\n            return 0;\r\n          }\r\n          return prev - 1;\r\n        });\r\n      }, 1000);\r\n\r\n      return () => {\r\n        if (timerRef.current) {\r\n          clearInterval(timerRef.current);\r\n        }\r\n      };\r\n    }\r\n  }, [testStatus, timeRemaining]);\r\n\r\n  // Send progress updates to admin\r\n  // useEffect(() => {\r\n  //   if (testStatus === 'active' && socket) {\r\n  //     const progressInterval = setInterval(() => {\r\n  //       const answeredCount = answers.filter(a => a.trim() !== '').length;\r\n  //       const progress = (answeredCount / answers.length) * 100;\r\n        \r\n  //       socket.emit('test-progress', {\r\n  //         testId,\r\n  //         studentId: localStorage.getItem('userId') || 'anonymous',\r\n  //         progress: Math.round(progress),\r\n  //         currentQuestion: currentQuestionIndex + 1,\r\n  //         answeredQuestions: answeredCount,\r\n  //         timeRemaining\r\n  //       });\r\n  //     }, 5000);\r\n\r\n  //     return () => clearInterval(progressInterval);\r\n  //   }\r\n  // }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\r\n\r\n  const addViolation = (violation) => {\r\n    setViolations(prev => {\r\n      const newViolations = [...prev, {\r\n        type: violation,\r\n        timestamp: new Date().toISOString()\r\n      }];\r\n      \r\n      // Auto-submit after 3 violations\r\n      if (newViolations.length >= 3) {\r\n        setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\r\n      }\r\n      \r\n      return newViolations;\r\n    });\r\n  };\r\n\r\n  const handleAutoSubmit = async (reason) => {\r\n    if (isSubmitting) return;\r\n    \r\n    console.log(`Auto-submitting test: ${reason}`);\r\n    await submitTest(true, reason);\r\n  };\r\n\r\n  const handleAnswerChange = (questionIndex, value) => {\r\n    const newAnswers = [...answers];\r\n    newAnswers[questionIndex] = value.trim();\r\n    setAnswers(newAnswers);\r\n  };\r\n\r\n  const calculateScore = () => {\r\n    if (!testData) return { correct: 0, total: 0, score: 0 };\r\n    \r\n    let correct = 0;\r\n    testData.questions.forEach((question, index) => {\r\n      const userAnswer = answers[index]?.trim().toLowerCase();\r\n      const correctAnswer = question.correctAnswer?.trim().toLowerCase();\r\n      \r\n      if (userAnswer === correctAnswer) {\r\n        correct++;\r\n      }\r\n    });\r\n    \r\n    const total = testData.questions.length;\r\n    const score = total > 0 ? Math.round((correct / total) * 100) : 0;\r\n    \r\n    return { correct, total, score };\r\n  };\r\n\r\n  // const submitTest = async (isAutoSubmit = false, reason = '') => {\r\n  //   if (isSubmitting) return;\r\n    \r\n  //   setIsSubmitting(true);\r\n    \r\n  //   try {\r\n  //     const { correct, total, score } = calculateScore();\r\n  //     const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\r\n  //     const token = localStorage.getItem('token');\r\n  //     const deviceId = localStorage.getItem('deviceId');\r\n  //     const userId = localStorage.getItem('userId') || 'anonymous';\r\n\r\n  //     const submissionData = {\r\n  //       studentId: userId,\r\n  //       answers: answers.map((answer, index) => ({\r\n  //         questionIndex: index,\r\n  //         question: testData.questions[index].question,\r\n  //         userAnswer: answer,\r\n  //         correctAnswer: testData.questions[index].correctAnswer,\r\n  //         isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\r\n  //       })),\r\n  //       correctCount: correct,\r\n  //       totalQuestions: total,\r\n  //       score,\r\n  //       timeSpent,\r\n  //       lateJoinTime,\r\n  //       violations,\r\n  //       isAutoSubmit,\r\n  //       autoSubmitReason: reason,\r\n  //       submittedAt: new Date().toISOString()\r\n  //     };\r\n\r\n  //     const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\r\n  //       method: 'POST',\r\n  //       headers: {\r\n  //         'Authorization': token,\r\n  //         'X-Device-Id': deviceId,\r\n  //         'Content-Type': 'application/json'\r\n  //       },\r\n  //       body: JSON.stringify(submissionData)\r\n  //     });\r\n\r\n  //     if (!response.ok) {\r\n  //       throw new Error(`Submission failed: ${response.status}`);\r\n  //     }\r\n\r\n  //     // Update performance data if API exists\r\n  //     try {\r\n  //       const performanceUpdate = {\r\n  //         totalGames: 1,\r\n  //         totalCorrect: correct,\r\n  //         totalScore: score,\r\n  //         gameType: testData.testType,\r\n  //         difficulty: testData.difficultyLevel || 'medium',\r\n  //         speed: 2,\r\n  //         count: total\r\n  //       };\r\n\r\n  //       await fetch(`${API_URL}/performance/${userId}`, {\r\n  //         method: 'POST',\r\n  //         headers: {\r\n  //           'Authorization': token,\r\n  //           'X-Device-Id': deviceId,\r\n  //           'Content-Type': 'application/json'\r\n  //         },\r\n  //         body: JSON.stringify(performanceUpdate)\r\n  //       });\r\n  //     } catch (perfError) {\r\n  //       console.warn('Performance update failed:', perfError);\r\n  //       // Continue even if performance update fails\r\n  //     }\r\n\r\n  //     // Notify admin via socket\r\n  //     socket?.emit('test-submitted', {\r\n  //       testId,\r\n  //       studentId: userId,\r\n  //       score,\r\n  //       correctCount: correct,\r\n  //       totalQuestions: total,\r\n  //       isAutoSubmit,\r\n  //       reason,\r\n  //       timeSpent,\r\n  //       violations: violations.length\r\n  //     });\r\n\r\n  //     setTestStatus('submitted');\r\n\r\n  //     // Exit fullscreen\r\n  //     if (document.fullscreenElement) {\r\n  //       document.exitFullscreen();\r\n  //     } else if (document.webkitFullscreenElement) {\r\n  //       document.webkitExitFullscreen();\r\n  //     } else if (document.msExitFullscreen) {\r\n  //       document.msExitFullscreen();\r\n  //     }\r\n\r\n  //     // Call completion callback\r\n  //     onTestComplete?.({\r\n  //       score,\r\n  //       correct,\r\n  //       total,\r\n  //       isAutoSubmit,\r\n  //       reason,\r\n  //       timeSpent,\r\n  //       violations: violations.length\r\n  //     });\r\n\r\n  //   } catch (error) {\r\n  //     console.error('Error submitting test:', error);\r\n      \r\n  //     // Fallback: save to localStorage\r\n  //     try {\r\n  //       const { correct, total, score } = calculateScore();\r\n  //       const fallbackData = {\r\n  //         testId,\r\n  //         score,\r\n  //         correct,\r\n  //         total,\r\n  //         submittedAt: new Date().toISOString(),\r\n  //         isAutoSubmit,\r\n  //         reason\r\n  //       };\r\n        \r\n  //       const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\r\n  //       existingFallbacks.push(fallbackData);\r\n  //       localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\r\n        \r\n  //       console.log('Test saved to localStorage as fallback');\r\n  //     } catch (localError) {\r\n  //       console.error('Error saving fallback:', localError);\r\n  //     }\r\n      \r\n  //     setTestStatus('error');\r\n  //   } finally {\r\n  //     setIsSubmitting(false);\r\n  //   }\r\n  // };\r\n\r\n  // ‚úÖ FIXED: Test submission with retry logic and better error handling\r\nconst submitTest = async (isAutoSubmit = false, reason = '') => {\r\n  if (isSubmitting) return;\r\n  \r\n  setIsSubmitting(true);\r\n  \r\n  try {\r\n    const { correct, total, score } = calculateScore();\r\n    const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\r\n    const token = localStorage.getItem('token');\r\n    const deviceId = localStorage.getItem('deviceId');\r\n    const userId = localStorage.getItem('userId') || 'anonymous';\r\n\r\n    console.log('üì§ Submitting test:', { testId, score, correctCount: correct, timeSpent });\r\n\r\n    // ‚úÖ Prepare minimal submission data\r\n    const submissionData = {\r\n      studentId: userId,\r\n      answers: answers.map((answer, index) => ({\r\n        questionIndex: index,\r\n        question: testData.questions[index].question,\r\n        userAnswer: answer,\r\n        correctAnswer: testData.questions[index].correctAnswer,\r\n        isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\r\n      })),\r\n      correctCount: correct,\r\n      totalQuestions: total,\r\n      score,\r\n      timeSpent,\r\n      lateJoinTime,\r\n      violations,\r\n      isAutoSubmit,\r\n      autoSubmitReason: reason,\r\n      submittedAt: new Date().toISOString()\r\n    };\r\n\r\n    // ‚úÖ Retry logic with exponential backoff\r\n    let attempt = 0;\r\n    const maxAttempts = 3;\r\n    let lastError = null;\r\n\r\n    while (attempt < maxAttempts) {\r\n      try {\r\n        console.log(`üîÑ Submission attempt ${attempt + 1}/${maxAttempts}`);\r\n\r\n        // ‚úÖ Create AbortController for timeout\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 20000); // 20 second timeout\r\n\r\n        const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': token,\r\n            'X-Device-Id': deviceId,\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify(submissionData),\r\n          signal: controller.signal\r\n        });\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        if (!response.ok) {\r\n          const errorData = await response.json().catch(() => ({}));\r\n          throw new Error(errorData.message || `Submission failed: ${response.status}`);\r\n        }\r\n\r\n        const result = await response.json();\r\n        console.log('‚úÖ Test submitted successfully:', result);\r\n\r\n        // ‚úÖ Success - notify admin via socket\r\n        socket?.emit('test-submitted', {\r\n          testId,\r\n          studentId: userId,\r\n          score,\r\n          correctCount: correct,\r\n          totalQuestions: total,\r\n          isAutoSubmit,\r\n          reason,\r\n          timeSpent,\r\n          violations: violations.length\r\n        });\r\n\r\n        setTestStatus('submitted');\r\n\r\n        // Exit fullscreen\r\n        try {\r\n          if (document.fullscreenElement) {\r\n            await document.exitFullscreen();\r\n          } else if (document.webkitFullscreenElement) {\r\n            await document.webkitExitFullscreen();\r\n          }\r\n        } catch (fsError) {\r\n          console.warn('Fullscreen exit error:', fsError);\r\n        }\r\n\r\n        // Call completion callback\r\n        onTestComplete?.({\r\n          score,\r\n          correct,\r\n          total,\r\n          isAutoSubmit,\r\n          reason,\r\n          timeSpent,\r\n          violations: violations.length\r\n        });\r\n\r\n        return; // Success - exit function\r\n\r\n      } catch (fetchError) {\r\n        lastError = fetchError;\r\n        console.error(`‚ùå Attempt ${attempt + 1} failed:`, fetchError.message);\r\n\r\n        if (fetchError.name === 'AbortError') {\r\n          console.log('‚è±Ô∏è Request timed out');\r\n        }\r\n\r\n        // Don't retry on certain errors\r\n        if (fetchError.message.includes('already submitted')) {\r\n          console.log('‚ö†Ô∏è Test already submitted - treating as success');\r\n          setTestStatus('submitted');\r\n          onTestComplete?.({ score, correct, total, isAutoSubmit, reason, timeSpent, violations: violations.length });\r\n          return;\r\n        }\r\n\r\n        attempt++;\r\n        \r\n        if (attempt < maxAttempts) {\r\n          // Exponential backoff: 1s, 2s, 4s\r\n          const delay = Math.pow(2, attempt) * 1000;\r\n          console.log(`‚è≥ Waiting ${delay}ms before retry...`);\r\n          await new Promise(resolve => setTimeout(resolve, delay));\r\n        }\r\n      }\r\n    }\r\n\r\n    // ‚úÖ All retries failed - save to localStorage as fallback\r\n    throw new Error(lastError?.message || 'Max retries exceeded');\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Final submission error:', error);\r\n    \r\n    // ‚úÖ Fallback: Save to localStorage\r\n    try {\r\n      const { correct, total, score } = calculateScore();\r\n      const fallbackData = {\r\n        testId,\r\n        studentId: localStorage.getItem('userId'),\r\n        score,\r\n        correctCount: correct,\r\n        totalQuestions: total,\r\n        answers: answers.map((answer, index) => ({\r\n          question: testData.questions[index].question,\r\n          userAnswer: answer,\r\n          correctAnswer: testData.questions[index].correctAnswer\r\n        })),\r\n        submittedAt: new Date().toISOString(),\r\n        isAutoSubmit,\r\n        reason,\r\n        timeSpent: Math.round((Date.now() - startTimeRef.current) / 1000),\r\n        violations,\r\n        status: 'pending-sync'\r\n      };\r\n      \r\n      const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\r\n      existingFallbacks.push(fallbackData);\r\n      localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\r\n      \r\n      console.log('üíæ Test saved to localStorage as fallback');\r\n      \r\n      // Show user-friendly message\r\n      alert(\r\n        'Test saved locally!\\n\\n' +\r\n        'Your answers have been saved on this device. ' +\r\n        'Please inform your teacher about this submission.\\n\\n' +\r\n        `Score: ${score}% (${correct}/${total} correct)`\r\n      );\r\n      \r\n      setTestStatus('submitted');\r\n      onTestComplete?.({ score, correct, total, isAutoSubmit, reason, timeSpent: fallbackData.timeSpent, violations: violations.length });\r\n      \r\n    } catch (localError) {\r\n      console.error('‚ùå Error saving fallback:', localError);\r\n      setTestStatus('error');\r\n    }\r\n  } finally {\r\n    setIsSubmitting(false);\r\n  }\r\n};\r\n\r\n  const formatTime = (seconds) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  // Enhanced keyboard and mouse prevention\r\n  useEffect(() => {\r\n    const preventContextMenu = (e) => {\r\n      if (testStatus === 'active') {\r\n        e.preventDefault();\r\n        addViolation('Right-click attempt');\r\n        return false;\r\n      }\r\n    };\r\n\r\n    const preventKeyboardShortcuts = (e) => {\r\n      if (testStatus === 'active') {\r\n        // Prevent common shortcuts\r\n        if (e.ctrlKey || e.metaKey || e.altKey) {\r\n          e.preventDefault();\r\n          addViolation('Keyboard shortcut attempt');\r\n          return false;\r\n        }\r\n        \r\n        // Prevent function keys\r\n        if (e.key.startsWith('F') && e.key.length > 1) {\r\n          e.preventDefault();\r\n          addViolation('Function key attempt');\r\n          return false;\r\n        }\r\n      }\r\n    };\r\n\r\n    const preventSelection = (e) => {\r\n      if (testStatus === 'active') {\r\n        e.preventDefault();\r\n        return false;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('contextmenu', preventContextMenu);\r\n    document.addEventListener('keydown', preventKeyboardShortcuts);\r\n    document.addEventListener('selectstart', preventSelection);\r\n    document.addEventListener('dragstart', preventSelection);\r\n\r\n    return () => {\r\n      document.removeEventListener('contextmenu', preventContextMenu);\r\n      document.removeEventListener('keydown', preventKeyboardShortcuts);\r\n      document.removeEventListener('selectstart', preventSelection);\r\n      document.removeEventListener('dragstart', preventSelection);\r\n    };\r\n  }, [testStatus]);\r\n\r\n  // Status screens\r\n  if (testStatus === 'loading') {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-content\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <h2 className=\"loading-title\">Loading Test...</h2>\r\n          <p className=\"loading-subtitle\">Preparing your exam questions</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (testStatus === 'no-test') {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(255, 255, 255, 0.3)', borderRadius: '24px', padding: '3rem 2rem', maxWidth: '400px', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)' }}>\r\n          <Clock style={{ width: '4rem', height: '4rem', color: '#3b82f6', margin: '0 auto 1.5rem', display: 'block' }} />\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1f2937', margin: '0 0 0.75rem', letterSpacing: '-0.025em' }}>Test Not Found</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem', lineHeight: 1.6 }}>The requested test could not be found or is not available.</p>\r\n          <button onClick={() => window.history.back()} style={{ padding: '0.75rem 2rem', borderRadius: '12px', fontWeight: 600, fontSize: '0.95rem', border: 'none', cursor: 'pointer', transition: 'all 0.2s', background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white' }}>\r\n            Go Back\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (testStatus === 'test-ended') {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(255, 255, 255, 0.3)', borderRadius: '24px', padding: '3rem 2rem', maxWidth: '400px', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)' }}>\r\n          <AlertTriangle style={{ width: '4rem', height: '4rem', color: '#f59e0b', margin: '0 auto 1.5rem', display: 'block' }} />\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1f2937', margin: '0 0 0.75rem', letterSpacing: '-0.025em' }}>Test Time Expired</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem', lineHeight: 1.6 }}>The time limit for this test has already passed.</p>\r\n          <button onClick={() => window.history.back()} style={{ padding: '0.75rem 2rem', borderRadius: '12px', fontWeight: 600, fontSize: '0.95rem', border: 'none', cursor: 'pointer', transition: 'all 0.2s', background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white' }}>\r\n            Go Back\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (testStatus === 'already-submitted') {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #10b981 0%, #047857 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(255, 255, 255, 0.3)', borderRadius: '24px', padding: '3rem 2rem', maxWidth: '400px', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)' }}>\r\n          <Send style={{ width: '4rem', height: '4rem', color: '#10b981', margin: '0 auto 1.5rem', display: 'block' }} />\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1f2937', margin: '0 0 0.75rem', letterSpacing: '-0.025em' }}>Test Already Submitted</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem', lineHeight: 1.6 }}>You have already completed this test successfully.</p>\r\n          <button onClick={() => window.history.back()} style={{ padding: '0.75rem 2rem', borderRadius: '12px', fontWeight: 600, fontSize: '0.95rem', border: 'none', cursor: 'pointer', transition: 'all 0.2s', background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white' }}>\r\n            Go Back\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (testStatus === 'error') {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(255, 255, 255, 0.3)', borderRadius: '24px', padding: '3rem 2rem', maxWidth: '400px', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)' }}>\r\n          <AlertTriangle style={{ width: '4rem', height: '4rem', color: '#ef4444', margin: '0 auto 1.5rem', display: 'block' }} />\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#dc2626', margin: '0 0 0.75rem', letterSpacing: '-0.025em' }}>Test Error</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem', lineHeight: 1.6 }}>Unable to load or submit the test. Please contact your teacher.</p>\r\n          <div style={{ display: 'flex', gap: '0.75rem', justifyContent: 'center', flexWrap: 'wrap' }}>\r\n            <button onClick={() => window.location.reload()} style={{ padding: '0.75rem 1.5rem', borderRadius: '10px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.2s', background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white' }}>\r\n              Try Again\r\n            </button>\r\n            <button onClick={() => window.history.back()} style={{ padding: '0.75rem 1.5rem', borderRadius: '10px', fontWeight: 600, border: '1px solid rgba(107, 114, 128, 0.3)', cursor: 'pointer', transition: 'all 0.2s', background: 'rgba(107, 114, 128, 0.1)', color: '#374151' }}>\r\n              Go Back\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (testStatus === 'submitted') {\r\n    const { correct, total, score } = calculateScore();\r\n    \r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #10b981 0%, #047857 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(255, 255, 255, 0.3)', borderRadius: '24px', padding: '3rem 2rem', maxWidth: '400px', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.15)' }}>\r\n          <div style={{ width: '4rem', height: '4rem', borderRadius: '50%', background: 'rgba(0, 0, 0, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 2rem' }}>\r\n            <Send style={{ color: '#10b981', width: '2rem', height: '2rem' }} />\r\n          </div>\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1f2937', margin: '0 0 1rem' }}>Test Submitted Successfully!</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem' }}>Your test has been submitted and saved.</p>\r\n          \r\n          <div style={{ background: 'rgba(0, 0, 0, 0.05)', borderRadius: '12px', padding: '1rem', margin: '0 0 1.5rem' }}>\r\n            <div style={{ fontSize: '2rem', fontWeight: 600, color: '#10b981', marginBottom: '0.5rem' }}>{score}%</div>\r\n            <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>\r\n              {correct} out of {total} questions correct\r\n            </div>\r\n          </div>\r\n          \r\n          {lateJoinTime > 0 && (\r\n            <div style={{ background: 'rgba(59, 130, 246, 0.1)', border: '1px solid rgba(59, 130, 246, 0.3)', borderRadius: '8px', padding: '0.75rem', margin: '0 0 1rem' }}>\r\n              <p style={{ fontSize: '0.875rem', color: '#1e40af', margin: 0 }}>\r\n                You joined {Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')} late\r\n              </p>\r\n            </div>\r\n          )}\r\n          \r\n          {violations.length > 0 && (\r\n            <div style={{ background: 'rgba(245, 158, 11, 0.1)', border: '1px solid rgba(245, 158, 11, 0.3)', borderRadius: '8px', padding: '0.75rem', margin: '0 0 1rem' }}>\r\n              <p style={{ fontSize: '0.875rem', color: '#92400e', margin: 0 }}>\r\n                {violations.length} violation{violations.length > 1 ? 's' : ''} recorded\r\n              </p>\r\n            </div>\r\n          )}\r\n          \r\n          <button onClick={() => window.history.back()} style={{ background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white', padding: '0.75rem 2rem', borderRadius: '12px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}>   \r\n            Return to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!testData) return null;\r\n\r\n  const currentQuestion = testData.questions[currentQuestionIndex];\r\n  const progress = ((currentQuestionIndex + 1) / testData.questions.length) * 100;\r\n\r\n  return (\r\n    <div \r\n      ref={testContainerRef}\r\n      className=\"test-container\"\r\n    >\r\n      {/* Security Status Bar */}\r\n      <div className=\"security-bar\">\r\n        <div className=\"security-left\">\r\n          <Lock style={{ width: '1rem', height: '1rem' }} />\r\n          <span style={{ fontWeight: 500 }}>EXAM MODE - Do not close window, switch tabs, or use keyboard shortcuts</span>\r\n        </div>\r\n        <div className=\"security-right\">\r\n          {lateJoinTime > 0 && (\r\n            <span className=\"security-badge security-badge-blue\">\r\n              Late: +{Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')}\r\n            </span>\r\n          )}\r\n          {violations.length > 0 && (\r\n            <span className=\"security-badge security-badge-red\">\r\n              {violations.length} violation(s)\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Timer and Progress Header */}\r\n      <div className=\"header\">\r\n        <div className=\"header-content\">\r\n          <div>\r\n            <h1 className=\"header-title\">\r\n              <Calculator style={{ width: '1.25rem', height: '1.25rem', color: '#3b82f6' }} />\r\n              {testData.testType.charAt(0).toUpperCase() + testData.testType.slice(1)} Test\r\n              <span className=\"header-difficulty\">\r\n                ({testData.difficultyLevel})\r\n              </span>\r\n            </h1>\r\n            <p className=\"header-progress\">\r\n              Question {currentQuestionIndex + 1} of {testData.questions.length}\r\n            </p>\r\n          </div>\r\n          \r\n          <div style={{ textAlign: 'right' }}>\r\n            <div className={`timer ${\r\n              timeRemaining < 60 ? 'timer-critical' : \r\n              timeRemaining < 300 ? 'timer-warning' : 'timer-normal'\r\n            }`}>\r\n              <Clock style={{ width: '1.5rem', height: '1.5rem' }} />\r\n              {formatTime(timeRemaining)}\r\n            </div>\r\n            <p className=\"timer-label\">Time remaining</p>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Progress Bar */}\r\n        <div className=\"progress-container\">\r\n          <div className=\"progress-bar\">\r\n            <div \r\n              className=\"progress-fill\"\r\n              style={{ width: `${progress}%` }}\r\n            ></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Question Content */}\r\n      <div className=\"content\">\r\n        <div className=\"question-card\">\r\n          <div className=\"question-section\">\r\n            <h2 className=\"question-text\">\r\n              {currentQuestion.question}\r\n            </h2>\r\n            \r\n            {/* Answer Input */}\r\n            <div className=\"answer-section\">\r\n              {currentQuestion.options && currentQuestion.options.length > 0 ? (\r\n                // Multiple choice\r\n                <div className=\"options-container\">\r\n                  {currentQuestion.options.map((option, index) => (\r\n                    <label \r\n                      key={index}\r\n                      className=\"option\"\r\n                    >\r\n                      <input\r\n                        type=\"radio\"\r\n                        name={`question-${currentQuestionIndex}`}\r\n                        value={option}\r\n                        checked={answers[currentQuestionIndex] === option}\r\n                        onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\r\n                        className=\"option-input\"\r\n                      />\r\n                      <span className=\"option-text\">{option}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                // Text input for math problems\r\n                <div className=\"input-container\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={answers[currentQuestionIndex]}\r\n                    onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\r\n                    className=\"answer-input\"\r\n                    placeholder=\"Enter your answer\"\r\n                    autoFocus\r\n                    onKeyPress={(e) => {\r\n                      // Allow only numbers and basic math symbols\r\n                      const allowedChars = /[0-9\\-+.]/;\r\n                      if (!allowedChars.test(e.key) && e.key !== 'Backspace' && e.key !== 'Enter') {\r\n                        e.preventDefault();\r\n                      }\r\n                      // Submit on Enter if it's the last question\r\n                      if (e.key === 'Enter' && currentQuestionIndex === testData.questions.length - 1) {\r\n                        submitTest(false);\r\n                      }\r\n                    }}\r\n                  />\r\n                  <p className=\"input-hint\">\r\n                    Enter numbers only. Press Enter to move to next question.\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Navigation Buttons */}\r\n          <div className=\"navigation\">\r\n            <button\r\n              onClick={() => setCurrentQuestionIndex(Math.max(0, currentQuestionIndex - 1))}\r\n              disabled={currentQuestionIndex === 0}\r\n              className={`nav-button nav-button-prev ${currentQuestionIndex === 0 ? '' : ''}`}\r\n            >\r\n              Previous\r\n            </button>\r\n\r\n            <span className=\"progress-indicator\">\r\n              {answers.filter(a => a.trim() !== '').length} of {testData.questions.length} answered\r\n            </span>\r\n\r\n            {currentQuestionIndex < testData.questions.length - 1 ? (\r\n              <button\r\n                onClick={() => setCurrentQuestionIndex(currentQuestionIndex + 1)}\r\n                className=\"nav-button nav-button-next\"\r\n              >\r\n                Next\r\n              </button>\r\n            ) : (\r\n              <button\r\n                onClick={() => submitTest(false)}\r\n                disabled={isSubmitting}\r\n                className=\"nav-button nav-button-submit\"\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <div className=\"submit-spinner\"></div>\r\n                    Submitting...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Send style={{ width: '1rem', height: '1rem' }} />\r\n                    Submit Test\r\n                  </>\r\n                )}\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Question Navigation Footer */}\r\n      <div className=\"footer\">\r\n        <div className=\"question-grid\">\r\n          {testData.questions.map((_, index) => (\r\n            <button\r\n              key={index}\r\n              onClick={() => setCurrentQuestionIndex(index)}\r\n              className={`question-number ${\r\n                index === currentQuestionIndex\r\n                  ? 'question-number-current'\r\n                  : answers[index]?.trim()\r\n                  ? 'question-number-answered'\r\n                  : 'question-number-unanswered'\r\n              }`}\r\n            >\r\n              {index + 1}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Warning Modal for Violations */}\r\n      {violations.length > 0 && violations.length % 2 === 1 && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal-card\">\r\n            <div className=\"modal-header\">\r\n              <AlertTriangle style={{ width: '2rem', height: '2rem', color: '#ef4444' }} />\r\n              <h3 className=\"modal-title\">Security Violation Detected</h3>\r\n            </div>\r\n            <p className=\"modal-text\">\r\n              You have attempted to leave the test environment or use prohibited features. \r\n              This violation has been recorded.\r\n            </p>\r\n            <div className=\"violation-details\">\r\n              <p className=\"violation-latest\">\r\n                <strong>Latest Violation:</strong> {violations[violations.length - 1]?.type}\r\n              </p>\r\n              <p className=\"violation-count\">\r\n                Total violations: {violations.length}\r\n              </p>\r\n              {violations.length >= 2 && (\r\n                <p className=\"violation-warning\">\r\n                  Warning: One more violation will auto-submit your test!\r\n                </p>\r\n              )}\r\n            </div>\r\n            <div className=\"modal-actions\">\r\n              <button\r\n                onClick={() => {\r\n                  // Modal will auto-close, violation is already recorded\r\n                }}\r\n                className=\"modal-button\"\r\n              >\r\n                Continue Test\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst TestContainer = ({ studentId, socket }) => {\r\n  const API_URL = 'http://localhost:5000/api';\r\n  const [activeTest, setActiveTest] = useState(null);\r\n  const [showTest, setShowTest] = useState(false);\r\n  const [testResult, setTestResult] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Check for active tests using your existing API structure\r\n  useEffect(() => {\r\n    const checkForActiveTests = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        const token = localStorage.getItem('token');\r\n        const deviceId = localStorage.getItem('deviceId');\r\n        \r\n        if (!token) {\r\n          console.log('No token found');\r\n          setError('No authentication token found. Please log in again.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        console.log('Checking for active tests...');\r\n        console.log('Token:', token ? 'Present' : 'Missing');\r\n        console.log('Device ID:', deviceId);\r\n\r\n        // Check for active tests that target this student\r\n        const response = await fetch(`${API_URL}/student/tests/active`, {\r\n          method: 'GET',\r\n          headers: {\r\n            'Authorization': token,\r\n            'X-Device-Id': deviceId,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        console.log('Response status:', response.status);\r\n        \r\n        if (!response.ok) {\r\n          if (response.status === 401) {\r\n            setError('Authentication failed. Please log in again.');\r\n            return;\r\n          } else if (response.status === 403) {\r\n            setError('Access denied. Please contact your teacher.');\r\n            return;\r\n          }\r\n          throw new Error(`Failed to fetch tests: ${response.status}`);\r\n        }\r\n\r\n        const tests = await response.json();\r\n        console.log('Received tests:', tests);\r\n        \r\n        if (tests && tests.length > 0) {\r\n          // Filter tests that are actually active and not expired\r\n          const currentTime = new Date();\r\n          const availableTests = tests.filter(test => {\r\n            const testStart = new Date(test.startTime);\r\n            const testEnd = new Date(testStart.getTime() + (test.duration * 60 * 1000));\r\n            \r\n            console.log('Test:', test._id);\r\n            console.log('Current time:', currentTime);\r\n            console.log('Test start:', testStart);\r\n            console.log('Test end:', testEnd);\r\n            console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\r\n            \r\n            return currentTime >= testStart && currentTime < testEnd;\r\n          });\r\n          \r\n          if (availableTests.length > 0) {\r\n            console.log('Setting active test:', availableTests[0]);\r\n            setActiveTest(availableTests[0]);\r\n          } else {\r\n            console.log('No available tests (all expired or not yet started)');\r\n          }\r\n        } else {\r\n          console.log('No tests found');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error checking for active tests:', error);\r\n        setError(`Error loading tests: ${error.message}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    checkForActiveTests();\r\n\r\n    // Check every 30 seconds for new tests\r\n    // const interval = setInterval(checkForActiveTests, 30000);\r\n    // return () => clearInterval(interval);\r\n  }, [API_URL]);\r\n\r\n  // Listen for test events from admin (if socket is available)\r\n  useEffect(() => {\r\n    if (socket) {\r\n      const handleTestLaunched = (testData) => {\r\n        console.log('Test launched event received:', testData);\r\n        setActiveTest(testData);\r\n      };\r\n\r\n      const handleTestEnded = (data) => {\r\n        console.log('Test ended event received:', data);\r\n        if (activeTest && activeTest._id === data.testId) {\r\n          setActiveTest(null);\r\n          setShowTest(false);\r\n        }\r\n      };\r\n\r\n      socket.on('test-launched', handleTestLaunched);\r\n      socket.on('test-ended', handleTestEnded);\r\n\r\n      return () => {\r\n        socket.off('test-launched', handleTestLaunched);\r\n        socket.off('test-ended', handleTestEnded);\r\n      };\r\n    }\r\n  }, [socket, activeTest]);\r\n\r\n  const handleStartTest = () => {\r\n    console.log('Starting test:', activeTest);\r\n    setShowTest(true);\r\n  };\r\n\r\n  const handleTestComplete = (result) => {\r\n    console.log('Test completed:', result);\r\n    setTestResult(result);\r\n    setShowTest(false);\r\n    setActiveTest(null);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif' }}>\r\n        <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.8)', backdropFilter: 'blur(20px)', border: '1px solid rgba(226, 232, 240, 0.5)', borderRadius: '20px', padding: '2rem', boxShadow: '0 10px 40px rgba(0, 0, 0, 0.1)' }}>\r\n          <div style={{ width: '32px', height: '32px', border: '3px solid rgba(59, 130, 246, 0.3)', borderTop: '3px solid #3b82f6', borderRadius: '50%', animation: 'spin 1s linear infinite', margin: '0 auto 1rem' }}></div>\r\n          <p style={{ color: '#374151', fontWeight: 500, margin: '0 0 0.25rem' }}>Checking for active tests...</p>\r\n          <p style={{ color: '#9ca3af', fontSize: '0.875rem', margin: 0 }}>This may take a moment</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n        <div style={{ background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(254, 202, 202, 0.5)', borderRadius: '20px', padding: '2rem', textAlign: 'center', maxWidth: '400px', boxShadow: '0 10px 40px rgba(239, 68, 68, 0.1)' }}>\r\n          <AlertTriangle style={{ width: '3rem', height: '3rem', color: '#ef4444', margin: '0 auto 1rem' }} />\r\n          <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#dc2626', margin: '0 0 0.5rem' }}>Error</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 2rem', lineHeight: 1.5 }}>{error}</p>\r\n          <div style={{ display: 'flex', gap: '0.75rem', justifyContent: 'center' }}>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              style={{ padding: '0.75rem 1.5rem', borderRadius: '10px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.2s', background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white' }}\r\n            >\r\n              Retry\r\n            </button>\r\n            <button\r\n              onClick={() => setError(null)}\r\n              style={{ padding: '0.75rem 1.5rem', borderRadius: '10px', fontWeight: 600, border: '1px solid rgba(107, 114, 128, 0.3)', cursor: 'pointer', transition: 'all 0.2s', background: 'rgba(107, 114, 128, 0.1)', color: '#374151' }}\r\n            >\r\n              Dismiss\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (showTest && activeTest) {\r\n    return (\r\n      <StudentTestComponent\r\n        testId={activeTest._id || activeTest.id}\r\n        onTestComplete={handleTestComplete}\r\n        socket={socket}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (testResult) {\r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #dcfdf7 0%, #a7f3d0 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n        <div style={{ background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(167, 243, 208, 0.5)', borderRadius: '20px', padding: '2rem', textAlign: 'center', maxWidth: '400px', boxShadow: '0 10px 40px rgba(16, 185, 129, 0.1)' }}>\r\n          <h2 style={{ fontSize: '1.75rem', fontWeight: 700, color: '#065f46', margin: '0 0 1rem' }}>Test Complete!</h2>\r\n          <div style={{ fontSize: '3rem', fontWeight: 800, background: 'linear-gradient(135deg, #059669, #047857)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', backgroundClip: 'text', margin: '0 0 0.5rem' }}>\r\n            {testResult.score}%\r\n          </div>\r\n          <p style={{ color: '#6b7280', margin: '0 0 1.5rem' }}>\r\n            You answered {testResult.correct} out of {testResult.total} questions correctly.\r\n          </p>\r\n          {testResult.isAutoSubmit && (\r\n            <div style={{ borderRadius: '10px', padding: '0.75rem', margin: '0 0 1rem', border: '1px solid rgba(245, 158, 11, 0.3)', background: 'rgba(245, 158, 11, 0.1)' }}>\r\n              <p style={{ margin: 0, fontSize: '0.875rem', fontWeight: 500, color: '#92400e' }}>\r\n                <strong>Note:</strong> Test was auto-submitted due to: {testResult.reason}\r\n              </p>\r\n            </div>\r\n          )}\r\n          {testResult.violations > 0 && (\r\n            <div style={{ borderRadius: '10px', padding: '0.75rem', margin: '0 0 1rem', border: '1px solid rgba(239, 68, 68, 0.3)', background: 'rgba(239, 68, 68, 0.1)' }}>\r\n              <p style={{ margin: 0, fontSize: '0.875rem', fontWeight: 500, color: '#b91c1c' }}>\r\n                <strong>Security Violations:</strong> {testResult.violations} recorded\r\n              </p>\r\n            </div>\r\n          )}\r\n          <button\r\n            onClick={() => setTestResult(null)}\r\n            style={{ background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white', padding: '0.875rem 2rem', borderRadius: '12px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}\r\n          >\r\n            Continue\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (activeTest) {\r\n    const now = new Date();\r\n    const testStart = new Date(activeTest.startTime);\r\n    const testEnd = new Date(testStart.getTime() + (activeTest.duration * 60 * 1000));\r\n    const isTestTime = now >= testStart && now < testEnd;\r\n    const isTestOver = now >= testEnd;\r\n    \r\n    console.log('Active test found:', {\r\n      testId: activeTest._id,\r\n      now: now.toISOString(),\r\n      start: testStart.toISOString(),\r\n      end: testEnd.toISOString(),\r\n      isTestTime,\r\n      isTestOver\r\n    });\r\n    \r\n    if (isTestOver) {\r\n      return (\r\n        <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n          <div style={{ background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(253, 230, 138, 0.5)', borderRadius: '20px', padding: '2rem', textAlign: 'center', maxWidth: '400px', boxShadow: '0 10px 40px rgba(245, 158, 11, 0.1)' }}>\r\n            <AlertTriangle style={{ width: '4rem', height: '4rem', color: '#f59e0b', margin: '0 auto 1rem' }} />\r\n            <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#92400e', margin: '0 0 0.5rem' }}>Test Expired</h2>\r\n            <p style={{ color: '#6b7280', margin: '0 0 2rem' }}>The time limit for this test has passed.</p>\r\n            <button \r\n              onClick={() => setActiveTest(null)} \r\n              style={{ background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white', padding: '0.75rem 2rem', borderRadius: '12px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}\r\n            >\r\n              Continue\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    return (\r\n      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n        <div style={{ background: 'rgba(255, 255, 255, 0.95)', backdropFilter: 'blur(20px)', border: '1px solid rgba(191, 219, 254, 0.5)', borderRadius: '20px', padding: '2rem', textAlign: 'center', maxWidth: '500px', boxShadow: '0 10px 40px rgba(59, 130, 246, 0.1)' }}>\r\n          <div style={{ width: '4rem', height: '4rem', background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 1rem', boxShadow: '0 8px 25px rgba(59, 130, 246, 0.3)' }}>\r\n            <Calculator style={{ width: '2rem', height: '2rem', color: 'white' }} />\r\n          </div>\r\n          <h2 style={{ fontSize: '1.75rem', fontWeight: 700, color: '#1e40af', margin: '0 0 0.5rem' }}>Test Available</h2>\r\n          <p style={{ color: '#6b7280', margin: '0 0 0.5rem' }}>\r\n            {activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1)} ‚Ä¢ {activeTest.duration} minutes ‚Ä¢ {activeTest.count} questions\r\n          </p>\r\n          <p style={{ color: '#9ca3af', fontSize: '0.875rem', margin: '0 0 1.5rem' }}>\r\n            Difficulty: {activeTest.difficultyLevel}\r\n          </p>\r\n          \r\n          <div style={{ background: 'linear-gradient(135deg, #eff6ff, #dbeafe)', border: '1px solid rgba(147, 197, 253, 0.3)', borderRadius: '12px', padding: '1rem', margin: '0 0 1.5rem' }}>\r\n            <p style={{ color: '#1e40af', fontSize: '0.875rem', margin: '0 0 0.25rem' }}>\r\n              <strong>Test ID:</strong> {activeTest._id}\r\n            </p>\r\n            <p style={{ color: '#1e40af', fontSize: '0.875rem', margin: '0' }}>\r\n              <strong>Started:</strong> {testStart.toLocaleString()}\r\n            </p>\r\n          </div>\r\n          \r\n          {isTestTime ? (\r\n            <>\r\n              <p style={{ color: '#6b7280', fontSize: '0.95rem', margin: '0 0 1rem', lineHeight: 1.5 }}>\r\n                Click below to start your test. Ensure you're in a quiet environment with stable internet.\r\n              </p>\r\n              <div style={{ background: 'linear-gradient(135deg, #fef3c7, #fde68a)', border: '1px solid rgba(245, 158, 11, 0.3)', borderRadius: '12px', padding: '0.75rem', margin: '0 0 1.5rem' }}>\r\n                <p style={{ color: '#92400e', fontSize: '0.875rem', margin: 0 }}>\r\n                  <strong>Important:</strong> Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={handleStartTest}\r\n                style={{ background: 'linear-gradient(135deg, #10b981, #047857)', color: 'white', padding: '1rem 2.5rem', borderRadius: '12px', fontWeight: 600, fontSize: '1.125rem', border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}\r\n              >\r\n                Start Test\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <p style={{ color: '#6b7280', fontSize: '0.95rem', margin: '0 0 1rem', lineHeight: 1.5 }}>\r\n                Test starts at: {testStart.toLocaleString()}\r\n              </p>\r\n              <div style={{ background: 'linear-gradient(135deg, #fef3c7, #fde68a)', border: '1px solid rgba(245, 158, 11, 0.3)', borderRadius: '12px', padding: '0.75rem' }}>\r\n                <p style={{ color: '#92400e', fontSize: '0.875rem', margin: 0 }}>\r\n                  Please wait for the scheduled start time.\r\n                </p>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif', padding: '1rem' }}>\r\n      <div style={{ textAlign: 'center', background: 'rgba(255, 255, 255, 0.8)', backdropFilter: 'blur(20px)', border: '1px solid rgba(226, 232, 240, 0.5)', borderRadius: '20px', padding: '2rem', maxWidth: '500px', boxShadow: '0 10px 40px rgba(0, 0, 0, 0.05)' }}>\r\n        <div style={{ width: '4rem', height: '4rem', background: 'linear-gradient(135deg, #f1f5f9, #e2e8f0)', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 1rem' }}>\r\n          <Clock style={{ width: '2rem', height: '2rem', color: '#9ca3af' }} />\r\n        </div>\r\n        <h2 style={{ fontSize: '1.25rem', fontWeight: 600, color: '#6b7280', margin: '0 0 0.5rem' }}>No Active Tests</h2>\r\n        <p style={{ color: '#9ca3af', margin: '0 0 2rem' }}>Check back later for new assignments.</p>\r\n        \r\n        <div style={{ background: 'linear-gradient(135deg, #f9fafb, #f3f4f6)', border: '1px solid rgba(209, 213, 219, 0.5)', borderRadius: '12px', padding: '1rem', margin: '0 0 1.5rem', textAlign: 'left', fontSize: '0.75rem' }}>\r\n          <p style={{ color: '#374151', margin: '0 0 0.5rem', fontSize: '0.75rem' }}><strong>Debug Info:</strong></p>\r\n          <p style={{ color: '#6b7280', margin: '0.25rem 0', fontSize: '0.75rem' }}>Token: {localStorage.getItem('token') ? 'Present' : 'Missing'}</p>\r\n          <p style={{ color: '#6b7280', margin: '0.25rem 0', fontSize: '0.75rem' }}>Device ID: {localStorage.getItem('deviceId') || 'Missing'}</p>\r\n          <p style={{ color: '#6b7280', margin: '0.25rem 0', fontSize: '0.75rem' }}>User ID: {localStorage.getItem('userId') || 'Missing'}</p>\r\n          <p style={{ color: '#6b7280', margin: '0.25rem 0', fontSize: '0.75rem' }}>Last checked: {new Date().toLocaleTimeString()}</p>\r\n        </div>\r\n        \r\n        <button\r\n          onClick={() => window.location.reload()}\r\n          style={{ background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white', padding: '0.75rem 1.5rem', borderRadius: '10px', fontWeight: 600, border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}\r\n        >\r\n          Refresh\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TestContainer;\r\n\r\n\r\n\r\n// import React, { useState, useEffect, useRef } from 'react';\r\n// import { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\r\n\r\n\r\n// const StudentTestComponent = ({ testId, onTestComplete, socket }) => {\r\n//   const API_URL = 'http://localhost:5000/api';\r\n  \r\n//   const [testData, setTestData] = useState(null);\r\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\r\n//   const [answers, setAnswers] = useState([]);\r\n//   const [timeRemaining, setTimeRemaining] = useState(0);\r\n//   const [testStatus, setTestStatus] = useState('loading');\r\n//   const [isFullscreen, setIsFullscreen] = useState(false);\r\n//   const [violations, setViolations] = useState([]);\r\n//   const [isSubmitting, setIsSubmitting] = useState(false);\r\n//   const [lateJoinTime, setLateJoinTime] = useState(0);\r\n  \r\n//   const testContainerRef = useRef(null);\r\n//   const startTimeRef = useRef(null);\r\n//   const timerRef = useRef(null);\r\n//   const visibilityTimeoutRef = useRef(null);\r\n\r\n//   // Generate math questions based on test parameters\r\n//   const generateQuestions = (testType, count, difficultyLevel) => {\r\n//     const questions = [];\r\n    \r\n//     for (let i = 0; i < count; i++) {\r\n//       let question, correctAnswer;\r\n//       let num1, num2;\r\n      \r\n//       // Set difficulty ranges\r\n//       switch (difficultyLevel) {\r\n//         case 'easy':\r\n//           num1 = Math.floor(Math.random() * 10) + 1;\r\n//           num2 = Math.floor(Math.random() * 10) + 1;\r\n//           break;\r\n//         case 'medium':\r\n//           num1 = Math.floor(Math.random() * 50) + 1;\r\n//           num2 = Math.floor(Math.random() * 50) + 1;\r\n//           break;\r\n//         case 'double':\r\n//           num1 = Math.floor(Math.random() * 99) + 1;\r\n//           num2 = Math.floor(Math.random() * 99) + 1;\r\n//           break;\r\n//         default:\r\n//           num1 = Math.floor(Math.random() * 20) + 1;\r\n//           num2 = Math.floor(Math.random() * 20) + 1;\r\n//       }\r\n      \r\n//       // Generate based on test type\r\n//       switch (testType) {\r\n//         case 'multiplication':\r\n//           question = `${num1} √ó ${num2} = ?`;\r\n//           correctAnswer = (num1 * num2).toString();\r\n//           break;\r\n//         case 'addition':\r\n//           question = `${num1} + ${num2} = ?`;\r\n//           correctAnswer = (num1 + num2).toString();\r\n//           break;\r\n//         case 'subtraction':\r\n//           // Ensure positive result\r\n//           if (num1 < num2) [num1, num2] = [num2, num1];\r\n//           question = `${num1} - ${num2} = ?`;\r\n//           correctAnswer = (num1 - num2).toString();\r\n//           break;\r\n//         case 'division':\r\n//           // Ensure whole number division\r\n//           const product = num1 * num2;\r\n//           question = `${product} √∑ ${num1} = ?`;\r\n//           correctAnswer = num2.toString();\r\n//           break;\r\n//         default:\r\n//           question = `${num1} √ó ${num2} = ?`;\r\n//           correctAnswer = (num1 * num2).toString();\r\n//       }\r\n      \r\n//       questions.push({\r\n//         question,\r\n//         correctAnswer,\r\n//         type: testType,\r\n//         options: [] // Empty for math problems (text input)\r\n//       });\r\n//     }\r\n    \r\n//     return questions;\r\n//   };\r\n\r\n//   // Fetch test data from your existing backend\r\n//   useEffect(() => {\r\n//     const fetchTestData = async () => {\r\n//       try {\r\n//         const token = localStorage.getItem('token');\r\n//         const deviceId = localStorage.getItem('deviceId');\r\n\r\n//         if (!token) {\r\n//           setTestStatus('error');\r\n//           return;\r\n//         }\r\n\r\n//         // Fetch the test details first\r\n//         const response = await fetch(`${API_URL}/student/tests/${testId}`, {\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           }\r\n//         });\r\n\r\n//         if (!response.ok) {\r\n//           if (response.status === 404) {\r\n//             setTestStatus('no-test');\r\n//             console.warn('Test not found or inactive');\r\n//             return;\r\n//           }\r\n//           throw new Error('Failed to load test');\r\n//         }\r\n\r\n//         const testDetails = await response.json();\r\n        \r\n//         // Check if test is still active and not past end time\r\n//         const now = new Date();\r\n//         const testStart = new Date(testDetails.startTime);\r\n//         const testEnd = new Date(testStart.getTime() + (testDetails.duration * 60 * 1000));\r\n        \r\n//         if (now > testEnd) {\r\n//           setTestStatus('test-ended');\r\n//           return;\r\n//         }\r\n\r\n//         // Check if student already submitted\r\n//         const userId = localStorage.getItem('userId') || 'anonymous';\r\n//         const existingResult = testDetails.results?.find(r => r.studentId === userId);\r\n//         if (existingResult) {\r\n//           setTestStatus('already-submitted');\r\n//           return;\r\n//         }\r\n\r\n//         // Calculate late join time if applicable\r\n//         let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\r\n//         let lateJoinSeconds = 0;\r\n        \r\n//         if (now > testStart) {\r\n//           lateJoinSeconds = Math.floor((now - testStart) / 1000);\r\n//           adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\r\n//           setLateJoinTime(lateJoinSeconds);\r\n//         }\r\n\r\n//         // Generate questions if not provided\r\n//         let questions = testDetails.questions || [];\r\n//         if (questions.length === 0) {\r\n//           questions = generateQuestions(\r\n//             testDetails.testType, \r\n//             testDetails.count, \r\n//             testDetails.difficultyLevel\r\n//           );\r\n//         }\r\n\r\n//         const processedTestData = {\r\n//           ...testDetails,\r\n//           questions,\r\n//           gameType: testDetails.testType // For compatibility\r\n//         };\r\n\r\n//         setTestData(processedTestData);\r\n//         setTimeRemaining(adjustedTimeRemaining);\r\n//         setAnswers(new Array(questions.length).fill(''));\r\n//         setTestStatus('active');\r\n//         startTimeRef.current = Date.now();\r\n        \r\n//         // Notify admin via socket\r\n//         socket?.emit('test-started', { \r\n//           testId: testDetails._id,\r\n//           studentId: userId,\r\n//           lateJoinSeconds\r\n//         });\r\n\r\n//       } catch (error) {\r\n//         console.error('Error loading test:', error);\r\n//         setTestStatus('error');\r\n//       }\r\n//     };\r\n\r\n//     if (testId) {\r\n//       fetchTestData();\r\n//     }\r\n//   }, [testId, socket, API_URL]);\r\n\r\n//   // Enhanced fullscreen handling\r\n//   useEffect(() => {\r\n//     const enterFullscreen = async () => {\r\n//       try {\r\n//         if (testContainerRef.current && !isFullscreen) {\r\n//           if (testContainerRef.current.requestFullscreen) {\r\n//             await testContainerRef.current.requestFullscreen();\r\n//           } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n//             await testContainerRef.current.webkitRequestFullscreen();\r\n//           } else if (testContainerRef.current.msRequestFullscreen) {\r\n//             await testContainerRef.current.msRequestFullscreen();\r\n//           }\r\n//           setIsFullscreen(true);\r\n//         }\r\n//       } catch (error) {\r\n//         console.warn('Fullscreen not supported:', error);\r\n//         // Continue test even without fullscreen\r\n//       }\r\n//     };\r\n\r\n//     if (testStatus === 'active' && testContainerRef.current) {\r\n//       enterFullscreen();\r\n//     }\r\n//   }, [testStatus]);\r\n\r\n//   // Handle fullscreen changes with stricter enforcement\r\n//   useEffect(() => {\r\n//     const handleFullscreenChange = () => {\r\n//       const isCurrentlyFullscreen = Boolean(\r\n//         document.fullscreenElement || \r\n//         document.webkitFullscreenElement || \r\n//         document.msFullscreenElement\r\n//       );\r\n//       setIsFullscreen(isCurrentlyFullscreen);\r\n      \r\n//       if (!isCurrentlyFullscreen && testStatus === 'active') {\r\n//         addViolation('Exited fullscreen mode');\r\n        \r\n//         // Try to re-enter fullscreen immediately\r\n//         if (testContainerRef.current) {\r\n//           const enterFullscreen = async () => {\r\n//             try {\r\n//               if (testContainerRef.current.requestFullscreen) {\r\n//                 await testContainerRef.current.requestFullscreen();\r\n//               } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n//                 await testContainerRef.current.webkitRequestFullscreen();\r\n//               }\r\n//             } catch (error) {\r\n//               // If can't re-enter after 3 violations, auto-submit\r\n//               if (violations.length >= 2) {\r\n//                 handleAutoSubmit('Multiple fullscreen violations');\r\n//               }\r\n//             }\r\n//           };\r\n//           enterFullscreen();\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n//     document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n//     document.addEventListener('msfullscreenchange', handleFullscreenChange);\r\n    \r\n//     return () => {\r\n//       document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n//       document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n//       document.removeEventListener('msfullscreenchange', handleFullscreenChange);\r\n//     };\r\n//   }, [testStatus, violations]);\r\n\r\n//   // Enhanced visibility handling\r\n//   useEffect(() => {\r\n//     const handleVisibilityChange = () => {\r\n//       if (document.hidden && testStatus === 'active') {\r\n//         addViolation('Switched to another tab/window');\r\n        \r\n//         // Shorter timeout for tab switching - 3 seconds\r\n//         visibilityTimeoutRef.current = setTimeout(() => {\r\n//           if (document.hidden) {\r\n//             handleAutoSubmit('Tab switching violation - remained hidden');\r\n//           }\r\n//         }, 3000);\r\n//       } else if (!document.hidden && visibilityTimeoutRef.current) {\r\n//         clearTimeout(visibilityTimeoutRef.current);\r\n//         visibilityTimeoutRef.current = null;\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('visibilitychange', handleVisibilityChange);\r\n//     return () => {\r\n//       document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n//       if (visibilityTimeoutRef.current) {\r\n//         clearTimeout(visibilityTimeoutRef.current);\r\n//       }\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Enhanced browser navigation prevention\r\n//   useEffect(() => {\r\n//     const handleBeforeUnload = (event) => {\r\n//       if (testStatus === 'active') {\r\n//         event.preventDefault();\r\n//         event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\r\n//         return event.returnValue;\r\n//       }\r\n//     };\r\n\r\n//     const handlePopState = (event) => {\r\n//       if (testStatus === 'active') {\r\n//         event.preventDefault();\r\n//         window.history.pushState(null, '', window.location.pathname);\r\n//         addViolation('Browser navigation attempt');\r\n//         handleAutoSubmit('Navigation attempt during test');\r\n//       }\r\n//     };\r\n\r\n//     // Push current state to prevent back navigation\r\n//     window.history.pushState(null, '', window.location.pathname);\r\n    \r\n//     window.addEventListener('beforeunload', handleBeforeUnload);\r\n//     window.addEventListener('popstate', handlePopState);\r\n\r\n//     return () => {\r\n//       window.removeEventListener('beforeunload', handleBeforeUnload);\r\n//       window.removeEventListener('popstate', handlePopState);\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Timer countdown with auto-submit\r\n//   useEffect(() => {\r\n//     if (testStatus === 'active' && timeRemaining > 0) {\r\n//       timerRef.current = setInterval(() => {\r\n//         setTimeRemaining(prev => {\r\n//           if (prev <= 1) {\r\n//             handleAutoSubmit('Time expired');\r\n//             return 0;\r\n//           }\r\n//           return prev - 1;\r\n//         });\r\n//       }, 1000);\r\n\r\n//       return () => {\r\n//         if (timerRef.current) {\r\n//           clearInterval(timerRef.current);\r\n//         }\r\n//       };\r\n//     }\r\n//   }, [testStatus, timeRemaining]);\r\n\r\n//   // Send progress updates to admin\r\n//   useEffect(() => {\r\n//     if (testStatus === 'active' && socket) {\r\n//       const progressInterval = setInterval(() => {\r\n//         const answeredCount = answers.filter(a => a.trim() !== '').length;\r\n//         const progress = (answeredCount / answers.length) * 100;\r\n        \r\n//         socket.emit('test-progress', {\r\n//           testId,\r\n//           studentId: localStorage.getItem('userId') || 'anonymous',\r\n//           progress: Math.round(progress),\r\n//           currentQuestion: currentQuestionIndex + 1,\r\n//           answeredQuestions: answeredCount,\r\n//           timeRemaining\r\n//         });\r\n//       }, 5000);\r\n\r\n//       return () => clearInterval(progressInterval);\r\n//     }\r\n//   }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\r\n\r\n//   const addViolation = (violation) => {\r\n//     setViolations(prev => {\r\n//       const newViolations = [...prev, {\r\n//         type: violation,\r\n//         timestamp: new Date().toISOString()\r\n//       }];\r\n      \r\n//       // Auto-submit after 3 violations\r\n//       if (newViolations.length >= 3) {\r\n//         setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\r\n//       }\r\n      \r\n//       return newViolations;\r\n//     });\r\n//   };\r\n\r\n//   const handleAutoSubmit = async (reason) => {\r\n//     if (isSubmitting) return;\r\n    \r\n//     console.log(`Auto-submitting test: ${reason}`);\r\n//     await submitTest(true, reason);\r\n//   };\r\n\r\n//   const handleAnswerChange = (questionIndex, value) => {\r\n//     const newAnswers = [...answers];\r\n//     newAnswers[questionIndex] = value.trim();\r\n//     setAnswers(newAnswers);\r\n//   };\r\n\r\n//   const calculateScore = () => {\r\n//     if (!testData) return { correct: 0, total: 0, score: 0 };\r\n    \r\n//     let correct = 0;\r\n//     testData.questions.forEach((question, index) => {\r\n//       const userAnswer = answers[index]?.trim().toLowerCase();\r\n//       const correctAnswer = question.correctAnswer?.trim().toLowerCase();\r\n      \r\n//       if (userAnswer === correctAnswer) {\r\n//         correct++;\r\n//       }\r\n//     });\r\n    \r\n//     const total = testData.questions.length;\r\n//     const score = total > 0 ? Math.round((correct / total) * 100) : 0;\r\n    \r\n//     return { correct, total, score };\r\n//   };\r\n\r\n//   const submitTest = async (isAutoSubmit = false, reason = '') => {\r\n//     if (isSubmitting) return;\r\n    \r\n//     setIsSubmitting(true);\r\n    \r\n//     try {\r\n//       const { correct, total, score } = calculateScore();\r\n//       const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\r\n//       const token = localStorage.getItem('token');\r\n//       const deviceId = localStorage.getItem('deviceId');\r\n//       const userId = localStorage.getItem('userId') || 'anonymous';\r\n\r\n//       const submissionData = {\r\n//         studentId: userId,\r\n//         answers: answers.map((answer, index) => ({\r\n//           questionIndex: index,\r\n//           question: testData.questions[index].question,\r\n//           userAnswer: answer,\r\n//           correctAnswer: testData.questions[index].correctAnswer,\r\n//           isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\r\n//         })),\r\n//         correctCount: correct,\r\n//         totalQuestions: total,\r\n//         score,\r\n//         timeSpent,\r\n//         lateJoinTime,\r\n//         violations,\r\n//         isAutoSubmit,\r\n//         autoSubmitReason: reason,\r\n//         submittedAt: new Date().toISOString()\r\n//       };\r\n\r\n//       const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\r\n//         method: 'POST',\r\n//         headers: {\r\n//           'Authorization': token,\r\n//           'X-Device-Id': deviceId,\r\n//           'Content-Type': 'application/json'\r\n//         },\r\n//         body: JSON.stringify(submissionData)\r\n//       });\r\n\r\n//       if (!response.ok) {\r\n//         throw new Error(`Submission failed: ${response.status}`);\r\n//       }\r\n\r\n//       // Update performance data if API exists\r\n//       try {\r\n//         const performanceUpdate = {\r\n//           totalGames: 1,\r\n//           totalCorrect: correct,\r\n//           totalScore: score,\r\n//           gameType: testData.testType,\r\n//           difficulty: testData.difficultyLevel || 'medium',\r\n//           speed: 2,\r\n//           count: total\r\n//         };\r\n\r\n//         await fetch(`${API_URL}/performance/${userId}`, {\r\n//           method: 'POST',\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           },\r\n//           body: JSON.stringify(performanceUpdate)\r\n//         });\r\n//       } catch (perfError) {\r\n//         console.warn('Performance update failed:', perfError);\r\n//         // Continue even if performance update fails\r\n//       }\r\n\r\n//       // Notify admin via socket\r\n//       socket?.emit('test-submitted', {\r\n//         testId,\r\n//         studentId: userId,\r\n//         score,\r\n//         correctCount: correct,\r\n//         totalQuestions: total,\r\n//         isAutoSubmit,\r\n//         reason,\r\n//         timeSpent,\r\n//         violations: violations.length\r\n//       });\r\n\r\n//       setTestStatus('submitted');\r\n\r\n//       // Exit fullscreen\r\n//       if (document.fullscreenElement) {\r\n//         document.exitFullscreen();\r\n//       } else if (document.webkitFullscreenElement) {\r\n//         document.webkitExitFullscreen();\r\n//       } else if (document.msExitFullscreen) {\r\n//         document.msExitFullscreen();\r\n//       }\r\n\r\n//       // Call completion callback\r\n//       onTestComplete?.({\r\n//         score,\r\n//         correct,\r\n//         total,\r\n//         isAutoSubmit,\r\n//         reason,\r\n//         timeSpent,\r\n//         violations: violations.length\r\n//       });\r\n\r\n//     } catch (error) {\r\n//       console.error('Error submitting test:', error);\r\n      \r\n//       // Fallback: save to localStorage\r\n//       try {\r\n//         const { correct, total, score } = calculateScore();\r\n//         const fallbackData = {\r\n//           testId,\r\n//           score,\r\n//           correct,\r\n//           total,\r\n//           submittedAt: new Date().toISOString(),\r\n//           isAutoSubmit,\r\n//           reason\r\n//         };\r\n        \r\n//         const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\r\n//         existingFallbacks.push(fallbackData);\r\n//         localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\r\n        \r\n//         console.log('Test saved to localStorage as fallback');\r\n//       } catch (localError) {\r\n//         console.error('Error saving fallback:', localError);\r\n//       }\r\n      \r\n//       setTestStatus('error');\r\n//     } finally {\r\n//       setIsSubmitting(false);\r\n//     }\r\n//   };\r\n\r\n//   const formatTime = (seconds) => {\r\n//     const mins = Math.floor(seconds / 60);\r\n//     const secs = seconds % 60;\r\n//     return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n//   };\r\n\r\n//   // Enhanced keyboard and mouse prevention\r\n//   useEffect(() => {\r\n//     const preventContextMenu = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         e.preventDefault();\r\n//         addViolation('Right-click attempt');\r\n//         return false;\r\n//       }\r\n//     };\r\n\r\n//     const preventKeyboardShortcuts = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         // Prevent common shortcuts\r\n//         if (e.ctrlKey || e.metaKey || e.altKey) {\r\n//           e.preventDefault();\r\n//           addViolation('Keyboard shortcut attempt');\r\n//           return false;\r\n//         }\r\n        \r\n//         // Prevent function keys\r\n//         if (e.key.startsWith('F') && e.key.length > 1) {\r\n//           e.preventDefault();\r\n//           addViolation('Function key attempt');\r\n//           return false;\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     const preventSelection = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         e.preventDefault();\r\n//         return false;\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('contextmenu', preventContextMenu);\r\n//     document.addEventListener('keydown', preventKeyboardShortcuts);\r\n//     document.addEventListener('selectstart', preventSelection);\r\n//     document.addEventListener('dragstart', preventSelection);\r\n\r\n//     return () => {\r\n//       document.removeEventListener('contextmenu', preventContextMenu);\r\n//       document.removeEventListener('keydown', preventKeyboardShortcuts);\r\n//       document.removeEventListener('selectstart', preventSelection);\r\n//       document.removeEventListener('dragstart', preventSelection);\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Status screens\r\n//   if (testStatus === 'loading') {\r\n//     return (\r\n//       <div className=\"stc__loading-container\">\r\n//         <div className=\"stc__loading-content\">\r\n//           <div className=\"stc__loading-spinner\"></div>\r\n//           <h2 className=\"stc__loading-title\">Loading Test...</h2>\r\n//           <p className=\"stc__loading-subtitle\">Preparing your exam questions</p>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .stc__loading-container {\r\n//             min-height: 100vh;\r\n//             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//           }\r\n//           .stc__loading-content {\r\n//             text-align: center;\r\n//             background: rgba(255, 255, 255, 0.1);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(255, 255, 255, 0.2);\r\n//             border-radius: 20px;\r\n//             padding: 3rem 2rem;\r\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\r\n//           }\r\n//           .stc__loading-spinner {\r\n//             width: 48px;\r\n//             height: 48px;\r\n//             border: 4px solid rgba(255, 255, 255, 0.3);\r\n//             border-top: 4px solid #ffffff;\r\n//             border-radius: 50%;\r\n//             animation: stc-spin 1s linear infinite;\r\n//             margin: 0 auto 1.5rem;\r\n//           }\r\n//           .stc__loading-title {\r\n//             font-size: 1.5rem;\r\n//             font-weight: 600;\r\n//             color: #ffffff;\r\n//             margin: 0 0 0.5rem;\r\n//             letter-spacing: -0.025em;\r\n//           }\r\n//           .stc__loading-subtitle {\r\n//             color: rgba(255, 255, 255, 0.8);\r\n//             font-size: 0.95rem;\r\n//             margin: 0;\r\n//           }\r\n//           @keyframes stc-spin {\r\n//             0% { transform: rotate(0deg); }\r\n//             100% { transform: rotate(360deg); }\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'no-test') {\r\n//     return (\r\n//       <div className=\"stc__status-container stc__status-container--info\">\r\n//         <div className=\"stc__status-card\">\r\n//           <Clock className=\"stc__status-icon stc__status-icon--info\" />\r\n//           <h2 className=\"stc__status-title\">Test Not Found</h2>\r\n//           <p className=\"stc__status-text\">The requested test could not be found or is not available.</p>\r\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .stc__status-container {\r\n//             min-height: 100vh;\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//             padding: 1rem;\r\n//           }\r\n//           .stc__status-container--info {\r\n//             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n//           }\r\n//           .stc__status-card {\r\n//             background: rgba(255, 255, 255, 0.95);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(255, 255, 255, 0.3);\r\n//             border-radius: 24px;\r\n//             padding: 3rem 2rem;\r\n//             text-align: center;\r\n//             max-width: 400px;\r\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\r\n//           }\r\n//           .stc__status-icon {\r\n//             width: 4rem;\r\n//             height: 4rem;\r\n//             margin: 0 auto 1.5rem;\r\n//             display: block;\r\n//           }\r\n//           .stc__status-icon--info {\r\n//             color: #3b82f6;\r\n//           }\r\n//           .stc__status-title {\r\n//             font-size: 1.5rem;\r\n//             font-weight: 700;\r\n//             color: #1f2937;\r\n//             margin: 0 0 0.75rem;\r\n//             letter-spacing: -0.025em;\r\n//           }\r\n//           .stc__status-text {\r\n//             color: #6b7280;\r\n//             margin: 0 0 2rem;\r\n//             line-height: 1.6;\r\n//           }\r\n//           .stc__status-button {\r\n//             padding: 0.75rem 2rem;\r\n//             border-radius: 12px;\r\n//             font-weight: 600;\r\n//             font-size: 0.95rem;\r\n//             border: none;\r\n//             cursor: pointer;\r\n//             transition: all 0.2s;\r\n//           }\r\n//           .stc__status-button--primary {\r\n//             background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\r\n//             color: white;\r\n//           }\r\n//           .stc__status-button--primary:hover {\r\n//             transform: translateY(-2px);\r\n//             box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'test-ended') {\r\n//     return (\r\n//       <div className=\"stc__status-container stc__status-container--warning\">\r\n//         <div className=\"stc__status-card\">\r\n//           <AlertTriangle className=\"stc__status-icon stc__status-icon--warning\" />\r\n//           <h2 className=\"stc__status-title\">Test Time Expired</h2>\r\n//           <p className=\"stc__status-text\">The time limit for this test has already passed.</p>\r\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .stc__status-container--warning {\r\n//             background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\r\n//           }\r\n//           .stc__status-icon--warning {\r\n//             color: #f59e0b;\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'already-submitted') {\r\n//     return (\r\n//       <div className=\"stc__status-container stc__status-container--success\">\r\n//         <div className=\"stc__status-card\">\r\n//           <Send className=\"stc__status-icon stc__status-icon--success\" />\r\n//           <h2 className=\"stc__status-title\">Test Already Submitted</h2>\r\n//           <p className=\"stc__status-text\">You have already completed this test successfully.</p>\r\n//           <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--primary\">\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .stc__status-container--success {\r\n//             background: linear-gradient(135deg, #10b981 0%, #047857 100%);\r\n//           }\r\n//           .stc__status-icon--success {\r\n//             color: #10b981;\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'error') {\r\n//     return (\r\n//       <div className=\"stc__status-container stc__status-container--error\">\r\n//         <div className=\"stc__status-card\">\r\n//           <AlertTriangle className=\"stc__status-icon stc__status-icon--error\" />\r\n//           <h2 className=\"stc__status-title\">Test Error</h2>\r\n//           <p className=\"stc__status-text\">Unable to load or submit the test. Please contact your teacher.</p>\r\n//           <div className=\"stc__status-buttons\">\r\n//             <button onClick={() => window.location.reload()} className=\"stc__status-button stc__status-button--primary\">\r\n//               Try Again\r\n//             </button>\r\n//             <button onClick={() => window.history.back()} className=\"stc__status-button stc__status-button--secondary\">\r\n//               Go Back\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .stc__status-container--error {\r\n//             background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\r\n//           }\r\n//           .stc__status-icon--error {\r\n//             color: #ef4444;\r\n//           }\r\n//           .stc__status-buttons {\r\n//             display: flex;\r\n//             gap: 0.75rem;\r\n//             justify-content: center;\r\n//             flex-wrap: wrap;\r\n//           }\r\n//           .stc__status-button--secondary {\r\n//             background: rgba(107, 114, 128, 0.1);\r\n//             color: #374151;\r\n//             border: 1px solid rgba(107, 114, 128, 0.3);\r\n//           }\r\n//           .stc__status-button--secondary:hover {\r\n//             background: rgba(107, 114, 128, 0.2);\r\n//             transform: translateY(-1px);\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'submitted') {\r\n//     const { correct, total, score } = calculateScore();\r\n    \r\n//     return (\r\n//       <>\r\n//         <div className=\"stc__completion-container\">\r\n//           <div className=\"stc__completion-card\">\r\n//             <div className=\"stc__completion-icon-wrapper\">\r\n//               <Send className=\"stc__completion-icon\" />\r\n//             </div>\r\n//             <h2 className=\"stc__completion-title\">Test Submitted Successfully!</h2>\r\n//             <p className=\"stc__completion-subtitle\">Your test has been submitted and saved.</p>\r\n            \r\n//             <div className=\"stc__score-display\">\r\n//               <div className=\"stc__score-value\">{score}%</div>\r\n//               <div className=\"stc__score-details\">\r\n//                 {correct} out of {total} questions correct\r\n//               </div>\r\n//             </div>\r\n            \r\n//             {lateJoinTime > 0 && (\r\n//               <div className=\"stc__info-badge stc__info-badge--blue\">\r\n//                 <p className=\"stc__info-text\">\r\n//                   You joined {Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')} late\r\n//                 </p>\r\n//               </div>\r\n//             )}\r\n            \r\n//             {violations.length > 0 && (\r\n//               <div className=\"stc__info-badge stc__info-badge--yellow\">\r\n//                 <p className=\"stc__info-text\">\r\n//                   {violations.length} violation{violations.length > 1 ? 's' : ''} recorded\r\n//                 </p>\r\n//               </div>\r\n//             )}\r\n            \r\n//             <button onClick={() => window.history.back()} className=\"stc__completion-button stc__completion-button--primary\">   \r\n//               Return to Dashboard\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n        \r\n//         <style jsx>{`\r\n//           .stc__completion-container {\r\n//             min-height: 100vh;\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//             padding: 1rem;\r\n//             background: linear-gradient(135deg, #10b981 0%, #047857 100%);\r\n//           }\r\n//           .stc__completion-card {\r\n//             background: rgba(255, 255, 255, 0.95);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(255, 255, 255, 0.3);\r\n//             border-radius: 24px;\r\n//             padding: 3rem 2rem;\r\n//             text-align: center;\r\n//             max-width: 400px;\r\n//             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\r\n//           }\r\n//           .stc__completion-icon-wrapper {\r\n//             width: 4rem;\r\n//             height: 4rem;\r\n//             border-radius: 50%;\r\n//             background: rgba(0, 0, 0, 0.1);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             margin: 0 auto 2rem;\r\n//           }\r\n//           .stc__completion-icon {\r\n//             color: #10b981;\r\n//             width: 2rem;\r\n//             height: 2rem;\r\n//           }\r\n//           .stc__completion-title {\r\n//             font-size: 1.5rem;\r\n//             margin-bottom: 1rem;\r\n//           }\r\n//           .stc__completion-subtitle {\r\n//             font-size: 1rem;\r\n//             margin-bottom: 2rem;\r\n//           }\r\n//           .stc__score-display {\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             margin-bottom: 2rem;\r\n//           }\r\n//           .stc__score-value {\r\n//             font-size: 2rem;\r\n//             font-weight: 600;\r\n//             margin-right: 1rem;\r\n//           }\r\n//           .stc__score-details {\r\n//             font-size: 0.875rem;\r\n//           }\r\n//           .stc__info-badge {\r\n//             display: inline-block;\r\n//             padding: 0.25rem 0.5rem;\r\n//             border-radius: 4px;\r\n//             margin-right: 0.5rem;\r\n//             margin-bottom: 0.5rem;\r\n//             font-size: 0.875rem;\r\n//             font-weight: 500;\r\n//           }\r\n//           .stc__info-badge--blue {\r\n//             background: rgba(0, 0, 255, 0.1);\r\n//             color: #0000ff;\r\n//           }\r\n//           .stc__info-badge--yellow {\r\n//             background: rgba(255, 255, 0, 0.1);\r\n//             color: #ffff00;\r\n//           }\r\n//           .stc__completion-button {\r\n//             cursor: pointer;\r\n//             border: none;\r\n//             border-radius: 4px;\r\n//             padding: 0.5rem 1rem;\r\n//             font-size: 1rem;\r\n//             font-weight: 500;\r\n//             margin-top: 2rem;\r\n//           }\r\n//           .stc__completion-button--primary {\r\n//             background: #10b981;\r\n//             color: #fff;\r\n//           }\r\n//           .stc__completion-button--primary:hover {\r\n//             background: #047857;\r\n//           }\r\n//         `}</style>\r\n//       </>\r\n//     );\r\n//   };\r\n//   };\r\n  \r\n//   const TestContainer = ({ studentId, socket }) => {\r\n//   const API_URL = 'http://localhost:5000/api';\r\n//   const [activeTest, setActiveTest] = useState(null);\r\n//   const [showTest, setShowTest] = useState(false);\r\n//   const [testResult, setTestResult] = useState(null);\r\n//   const [loading, setLoading] = useState(true);\r\n//   const [error, setError] = useState(null);\r\n\r\n//   // Check for active tests using your existing API structure\r\n//   useEffect(() => {\r\n//     const checkForActiveTests = async () => {\r\n//       try {\r\n//         setLoading(true);\r\n//         setError(null);\r\n        \r\n//         const token = localStorage.getItem('token');\r\n//         const deviceId = localStorage.getItem('deviceId');\r\n        \r\n//         if (!token) {\r\n//           console.log('No token found');\r\n//           setError('No authentication token found. Please log in again.');\r\n//           setLoading(false);\r\n//           return;\r\n//         }\r\n\r\n//         console.log('Checking for active tests...');\r\n//         console.log('Token:', token ? 'Present' : 'Missing');\r\n//         console.log('Device ID:', deviceId);\r\n\r\n//         // Check for active tests that target this student\r\n//         const response = await fetch(`${API_URL}/student/tests/active`, {\r\n//           method: 'GET',\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           }\r\n//         });\r\n\r\n//         console.log('Response status:', response.status);\r\n        \r\n//         if (!response.ok) {\r\n//           if (response.status === 401) {\r\n//             setError('Authentication failed. Please log in again.');\r\n//             return;\r\n//           } else if (response.status === 403) {\r\n//             setError('Access denied. Please contact your teacher.');\r\n//             return;\r\n//           }\r\n//           throw new Error(`Failed to fetch tests: ${response.status}`);\r\n//         }\r\n\r\n//         const tests = await response.json();\r\n//         console.log('Received tests:', tests);\r\n        \r\n//         if (tests && tests.length > 0) {\r\n//           // Filter tests that are actually active and not expired\r\n//           const currentTime = new Date();\r\n//           const availableTests = tests.filter(test => {\r\n//             const testStart = new Date(test.startTime);\r\n//             const testEnd = new Date(testStart.getTime() + (test.duration * 60 * 1000));\r\n            \r\n//             console.log('Test:', test._id);\r\n//             console.log('Current time:', currentTime);\r\n//             console.log('Test start:', testStart);\r\n//             console.log('Test end:', testEnd);\r\n//             console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\r\n            \r\n//             return currentTime >= testStart && currentTime < testEnd;\r\n//           });\r\n          \r\n//           if (availableTests.length > 0) {\r\n//             console.log('Setting active test:', availableTests[0]);\r\n//             setActiveTest(availableTests[0]);\r\n//           } else {\r\n//             console.log('No available tests (all expired or not yet started)');\r\n//           }\r\n//         } else {\r\n//           console.log('No tests found');\r\n//         }\r\n//       } catch (error) {\r\n//         console.error('Error checking for active tests:', error);\r\n//         setError(`Error loading tests: ${error.message}`);\r\n//       } finally {\r\n//         setLoading(false);\r\n//       }\r\n//     };\r\n\r\n//     checkForActiveTests();\r\n\r\n//     // Check every 30 seconds for new tests\r\n//     const interval = setInterval(checkForActiveTests, 30000);\r\n//     return () => clearInterval(interval);\r\n//   }, [API_URL]);\r\n\r\n//   // Listen for test events from admin (if socket is available)\r\n//   useEffect(() => {\r\n//     if (socket) {\r\n//       const handleTestLaunched = (testData) => {\r\n//         console.log('Test launched event received:', testData);\r\n//         setActiveTest(testData);\r\n//       };\r\n\r\n//       const handleTestEnded = (data) => {\r\n//         console.log('Test ended event received:', data);\r\n//         if (activeTest && activeTest._id === data.testId) {\r\n//           setActiveTest(null);\r\n//           setShowTest(false);\r\n//         }\r\n//       };\r\n\r\n//       socket.on('test-launched', handleTestLaunched);\r\n//       socket.on('test-ended', handleTestEnded);\r\n\r\n//       return () => {\r\n//         socket.off('test-launched', handleTestLaunched);\r\n//         socket.off('test-ended', handleTestEnded);\r\n//       };\r\n//     }\r\n//   }, [socket, activeTest]);\r\n\r\n//   const handleStartTest = () => {\r\n//     console.log('Starting test:', activeTest);\r\n//     setShowTest(true);\r\n//   };\r\n\r\n//   const handleTestComplete = (result) => {\r\n//     console.log('Test completed:', result);\r\n//     setTestResult(result);\r\n//     setShowTest(false);\r\n//     setActiveTest(null);\r\n//   };\r\n\r\n//   if (loading) {\r\n//     return (\r\n//       <div className=\"tc__loading-container\">\r\n//         <div className=\"tc__loading-content\">\r\n//           <div className=\"tc__loading-spinner\"></div>\r\n//           <p className=\"tc__loading-text\">Checking for active tests...</p>\r\n//           <p className=\"tc__loading-subtext\">This may take a moment</p>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .tc__loading-container {\r\n//             min-height: 100vh;\r\n//             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//           }\r\n//           .tc__loading-content {\r\n//             text-align: center;\r\n//             background: rgba(255, 255, 255, 0.8);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(226, 232, 240, 0.5);\r\n//             border-radius: 20px;\r\n//             padding: 2rem;\r\n//             box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);\r\n//           }\r\n//           .tc__loading-spinner {\r\n//             width: 32px;\r\n//             height: 32px;\r\n//             border: 3px solid rgba(59, 130, 246, 0.3);\r\n//             border-top: 3px solid #3b82f6;\r\n//             border-radius: 50%;\r\n//             animation: tc-spin 1s linear infinite;\r\n//             margin: 0 auto 1rem;\r\n//           }\r\n//           .tc__loading-text {\r\n//             color: #374151;\r\n//             font-weight: 500;\r\n//             margin: 0 0 0.25rem;\r\n//           }\r\n//           .tc__loading-subtext {\r\n//             color: #9ca3af;\r\n//             font-size: 0.875rem;\r\n//             margin: 0;\r\n//           }\r\n//           @keyframes tc-spin {\r\n//             0% { transform: rotate(0deg); }\r\n//             100% { transform: rotate(360deg); }\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (error) {\r\n//     return (\r\n//       <div className=\"tc__error-container\">\r\n//         <div className=\"tc__error-card\">\r\n//           <AlertTriangle className=\"tc__error-icon\" />\r\n//           <h2 className=\"tc__error-title\">Error</h2>\r\n//           <p className=\"tc__error-text\">{error}</p>\r\n//           <div className=\"tc__error-actions\">\r\n//             <button onClick={() => window.location.reload()} className=\"tc__error-button tc__error-button--primary\">\r\n//               Retry\r\n//             </button>\r\n//             <button onClick={() => setError(null)} className=\"tc__error-button tc__error-button--secondary\">\r\n//               Dismiss\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .tc__error-container {\r\n//             min-height: 100vh;\r\n//             background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//             padding: 1rem;\r\n//           }\r\n//           .tc__error-card {\r\n//             background: rgba(255, 255, 255, 0.95);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(254, 202, 202, 0.5);\r\n//             border-radius: 20px;\r\n//             padding: 2rem;\r\n//             text-align: center;\r\n//             max-width: 400px;\r\n//             box-shadow: 0 10px 40px rgba(239, 68, 68, 0.1);\r\n//           }\r\n//           .tc__error-icon {\r\n//             width: 3rem;\r\n//             height: 3rem;\r\n//             color: #ef4444;\r\n//             margin: 0 auto 1rem;\r\n//           }\r\n//           .tc__error-title {\r\n//             font-size: 1.5rem;\r\n//             font-weight: 700;\r\n//             color: #dc2626;\r\n//             margin: 0 0 0.5rem;\r\n//           }\r\n//           .tc__error-text {\r\n//             color: #6b7280;\r\n//             margin: 0 0 2rem;\r\n//             line-height: 1.5;\r\n//           }\r\n//           .tc__error-actions {\r\n//             display: flex;\r\n//             gap: 0.75rem;\r\n//             justify-content: center;\r\n//           }\r\n//           .tc__error-button {\r\n//             padding: 0.75rem 1.5rem;\r\n//             border-radius: 10px;\r\n//             font-weight: 600;\r\n//             border: none;\r\n//             cursor: pointer;\r\n//             transition: all 0.2s;\r\n//           }\r\n//           .tc__error-button--primary {\r\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n//             color: white;\r\n//           }\r\n//           .tc__error-button--primary:hover {\r\n//             background: linear-gradient(135deg, #2563eb, #1e40af);\r\n//             transform: translateY(-1px);\r\n//           }\r\n//           .tc__error-button--secondary {\r\n//             background: rgba(107, 114, 128, 0.1);\r\n//             color: #374151;\r\n//             border: 1px solid rgba(107, 114, 128, 0.3);\r\n//           }\r\n//           .tc__error-button--secondary:hover {\r\n//             background: rgba(107, 114, 128, 0.2);\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (showTest && activeTest) {\r\n//     return (\r\n//       <StudentTestComponent\r\n//         testId={activeTest._id || activeTest.id}\r\n//         onTestComplete={handleTestComplete}\r\n//         socket={socket}\r\n//       />\r\n//     );\r\n//   }\r\n\r\n//   if (testResult) {\r\n//     return (\r\n//       <div className=\"tc__result-container\">\r\n//         <div className=\"tc__result-card\">\r\n//           <h2 className=\"tc__result-title\">Test Complete!</h2>\r\n//           <div className=\"tc__result-score\">{testResult.score}%</div>\r\n//           <p className=\"tc__result-details\">\r\n//             You answered {testResult.correct} out of {testResult.total} questions correctly.\r\n//           </p>\r\n//           {testResult.isAutoSubmit && (\r\n//             <div className=\"tc__result-info tc__result-info--warning\">\r\n//               <p className=\"tc__result-info-text\">\r\n//                 <strong>Note:</strong> Test was auto-submitted due to: {testResult.reason}\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n//           {testResult.violations > 0 && (\r\n//             <div className=\"tc__result-info tc__result-info--error\">\r\n//               <p className=\"tc__result-info-text\">\r\n//                 <strong>Security Violations:</strong> {testResult.violations} recorded\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n//           <button onClick={() => setTestResult(null)} className=\"tc__result-button\">\r\n//             Continue\r\n//           </button>\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .tc__result-container {\r\n//             min-height: 100vh;\r\n//             background: linear-gradient(135deg, #dcfdf7 0%, #a7f3d0 100%);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//             padding: 1rem;\r\n//           }\r\n//           .tc__result-card {\r\n//             background: rgba(255, 255, 255, 0.95);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(167, 243, 208, 0.5);\r\n//             border-radius: 20px;\r\n//             padding: 2rem;\r\n//             text-align: center;\r\n//             max-width: 400px;\r\n//             box-shadow: 0 10px 40px rgba(16, 185, 129, 0.1);\r\n//           }\r\n//           .tc__result-title {\r\n//             font-size: 1.75rem;\r\n//             font-weight: 700;\r\n//             color: #065f46;\r\n//             margin: 0 0 1rem;\r\n//           }\r\n//           .tc__result-score {\r\n//             font-size: 3rem;\r\n//             font-weight: 800;\r\n//             background: linear-gradient(135deg, #059669, #047857);\r\n//             -webkit-background-clip: text;\r\n//             -webkit-text-fill-color: transparent;\r\n//             background-clip: text;\r\n//             margin: 0 0 0.5rem;\r\n//           }\r\n//           .tc__result-details {\r\n//             color: #6b7280;\r\n//             margin: 0 0 1.5rem;\r\n//           }\r\n//           .tc__result-info {\r\n//             border-radius: 10px;\r\n//             padding: 0.75rem;\r\n//             margin: 0 0 1rem;\r\n//             border: 1px solid;\r\n//           }\r\n//           .tc__result-info--warning {\r\n//             background: rgba(245, 158, 11, 0.1);\r\n//             border-color: rgba(245, 158, 11, 0.3);\r\n//           }\r\n//           .tc__result-info--error {\r\n//             background: rgba(239, 68, 68, 0.1);\r\n//             border-color: rgba(239, 68, 68, 0.3);\r\n//           }\r\n//           .tc__result-info-text {\r\n//             margin: 0;\r\n//             font-size: 0.875rem;\r\n//             font-weight: 500;\r\n//           }\r\n//           .tc__result-info--warning .tc__result-info-text {\r\n//             color: #92400e;\r\n//           }\r\n//           .tc__result-info--error .tc__result-info-text {\r\n//             color: #b91c1c;\r\n//           }\r\n//           .tc__result-button {\r\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n//             color: white;\r\n//             padding: 0.875rem 2rem;\r\n//             border-radius: 12px;\r\n//             font-weight: 600;\r\n//             border: none;\r\n//             cursor: pointer;\r\n//             transition: all 0.3s;\r\n//           }\r\n//           .tc__result-button:hover {\r\n//             background: linear-gradient(135deg, #2563eb, #1e40af);\r\n//             transform: translateY(-2px);\r\n//             box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (activeTest) {\r\n//     const now = new Date();\r\n//     const testStart = new Date(activeTest.startTime);\r\n//     const testEnd = new Date(testStart.getTime() + (activeTest.duration * 60 * 1000));\r\n//     const isTestTime = now >= testStart && now < testEnd;\r\n//     const isTestOver = now >= testEnd;\r\n    \r\n//     console.log('Active test found:', {\r\n//       testId: activeTest._id,\r\n//       now: now.toISOString(),\r\n//       start: testStart.toISOString(),\r\n//       end: testEnd.toISOString(),\r\n//       isTestTime,\r\n//       isTestOver\r\n//     });\r\n    \r\n//     if (isTestOver) {\r\n//       return (\r\n//         <div className=\"tc__expired-container\">\r\n//           <div className=\"tc__expired-card\">\r\n//             <AlertTriangle className=\"tc__expired-icon\" />\r\n//             <h2 className=\"tc__expired-title\">Test Expired</h2>\r\n//             <p className=\"tc__expired-text\">The time limit for this test has passed.</p>\r\n//             <button onClick={() => setActiveTest(null)} className=\"tc__expired-button\">\r\n//               Continue\r\n//             </button>\r\n//           </div>\r\n//           <style jsx>{`\r\n//             .tc__expired-container {\r\n//               min-height: 100vh;\r\n//               background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\r\n//               display: flex;\r\n//               align-items: center;\r\n//               justify-content: center;\r\n//               font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//               padding: 1rem;\r\n//             }\r\n//             .tc__expired-card {\r\n//               background: rgba(255, 255, 255, 0.95);\r\n//               backdrop-filter: blur(20px);\r\n//               border: 1px solid rgba(253, 230, 138, 0.5);\r\n//               border-radius: 20px;\r\n//               padding: 2rem;\r\n//               text-align: center;\r\n//               max-width: 400px;\r\n//               box-shadow: 0 10px 40px rgba(245, 158, 11, 0.1);\r\n//             }\r\n//             .tc__expired-icon {\r\n//               width: 4rem;\r\n//               height: 4rem;\r\n//               color: #f59e0b;\r\n//               margin: 0 auto 1rem;\r\n//             }\r\n//             .tc__expired-title {\r\n//               font-size: 1.5rem;\r\n//               font-weight: 700;\r\n//               color: #92400e;\r\n//               margin: 0 0 0.5rem;\r\n//             }\r\n//             .tc__expired-text {\r\n//               color: #6b7280;\r\n//               margin: 0 0 2rem;\r\n//             }\r\n//             .tc__expired-button {\r\n//               background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n//               color: white;\r\n//               padding: 0.75rem 2rem;\r\n//               border-radius: 12px;\r\n//               font-weight: 600;\r\n//               border: none;\r\n//               cursor: pointer;\r\n//               transition: all 0.3s;\r\n//             }\r\n//             .tc__expired-button:hover {\r\n//               background: linear-gradient(135deg, #2563eb, #1e40af);\r\n//               transform: translateY(-2px);\r\n//               box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n//             }\r\n//           `}</style>\r\n//         </div>\r\n//       );\r\n//     }\r\n    \r\n//     return (\r\n//       <div className=\"tc__waiting-container\">\r\n//         <div className=\"tc__waiting-card\">\r\n//           <div className=\"tc__waiting-icon-wrapper\">\r\n//             <Calculator className=\"tc__waiting-icon\" />\r\n//           </div>\r\n//           <h2 className=\"tc__waiting-title\">Test Available</h2>\r\n//           <p className=\"tc__waiting-subtitle\">\r\n//             {activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1)} ‚Ä¢ {activeTest.duration} minutes ‚Ä¢ {activeTest.count} questions\r\n//           </p>\r\n//           <p className=\"tc__waiting-difficulty\">\r\n//             Difficulty: {activeTest.difficultyLevel}\r\n//           </p>\r\n          \r\n//           <div className=\"tc__waiting-info\">\r\n//             <p className=\"tc__waiting-info-text\">\r\n//               <strong>Test ID:</strong> {activeTest._id}\r\n//             </p>\r\n//             <p className=\"tc__waiting-info-text\">\r\n//               <strong>Started:</strong> {testStart.toLocaleString()}\r\n//             </p>\r\n//           </div>\r\n          \r\n//           {isTestTime ? (\r\n//             <>\r\n//               <p className=\"tc__waiting-instruction\">\r\n//                 Click below to start your test. Ensure you're in a quiet environment with stable internet.\r\n//               </p>\r\n//               <div className=\"tc__waiting-warning\">\r\n//                 <p className=\"tc__waiting-warning-text\">\r\n//                   <strong>Important:</strong> Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\r\n//                 </p>\r\n//               </div>\r\n//               <button onClick={handleStartTest} className=\"tc__waiting-button tc__waiting-button--start\">\r\n//                 Start Test\r\n//               </button>\r\n//             </>\r\n//           ) : (\r\n//             <>\r\n//               <p className=\"tc__waiting-instruction\">\r\n//                 Test starts at: {testStart.toLocaleString()}\r\n//               </p>\r\n//               <div className=\"tc__waiting-info\">\r\n//                 <p className=\"tc__waiting-info-text\">\r\n//                   Please wait for the scheduled start time.\r\n//                 </p>\r\n//               </div>\r\n//             </>\r\n//           )}\r\n//         </div>\r\n//         <style jsx>{`\r\n//           .tc__waiting-container {\r\n//             min-height: 100vh;\r\n//             background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//             padding: 1rem;\r\n//           }\r\n//           .tc__waiting-card {\r\n//             background: rgba(255, 255, 255, 0.95);\r\n//             backdrop-filter: blur(20px);\r\n//             border: 1px solid rgba(191, 219, 254, 0.5);\r\n//             border-radius: 20px;\r\n//             padding: 2rem;\r\n//             text-align: center;\r\n//             max-width: 500px;\r\n//             box-shadow: 0 10px 40px rgba(59, 130, 246, 0.1);\r\n//           }\r\n//           .tc__waiting-icon-wrapper {\r\n//             width: 4rem;\r\n//             height: 4rem;\r\n//             background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n//             border-radius: 50%;\r\n//             display: flex;\r\n//             align-items: center;\r\n//             justify-content: center;\r\n//             margin: 0 auto 1rem;\r\n//             box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n//           }\r\n//           .tc__waiting-icon {\r\n//             width: 2rem;\r\n//             height: 2rem;\r\n//             color: white;\r\n//           }\r\n//           .tc__waiting-title {\r\n//             font-size: 1.75rem;\r\n//             font-weight: 700;\r\n//             color: #1e40af;\r\n//             margin: 0 0 0.5rem;\r\n//           }\r\n//           .tc__waiting-subtitle {\r\n//             color: #6b7280;\r\n//             margin: 0 0 0.5rem;\r\n//           }\r\n//           .tc__waiting-difficulty {\r\n//             color: #9ca3af;\r\n//             font-size: 0.875rem;\r\n//             margin: 0 0 1.5rem;\r\n//           }\r\n//           .tc__waiting-info {\r\n//             background: linear-gradient(135deg, #eff6ff, #dbeafe);\r\n//             border: 1px solid rgba(147, 197, 253, 0.3);\r\n//             border-radius: 12px;\r\n//             padding: 1rem;\r\n//             margin: 0 0 1.5rem;\r\n//           }\r\n//           .tc__waiting-info-text {\r\n//             color: #1e40af;\r\n//             font-size: 0.875rem;\r\n//             margin: 0 0 0.25rem;\r\n//           }\r\n//           .tc__waiting-info-text:last-child {\r\n//             margin-bottom: 0;\r\n//           }\r\n//           .tc__waiting-instruction {\r\n//             color: #6b7280;\r\n//             font-size: 0.95rem;\r\n//             margin: 0 0 1rem;\r\n//             line-height: 1.5;\r\n//           }\r\n//           .tc__waiting-warning {\r\n//             background: linear-gradient(135deg, #fef3c7, #fde68a);\r\n//             border: 1px solid rgba(245, 158, 11, 0.3);\r\n//             border-radius: 12px;\r\n//             padding: 0.75rem;\r\n//             margin: 0 0 1.5rem;\r\n//           }\r\n//           .tc__waiting-warning-text {\r\n//             color: #92400e;\r\n//             font-size: 0.875rem;\r\n//             margin: 0;\r\n//           }\r\n//           .tc__waiting-button {\r\n//             padding: 1rem 2.5rem;\r\n//             border-radius: 12px;\r\n//             font-weight: 600;\r\n//             font-size: 1.125rem;\r\n//             border: none;\r\n//             cursor: pointer;\r\n//             transition: all 0.3s;\r\n//           }\r\n//           .tc__waiting-button--start {\r\n//             background: linear-gradient(135deg, #10b981, #047857);\r\n//             color: white;\r\n//           }\r\n//           .tc__waiting-button--start:hover {\r\n//             background: linear-gradient(135deg, #059669, #065f46);\r\n//             transform: translateY(-2px);\r\n//             box-shadow: 0 12px 30px rgba(16, 185, 129, 0.3);\r\n//           }\r\n//         `}</style>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   return (\r\n//     <div className=\"tc__empty-container\">\r\n//       <div className=\"tc__empty-content\">\r\n//         <div className=\"tc__empty-icon-wrapper\">\r\n//           <Clock className=\"tc__empty-icon\" />\r\n//         </div>\r\n//         <h2 className=\"tc__empty-title\">No Active Tests</h2>\r\n//         <p className=\"tc__empty-text\">Check back later for new assignments.</p>\r\n        \r\n//         <div className=\"tc__debug-info\">\r\n//           <p className=\"tc__debug-title\"><strong>Debug Info:</strong></p>\r\n//           <p className=\"tc__debug-item\">Token: {localStorage.getItem('token') ? 'Present' : 'Missing'}</p>\r\n//           <p className=\"tc__debug-item\">Device ID: {localStorage.getItem('deviceId') || 'Missing'}</p>\r\n//           <p className=\"tc__debug-item\">User ID: {localStorage.getItem('userId') || 'Missing'}</p>\r\n//           <p className=\"tc__debug-item\">Last checked: {new Date().toLocaleTimeString()}</p>\r\n//         </div>\r\n        \r\n//         <button onClick={() => window.location.reload()} className=\"tc__empty-button\">\r\n//           Refresh\r\n//         </button>\r\n//       </div>\r\n//       <style jsx>{`\r\n//         .tc__empty-container {\r\n//           min-height: 100vh;\r\n//           background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n//           display: flex;\r\n//           align-items: center;\r\n//           justify-content: center;\r\n//           font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n//           padding: 1rem;\r\n//         }\r\n//         .tc__empty-content {\r\n//           text-align: center;\r\n//           background: rgba(255, 255, 255, 0.8);\r\n//           backdrop-filter: blur(20px);\r\n//           border: 1px solid rgba(226, 232, 240, 0.5);\r\n//           border-radius: 20px;\r\n//           padding: 2rem;\r\n//           max-width: 500px;\r\n//           box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);\r\n//         }\r\n//         .tc__empty-icon-wrapper {\r\n//           width: 4rem;\r\n//           height: 4rem;\r\n//           background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n//           border-radius: 50%;\r\n//           display: flex;\r\n//           align-items: center;\r\n//           justify-content: center;\r\n//           margin: 0 auto 1rem;\r\n//         }\r\n//         .tc__empty-icon {\r\n//           width: 2rem;\r\n//           height: 2rem;\r\n//           color: #9ca3af;\r\n//         }\r\n//         .tc__empty-title {\r\n//           font-size: 1.25rem;\r\n//           font-weight: 600;\r\n//           color: #6b7280;\r\n//           margin: 0 0 0.5rem;\r\n//         }\r\n//         .tc__empty-text {\r\n//           color: #9ca3af;\r\n//           margin: 0 0 2rem;\r\n//         }\r\n//         .tc__debug-info {\r\n//           background: linear-gradient(135deg, #f9fafb, #f3f4f6);\r\n//           border: 1px solid rgba(209, 213, 219, 0.5);\r\n//           border-radius: 12px;\r\n//           padding: 1rem;\r\n//           margin: 0 0 1.5rem;\r\n//           text-align: left;\r\n//           font-size: 0.75rem;\r\n//         }\r\n//         .tc__debug-title {\r\n//           color: #374151;\r\n//           margin: 0 0 0.5rem;\r\n//           font-size: 0.75rem;\r\n//         }\r\n//         .tc__debug-item {\r\n//           color: #6b7280;\r\n//           margin: 0.25rem 0;\r\n//           font-size: 0.75rem;\r\n//         }\r\n//         .tc__empty-button {\r\n//           background: linear-gradient(135deg, #3b82f6, #1d4ed8);\r\n//           color: white;\r\n//           padding: 0.75rem 1.5rem;\r\n//           border-radius: 10px;\r\n//           font-weight: 600;\r\n//           border: none;\r\n//           cursor: pointer;\r\n//           transition: all 0.3s;\r\n//         }\r\n//         .tc__empty-button:hover {\r\n//           background: linear-gradient(135deg, #2563eb, #1e40af);\r\n//           transform: translateY(-2px);\r\n//           box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\r\n//         }\r\n\r\n//         @media (max-width: 768px) {\r\n//           .tc__empty-content {\r\n//             padding: 1.5rem;\r\n//           }\r\n//           .tc__waiting-card {\r\n//             padding: 1.5rem;\r\n//           }\r\n//           .tc__result-card {\r\n//             padding: 1.5rem;\r\n//           }\r\n//         }\r\n\r\n//         @media (max-width: 480px) {\r\n//           .tc__empty-content,\r\n//           .tc__waiting-card,\r\n//           .tc__result-card,\r\n//           .tc__error-card,\r\n//           .tc__expired-card {\r\n//             padding: 1rem;\r\n//             margin: 0.5rem;\r\n//           }\r\n//           .tc__waiting-button {\r\n//             width: 100%;\r\n//             padding: 1rem;\r\n//           }\r\n//           .tc__result-score {\r\n//             font-size: 2.5rem;\r\n//           }\r\n//         }\r\n//       `}</style>\r\n//     </div>\r\n//   );\r\n// };\r\n\r\n// export default TestContainer;\r\n\r\n\r\n// import React, { useState, useEffect, useRef } from 'react';\r\n// import { Clock, AlertTriangle, Send, Lock, Calculator } from 'lucide-react';\r\n\r\n// const StudentTestComponent = ({ testId, onTestComplete, socket }) => {\r\n//   const API_URL = 'http://localhost:5000/api';\r\n  \r\n//   const [testData, setTestData] = useState(null);\r\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\r\n//   const [answers, setAnswers] = useState([]);\r\n//   const [timeRemaining, setTimeRemaining] = useState(0);\r\n//   const [testStatus, setTestStatus] = useState('loading');\r\n//   const [isFullscreen, setIsFullscreen] = useState(false);\r\n//   const [violations, setViolations] = useState([]);\r\n//   const [isSubmitting, setIsSubmitting] = useState(false);\r\n//   const [lateJoinTime, setLateJoinTime] = useState(0);\r\n  \r\n//   const testContainerRef = useRef(null);\r\n//   const startTimeRef = useRef(null);\r\n//   const timerRef = useRef(null);\r\n//   const visibilityTimeoutRef = useRef(null);\r\n\r\n//   // Generate math questions based on test parameters\r\n//   const generateQuestions = (testType, count, difficultyLevel) => {\r\n//     const questions = [];\r\n    \r\n//     for (let i = 0; i < count; i++) {\r\n//       let question, correctAnswer;\r\n//       let num1, num2;\r\n      \r\n//       // Set difficulty ranges\r\n//       switch (difficultyLevel) {\r\n//         case 'easy':\r\n//           num1 = Math.floor(Math.random() * 10) + 1;\r\n//           num2 = Math.floor(Math.random() * 10) + 1;\r\n//           break;\r\n//         case 'medium':\r\n//           num1 = Math.floor(Math.random() * 50) + 1;\r\n//           num2 = Math.floor(Math.random() * 50) + 1;\r\n//           break;\r\n//         case 'double':\r\n//           num1 = Math.floor(Math.random() * 99) + 1;\r\n//           num2 = Math.floor(Math.random() * 99) + 1;\r\n//           break;\r\n//         default:\r\n//           num1 = Math.floor(Math.random() * 20) + 1;\r\n//           num2 = Math.floor(Math.random() * 20) + 1;\r\n//       }\r\n      \r\n//       // Generate based on test type\r\n//       switch (testType) {\r\n//         case 'multiplication':\r\n//           question = `${num1} √ó ${num2} = ?`;\r\n//           correctAnswer = (num1 * num2).toString();\r\n//           break;\r\n//         case 'addition':\r\n//           question = `${num1} + ${num2} = ?`;\r\n//           correctAnswer = (num1 + num2).toString();\r\n//           break;\r\n//         case 'subtraction':\r\n//           // Ensure positive result\r\n//           if (num1 < num2) [num1, num2] = [num2, num1];\r\n//           question = `${num1} - ${num2} = ?`;\r\n//           correctAnswer = (num1 - num2).toString();\r\n//           break;\r\n//         case 'division':\r\n//           // Ensure whole number division\r\n//           const product = num1 * num2;\r\n//           question = `${product} √∑ ${num1} = ?`;\r\n//           correctAnswer = num2.toString();\r\n//           break;\r\n//         default:\r\n//           question = `${num1} √ó ${num2} = ?`;\r\n//           correctAnswer = (num1 * num2).toString();\r\n//       }\r\n      \r\n//       questions.push({\r\n//         question,\r\n//         correctAnswer,\r\n//         type: testType,\r\n//         options: [] // Empty for math problems (text input)\r\n//       });\r\n//     }\r\n    \r\n//     return questions;\r\n//   };\r\n\r\n//   // Fetch test data from your existing backend\r\n//   useEffect(() => {\r\n//     const fetchTestData = async () => {\r\n//       try {\r\n//         const token = localStorage.getItem('token');\r\n//         const deviceId = localStorage.getItem('deviceId');\r\n\r\n//         if (!token) {\r\n//           setTestStatus('error');\r\n//           return;\r\n//         }\r\n\r\n//         // Fetch the test details first\r\n//         const response = await fetch(`${API_URL}/student/tests/${testId}`, {\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           }\r\n//         });\r\n\r\n//         if (!response.ok) {\r\n//           if (response.status === 404) {\r\n//             setTestStatus('no-test');\r\n//             console.warn('Test not found or inactive');\r\n//             return;\r\n//           }\r\n//           throw new Error('Failed to load test');\r\n//         }\r\n\r\n//         const testDetails = await response.json();\r\n        \r\n//         // Check if test is still active and not past end time\r\n//         const now = new Date();\r\n//         const testStart = new Date(testDetails.startTime);\r\n//         const testEnd = new Date(testStart.getTime() + (testDetails.duration * 60 * 1000));\r\n        \r\n//         if (now > testEnd) {\r\n//           setTestStatus('test-ended');\r\n//           return;\r\n//         }\r\n\r\n//         // Check if student already submitted\r\n//         const userId = localStorage.getItem('userId') || 'anonymous';\r\n//         const existingResult = testDetails.results?.find(r => r.studentId === userId);\r\n//         if (existingResult) {\r\n//           setTestStatus('already-submitted');\r\n//           return;\r\n//         }\r\n\r\n//         // Calculate late join time if applicable\r\n//         let adjustedTimeRemaining = testDetails.duration * 60; // Convert to seconds\r\n//         let lateJoinSeconds = 0;\r\n        \r\n//         if (now > testStart) {\r\n//           lateJoinSeconds = Math.floor((now - testStart) / 1000);\r\n//           adjustedTimeRemaining = Math.max(0, adjustedTimeRemaining - lateJoinSeconds);\r\n//           setLateJoinTime(lateJoinSeconds);\r\n//         }\r\n\r\n//         // Generate questions if not provided\r\n//         let questions = testDetails.questions || [];\r\n//         if (questions.length === 0) {\r\n//           questions = generateQuestions(\r\n//             testDetails.testType, \r\n//             testDetails.count, \r\n//             testDetails.difficultyLevel\r\n//           );\r\n//         }\r\n\r\n//         const processedTestData = {\r\n//           ...testDetails,\r\n//           questions,\r\n//           gameType: testDetails.testType // For compatibility\r\n//         };\r\n\r\n//         setTestData(processedTestData);\r\n//         setTimeRemaining(adjustedTimeRemaining);\r\n//         setAnswers(new Array(questions.length).fill(''));\r\n//         setTestStatus('active');\r\n//         startTimeRef.current = Date.now();\r\n        \r\n//         // Notify admin via socket\r\n//         socket?.emit('test-started', { \r\n//           testId: testDetails._id,\r\n//           studentId: userId,\r\n//           lateJoinSeconds\r\n//         });\r\n\r\n//       } catch (error) {\r\n//         console.error('Error loading test:', error);\r\n//         setTestStatus('error');\r\n//       }\r\n//     };\r\n\r\n//     if (testId) {\r\n//       fetchTestData();\r\n//     }\r\n//   }, [testId, socket, API_URL]);\r\n\r\n//   // Enhanced fullscreen handling\r\n//   useEffect(() => {\r\n//     const enterFullscreen = async () => {\r\n//       try {\r\n//         if (testContainerRef.current && !isFullscreen) {\r\n//           if (testContainerRef.current.requestFullscreen) {\r\n//             await testContainerRef.current.requestFullscreen();\r\n//           } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n//             await testContainerRef.current.webkitRequestFullscreen();\r\n//           } else if (testContainerRef.current.msRequestFullscreen) {\r\n//             await testContainerRef.current.msRequestFullscreen();\r\n//           }\r\n//           setIsFullscreen(true);\r\n//         }\r\n//       } catch (error) {\r\n//         console.warn('Fullscreen not supported:', error);\r\n//         // Continue test even without fullscreen\r\n//       }\r\n//     };\r\n\r\n//     if (testStatus === 'active' && testContainerRef.current) {\r\n//       enterFullscreen();\r\n//     }\r\n//   }, [testStatus]);\r\n\r\n//   // Handle fullscreen changes with stricter enforcement\r\n//   useEffect(() => {\r\n//     const handleFullscreenChange = () => {\r\n//       const isCurrentlyFullscreen = Boolean(\r\n//         document.fullscreenElement || \r\n//         document.webkitFullscreenElement || \r\n//         document.msFullscreenElement\r\n//       );\r\n//       setIsFullscreen(isCurrentlyFullscreen);\r\n      \r\n//       if (!isCurrentlyFullscreen && testStatus === 'active') {\r\n//         addViolation('Exited fullscreen mode');\r\n        \r\n//         // Try to re-enter fullscreen immediately\r\n//         if (testContainerRef.current) {\r\n//           const enterFullscreen = async () => {\r\n//             try {\r\n//               if (testContainerRef.current.requestFullscreen) {\r\n//                 await testContainerRef.current.requestFullscreen();\r\n//               } else if (testContainerRef.current.webkitRequestFullscreen) {\r\n//                 await testContainerRef.current.webkitRequestFullscreen();\r\n//               }\r\n//             } catch (error) {\r\n//               // If can't re-enter after 3 violations, auto-submit\r\n//               if (violations.length >= 2) {\r\n//                 handleAutoSubmit('Multiple fullscreen violations');\r\n//               }\r\n//             }\r\n//           };\r\n//           enterFullscreen();\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n//     document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n//     document.addEventListener('msfullscreenchange', handleFullscreenChange);\r\n    \r\n//     return () => {\r\n//       document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n//       document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n//       document.removeEventListener('msfullscreenchange', handleFullscreenChange);\r\n//     };\r\n//   }, [testStatus, violations]);\r\n\r\n//   // Enhanced visibility handling\r\n//   useEffect(() => {\r\n//     const handleVisibilityChange = () => {\r\n//       if (document.hidden && testStatus === 'active') {\r\n//         addViolation('Switched to another tab/window');\r\n        \r\n//         // Shorter timeout for tab switching - 3 seconds\r\n//         visibilityTimeoutRef.current = setTimeout(() => {\r\n//           if (document.hidden) {\r\n//             handleAutoSubmit('Tab switching violation - remained hidden');\r\n//           }\r\n//         }, 3000);\r\n//       } else if (!document.hidden && visibilityTimeoutRef.current) {\r\n//         clearTimeout(visibilityTimeoutRef.current);\r\n//         visibilityTimeoutRef.current = null;\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('visibilitychange', handleVisibilityChange);\r\n//     return () => {\r\n//       document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n//       if (visibilityTimeoutRef.current) {\r\n//         clearTimeout(visibilityTimeoutRef.current);\r\n//       }\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Enhanced browser navigation prevention\r\n//   useEffect(() => {\r\n//     const handleBeforeUnload = (event) => {\r\n//       if (testStatus === 'active') {\r\n//         event.preventDefault();\r\n//         event.returnValue = 'Your test is in progress. Leaving will auto-submit your test.';\r\n//         return event.returnValue;\r\n//       }\r\n//     };\r\n\r\n//     const handlePopState = (event) => {\r\n//       if (testStatus === 'active') {\r\n//         event.preventDefault();\r\n//         window.history.pushState(null, '', window.location.pathname);\r\n//         addViolation('Browser navigation attempt');\r\n//         handleAutoSubmit('Navigation attempt during test');\r\n//       }\r\n//     };\r\n\r\n//     // Push current state to prevent back navigation\r\n//     window.history.pushState(null, '', window.location.pathname);\r\n    \r\n//     window.addEventListener('beforeunload', handleBeforeUnload);\r\n//     window.addEventListener('popstate', handlePopState);\r\n\r\n//     return () => {\r\n//       window.removeEventListener('beforeunload', handleBeforeUnload);\r\n//       window.removeEventListener('popstate', handlePopState);\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Timer countdown with auto-submit\r\n//   useEffect(() => {\r\n//     if (testStatus === 'active' && timeRemaining > 0) {\r\n//       timerRef.current = setInterval(() => {\r\n//         setTimeRemaining(prev => {\r\n//           if (prev <= 1) {\r\n//             handleAutoSubmit('Time expired');\r\n//             return 0;\r\n//           }\r\n//           return prev - 1;\r\n//         });\r\n//       }, 1000);\r\n\r\n//       return () => {\r\n//         if (timerRef.current) {\r\n//           clearInterval(timerRef.current);\r\n//         }\r\n//       };\r\n//     }\r\n//   }, [testStatus, timeRemaining]);\r\n\r\n//   // Send progress updates to admin\r\n//   useEffect(() => {\r\n//     if (testStatus === 'active' && socket) {\r\n//       const progressInterval = setInterval(() => {\r\n//         const answeredCount = answers.filter(a => a.trim() !== '').length;\r\n//         const progress = (answeredCount / answers.length) * 100;\r\n        \r\n//         socket.emit('test-progress', {\r\n//           testId,\r\n//           studentId: localStorage.getItem('userId') || 'anonymous',\r\n//           progress: Math.round(progress),\r\n//           currentQuestion: currentQuestionIndex + 1,\r\n//           answeredQuestions: answeredCount,\r\n//           timeRemaining\r\n//         });\r\n//       }, 5000);\r\n\r\n//       return () => clearInterval(progressInterval);\r\n//     }\r\n//   }, [testStatus, answers, currentQuestionIndex, socket, testId, timeRemaining]);\r\n\r\n//   const addViolation = (violation) => {\r\n//     setViolations(prev => {\r\n//       const newViolations = [...prev, {\r\n//         type: violation,\r\n//         timestamp: new Date().toISOString()\r\n//       }];\r\n      \r\n//       // Auto-submit after 3 violations\r\n//       if (newViolations.length >= 3) {\r\n//         setTimeout(() => handleAutoSubmit('Maximum violations exceeded'), 100);\r\n//       }\r\n      \r\n//       return newViolations;\r\n//     });\r\n//   };\r\n\r\n//   const handleAutoSubmit = async (reason) => {\r\n//     if (isSubmitting) return;\r\n    \r\n//     console.log(`Auto-submitting test: ${reason}`);\r\n//     await submitTest(true, reason);\r\n//   };\r\n\r\n//   const handleAnswerChange = (questionIndex, value) => {\r\n//     const newAnswers = [...answers];\r\n//     newAnswers[questionIndex] = value.trim();\r\n//     setAnswers(newAnswers);\r\n//   };\r\n\r\n//   const calculateScore = () => {\r\n//     if (!testData) return { correct: 0, total: 0, score: 0 };\r\n    \r\n//     let correct = 0;\r\n//     testData.questions.forEach((question, index) => {\r\n//       const userAnswer = answers[index]?.trim().toLowerCase();\r\n//       const correctAnswer = question.correctAnswer?.trim().toLowerCase();\r\n      \r\n//       if (userAnswer === correctAnswer) {\r\n//         correct++;\r\n//       }\r\n//     });\r\n    \r\n//     const total = testData.questions.length;\r\n//     const score = total > 0 ? Math.round((correct / total) * 100) : 0;\r\n    \r\n//     return { correct, total, score };\r\n//   };\r\n\r\n//   const submitTest = async (isAutoSubmit = false, reason = '') => {\r\n//     if (isSubmitting) return;\r\n    \r\n//     setIsSubmitting(true);\r\n    \r\n//     try {\r\n//       const { correct, total, score } = calculateScore();\r\n//       const timeSpent = Math.round((Date.now() - startTimeRef.current) / 1000);\r\n//       const token = localStorage.getItem('token');\r\n//       const deviceId = localStorage.getItem('deviceId');\r\n//       const userId = localStorage.getItem('userId') || 'anonymous';\r\n\r\n//       const submissionData = {\r\n//         studentId: userId,\r\n//         answers: answers.map((answer, index) => ({\r\n//           questionIndex: index,\r\n//           question: testData.questions[index].question,\r\n//           userAnswer: answer,\r\n//           correctAnswer: testData.questions[index].correctAnswer,\r\n//           isCorrect: answer.trim().toLowerCase() === testData.questions[index].correctAnswer.trim().toLowerCase()\r\n//         })),\r\n//         correctCount: correct,\r\n//         totalQuestions: total,\r\n//         score,\r\n//         timeSpent,\r\n//         lateJoinTime,\r\n//         violations,\r\n//         isAutoSubmit,\r\n//         autoSubmitReason: reason,\r\n//         submittedAt: new Date().toISOString()\r\n//       };\r\n\r\n//       const response = await fetch(`${API_URL}/student/tests/${testId}/submit`, {\r\n//         method: 'POST',\r\n//         headers: {\r\n//           'Authorization': token,\r\n//           'X-Device-Id': deviceId,\r\n//           'Content-Type': 'application/json'\r\n//         },\r\n//         body: JSON.stringify(submissionData)\r\n//       });\r\n\r\n//       if (!response.ok) {\r\n//         throw new Error(`Submission failed: ${response.status}`);\r\n//       }\r\n\r\n//       // Update performance data if API exists\r\n//       try {\r\n//         const performanceUpdate = {\r\n//           totalGames: 1,\r\n//           totalCorrect: correct,\r\n//           totalScore: score,\r\n//           gameType: testData.testType,\r\n//           difficulty: testData.difficultyLevel || 'medium',\r\n//           speed: 2,\r\n//           count: total\r\n//         };\r\n\r\n//         await fetch(`${API_URL}/performance/${userId}`, {\r\n//           method: 'POST',\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           },\r\n//           body: JSON.stringify(performanceUpdate)\r\n//         });\r\n//       } catch (perfError) {\r\n//         console.warn('Performance update failed:', perfError);\r\n//         // Continue even if performance update fails\r\n//       }\r\n\r\n//       // Notify admin via socket\r\n//       socket?.emit('test-submitted', {\r\n//         testId,\r\n//         studentId: userId,\r\n//         score,\r\n//         correctCount: correct,\r\n//         totalQuestions: total,\r\n//         isAutoSubmit,\r\n//         reason,\r\n//         timeSpent,\r\n//         violations: violations.length\r\n//       });\r\n\r\n//       setTestStatus('submitted');\r\n\r\n//       // Exit fullscreen\r\n//       if (document.fullscreenElement) {\r\n//         document.exitFullscreen();\r\n//       } else if (document.webkitFullscreenElement) {\r\n//         document.webkitExitFullscreen();\r\n//       } else if (document.msExitFullscreen) {\r\n//         document.msExitFullscreen();\r\n//       }\r\n\r\n//       // Call completion callback\r\n//       onTestComplete?.({\r\n//         score,\r\n//         correct,\r\n//         total,\r\n//         isAutoSubmit,\r\n//         reason,\r\n//         timeSpent,\r\n//         violations: violations.length\r\n//       });\r\n\r\n//     } catch (error) {\r\n//       console.error('Error submitting test:', error);\r\n      \r\n//       // Fallback: save to localStorage\r\n//       try {\r\n//         const { correct, total, score } = calculateScore();\r\n//         const fallbackData = {\r\n//           testId,\r\n//           score,\r\n//           correct,\r\n//           total,\r\n//           submittedAt: new Date().toISOString(),\r\n//           isAutoSubmit,\r\n//           reason\r\n//         };\r\n        \r\n//         const existingFallbacks = JSON.parse(localStorage.getItem('testSubmissionFallbacks') || '[]');\r\n//         existingFallbacks.push(fallbackData);\r\n//         localStorage.setItem('testSubmissionFallbacks', JSON.stringify(existingFallbacks));\r\n        \r\n//         console.log('Test saved to localStorage as fallback');\r\n//       } catch (localError) {\r\n//         console.error('Error saving fallback:', localError);\r\n//       }\r\n      \r\n//       setTestStatus('error');\r\n//     } finally {\r\n//       setIsSubmitting(false);\r\n//     }\r\n//   };\r\n\r\n//   const formatTime = (seconds) => {\r\n//     const mins = Math.floor(seconds / 60);\r\n//     const secs = seconds % 60;\r\n//     return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n//   };\r\n\r\n//   // Enhanced keyboard and mouse prevention\r\n//   useEffect(() => {\r\n//     const preventContextMenu = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         e.preventDefault();\r\n//         addViolation('Right-click attempt');\r\n//         return false;\r\n//       }\r\n//     };\r\n\r\n//     const preventKeyboardShortcuts = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         // Prevent common shortcuts\r\n//         if (e.ctrlKey || e.metaKey || e.altKey) {\r\n//           e.preventDefault();\r\n//           addViolation('Keyboard shortcut attempt');\r\n//           return false;\r\n//         }\r\n        \r\n//         // Prevent function keys\r\n//         if (e.key.startsWith('F') && e.key.length > 1) {\r\n//           e.preventDefault();\r\n//           addViolation('Function key attempt');\r\n//           return false;\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     const preventSelection = (e) => {\r\n//       if (testStatus === 'active') {\r\n//         e.preventDefault();\r\n//         return false;\r\n//       }\r\n//     };\r\n\r\n//     document.addEventListener('contextmenu', preventContextMenu);\r\n//     document.addEventListener('keydown', preventKeyboardShortcuts);\r\n//     document.addEventListener('selectstart', preventSelection);\r\n//     document.addEventListener('dragstart', preventSelection);\r\n\r\n//     return () => {\r\n//       document.removeEventListener('contextmenu', preventContextMenu);\r\n//       document.removeEventListener('keydown', preventKeyboardShortcuts);\r\n//       document.removeEventListener('selectstart', preventSelection);\r\n//       document.removeEventListener('dragstart', preventSelection);\r\n//     };\r\n//   }, [testStatus]);\r\n\r\n//   // Status screens\r\n//   if (testStatus === 'loading') {\r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n//         <div className=\"text-center\">\r\n//           <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n//           <h2 className=\"text-xl font-semibold text-gray-700\">Loading Test...</h2>\r\n//           <p className=\"text-gray-500\">Preparing your exam questions</p>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'no-test') {\r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\r\n//           <Clock className=\"h-16 w-16 text-blue-500 mx-auto mb-4\" />\r\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Not Found</h2>\r\n//           <p className=\"text-gray-500 mb-4\">The requested test could not be found or is not available.</p>\r\n//           <button \r\n//             onClick={() => window.history.back()} \r\n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//           >\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'test-ended') {\r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-yellow-50\">\r\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\r\n//           <AlertTriangle className=\"h-16 w-16 text-yellow-500 mx-auto mb-4\" />\r\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Time Expired</h2>\r\n//           <p className=\"text-gray-500 mb-4\">The time limit for this test has already passed.</p>\r\n//           <button \r\n//             onClick={() => window.history.back()} \r\n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//           >\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'already-submitted') {\r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-green-50\">\r\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\r\n//           <Send className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\r\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Already Submitted</h2>\r\n//           <p className=\"text-gray-500 mb-4\">You have already completed this test successfully.</p>\r\n//           <button \r\n//             onClick={() => window.history.back()} \r\n//             className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//           >\r\n//             Go Back\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'error') {\r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-red-50\">\r\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\r\n//           <AlertTriangle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\r\n//           <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">Test Error</h2>\r\n//           <p className=\"text-gray-500 mb-4\">Unable to load or submit the test. Please contact your teacher.</p>\r\n//           <div className=\"space-x-2\">\r\n//             <button \r\n//               onClick={() => window.location.reload()} \r\n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//             >\r\n//               Try Again\r\n//             </button>\r\n//             <button \r\n//               onClick={() => window.history.back()} \r\n//               className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\r\n//             >\r\n//               Go Back\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (testStatus === 'submitted') {\r\n//     const { correct, total, score } = calculateScore();\r\n    \r\n//     return (\r\n//       <div className=\"min-h-screen flex items-center justify-center bg-green-50\">\r\n//         <div className=\"text-center bg-white p-8 rounded-lg shadow-lg max-w-md\">\r\n//           <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n//             <Send className=\"h-8 w-8 text-green-600\" />\r\n//           </div>\r\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Submitted Successfully!</h2>\r\n//           <p className=\"text-gray-600 mb-6\">Your test has been submitted and saved.</p>\r\n          \r\n//           <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\r\n//             <div className=\"text-3xl font-bold text-blue-600 mb-2\">{score}%</div>\r\n//             <div className=\"text-sm text-gray-600\">\r\n//               {correct} out of {total} questions correct\r\n//             </div>\r\n//           </div>\r\n          \r\n//           {lateJoinTime > 0 && (\r\n//             <div className=\"bg-blue-50 border border-blue-200 rounded p-3 mb-4\">\r\n//               <p className=\"text-sm text-blue-800\">\r\n//                 You joined {Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')} late\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n          \r\n//           {violations.length > 0 && (\r\n//             <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\r\n//               <p className=\"text-sm text-yellow-800\">\r\n//                 Security violations recorded: {violations.length}\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n          \r\n//           <button\r\n//             onClick={() => window.history.back()}\r\n//             className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\r\n//           >\r\n//             Continue\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (!testData) return null;\r\n\r\n//   const currentQuestion = testData.questions[currentQuestionIndex];\r\n//   const progress = ((currentQuestionIndex + 1) / testData.questions.length) * 100;\r\n\r\n//   return (\r\n//     <div \r\n//       ref={testContainerRef}\r\n//       className=\"min-h-screen bg-gray-50 flex flex-col\"\r\n//       style={{ userSelect: 'none', WebkitUserSelect: 'none', MozUserSelect: 'none' }}\r\n//     >\r\n//       {/* Security Status Bar */}\r\n//       <div className=\"bg-red-600 text-white px-4 py-2 text-sm flex items-center justify-between\">\r\n//         <div className=\"flex items-center gap-2\">\r\n//           <Lock className=\"h-4 w-4\" />\r\n//           <span>EXAM MODE - Do not close window, switch tabs, or use keyboard shortcuts</span>\r\n//         </div>\r\n//         <div className=\"flex items-center gap-4\">\r\n//           {lateJoinTime > 0 && (\r\n//             <span className=\"bg-blue-800 px-2 py-1 rounded text-xs\">\r\n//               Late: +{Math.floor(lateJoinTime / 60)}:{(lateJoinTime % 60).toString().padStart(2, '0')}\r\n//             </span>\r\n//           )}\r\n//           {violations.length > 0 && (\r\n//             <span className=\"bg-red-800 px-2 py-1 rounded text-xs\">\r\n//               {violations.length} violation(s)\r\n//             </span>\r\n//           )}\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* Timer and Progress Header */}\r\n//       <div className=\"bg-white shadow-sm border-b px-6 py-4\">\r\n//         <div className=\"flex items-center justify-between\">\r\n//           <div>\r\n//             <h1 className=\"text-xl font-bold text-gray-800 flex items-center gap-2\">\r\n//               <Calculator className=\"h-5 w-5\" />\r\n//               {testData.testType.charAt(0).toUpperCase() + testData.testType.slice(1)} Test\r\n//               <span className=\"text-sm font-normal text-gray-500\">\r\n//                 ({testData.difficultyLevel})\r\n//               </span>\r\n//             </h1>\r\n//             <p className=\"text-sm text-gray-600\">\r\n//               Question {currentQuestionIndex + 1} of {testData.questions.length}\r\n//             </p>\r\n//           </div>\r\n          \r\n//           <div className=\"text-right\">\r\n//             <div className={`text-2xl font-bold ${\r\n//               timeRemaining < 60 ? 'text-red-600 animate-pulse' : \r\n//               timeRemaining < 300 ? 'text-orange-600' : 'text-blue-600'\r\n//             }`}>\r\n//               <Clock className=\"inline h-6 w-6 mr-2\" />\r\n//               {formatTime(timeRemaining)}\r\n//             </div>\r\n//             <p className=\"text-sm text-gray-500\">Time remaining</p>\r\n//           </div>\r\n//         </div>\r\n        \r\n//         {/* Progress Bar */}\r\n//         <div className=\"mt-4\">\r\n//           <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n//             <div \r\n//               className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n//               style={{ width: `${progress}%` }}\r\n//             ></div>\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* Question Content */}\r\n//       <div className=\"flex-1 flex items-center justify-center p-6\">\r\n//         <div className=\"bg-white rounded-lg shadow-lg p-8 w-full max-w-2xl\">\r\n//           <div className=\"mb-6\">\r\n//             <h2 className=\"text-3xl font-bold text-gray-800 mb-6 text-center\">\r\n//               {currentQuestion.question}\r\n//             </h2>\r\n            \r\n//             {/* Answer Input */}\r\n//             <div className=\"space-y-4\">\r\n//               {currentQuestion.options && currentQuestion.options.length > 0 ? (\r\n//                 // Multiple choice\r\n//                 <div className=\"space-y-3\">\r\n//                   {currentQuestion.options.map((option, index) => (\r\n//                     <label \r\n//                       key={index}\r\n//                       className=\"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50\"\r\n//                     >\r\n//                       <input\r\n//                         type=\"radio\"\r\n//                         name={`question-${currentQuestionIndex}`}\r\n//                         value={option}\r\n//                         checked={answers[currentQuestionIndex] === option}\r\n//                         onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\r\n//                         className=\"mr-3\"\r\n//                       />\r\n//                       <span className=\"text-lg\">{option}</span>\r\n//                     </label>\r\n//                   ))}\r\n//                 </div>\r\n//               ) : (\r\n//                 // Text input for math problems\r\n//                 <div>\r\n//                   <input\r\n//                     type=\"text\"\r\n//                     value={answers[currentQuestionIndex]}\r\n//                     onChange={(e) => handleAnswerChange(currentQuestionIndex, e.target.value)}\r\n//                     className=\"w-full p-6 text-2xl border-2 rounded-lg focus:border-blue-500 focus:outline-none text-center font-mono\"\r\n//                     placeholder=\"Enter your answer\"\r\n//                     autoFocus\r\n//                     onKeyPress={(e) => {\r\n//                       // Allow only numbers and basic math symbols\r\n//                       const allowedChars = /[0-9\\-+.]/;\r\n//                       if (!allowedChars.test(e.key) && e.key !== 'Backspace' && e.key !== 'Enter') {\r\n//                         e.preventDefault();\r\n//                       }\r\n//                       // Submit on Enter if it's the last question\r\n//                       if (e.key === 'Enter' && currentQuestionIndex === testData.questions.length - 1) {\r\n//                         submitTest(false);\r\n//                       }\r\n//                     }}\r\n//                   />\r\n//                   <p className=\"text-sm text-gray-500 mt-2 text-center\">\r\n//                     Enter numbers only. Press Enter to move to next question.\r\n//                   </p>\r\n//                 </div>\r\n//               )}\r\n//             </div>\r\n//           </div>\r\n\r\n//           {/* Navigation Buttons */}\r\n//           <div className=\"flex justify-between items-center\">\r\n//             <button\r\n//               onClick={() => setCurrentQuestionIndex(Math.max(0, currentQuestionIndex - 1))}\r\n//               disabled={currentQuestionIndex === 0}\r\n//               className=\"px-6 py-2 bg-gray-500 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600 transition-colors\"\r\n//             >\r\n//               Previous\r\n//             </button>\r\n\r\n//             <span className=\"text-gray-500\">\r\n//               {answers.filter(a => a.trim() !== '').length} of {testData.questions.length} answered\r\n//             </span>\r\n\r\n//             {currentQuestionIndex < testData.questions.length - 1 ? (\r\n//               <button\r\n//                 onClick={() => setCurrentQuestionIndex(currentQuestionIndex + 1)}\r\n//                 className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n//               >\r\n//                 Next\r\n//               </button>\r\n//             ) : (\r\n//               <button\r\n//                 onClick={() => submitTest(false)}\r\n//                 disabled={isSubmitting}\r\n//                 className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2 transition-colors\"\r\n//               >\r\n//                 {isSubmitting ? (\r\n//                   <>\r\n//                     <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\"></div>\r\n//                     Submitting...\r\n//                   </>\r\n//                 ) : (\r\n//                   <>\r\n//                     <Send className=\"h-4 w-4\" />\r\n//                     Submit Test\r\n//                   </>\r\n//                 )}\r\n//               </button>\r\n//             )}\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* Question Navigation Footer */}\r\n//       <div className=\"bg-white border-t px-6 py-4\">\r\n//         <div className=\"flex flex-wrap gap-2 justify-center\">\r\n//           {testData.questions.map((_, index) => (\r\n//             <button\r\n//               key={index}\r\n//               onClick={() => setCurrentQuestionIndex(index)}\r\n//               className={`w-10 h-10 rounded-full text-sm font-medium transition-colors ${\r\n//                 index === currentQuestionIndex\r\n//                   ? 'bg-blue-600 text-white'\r\n//                   : answers[index]?.trim()\r\n//                   ? 'bg-green-100 text-green-800 border border-green-300'\r\n//                   : 'bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200'\r\n//               }`}\r\n//             >\r\n//               {index + 1}\r\n//             </button>\r\n//           ))}\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* Warning Modal for Violations */}\r\n//       {violations.length > 0 && violations.length % 2 === 1 && (\r\n//         <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n//           <div className=\"bg-white rounded-lg p-6 max-w-md mx-4\">\r\n//             <div className=\"flex items-center gap-3 mb-4\">\r\n//               <AlertTriangle className=\"h-8 w-8 text-red-500\" />\r\n//               <h3 className=\"text-lg font-bold text-red-800\">Security Violation Detected</h3>\r\n//             </div>\r\n//             <p className=\"text-gray-700 mb-4\">\r\n//               You have attempted to leave the test environment or use prohibited features. \r\n//               This violation has been recorded.\r\n//             </p>\r\n//             <div className=\"bg-red-50 border border-red-200 rounded p-3 mb-4\">\r\n//               <p className=\"text-sm text-red-800\">\r\n//                 <strong>Latest Violation:</strong> {violations[violations.length - 1]?.type}\r\n//               </p>\r\n//               <p className=\"text-sm text-red-600 mt-1\">\r\n//                 Total violations: {violations.length}\r\n//               </p>\r\n//               {violations.length >= 2 && (\r\n//                 <p className=\"text-sm text-red-700 mt-2 font-semibold\">\r\n//                   Warning: One more violation will auto-submit your test!\r\n//                 </p>\r\n//               )}\r\n//             </div>\r\n//             <div className=\"text-right\">\r\n//               <button\r\n//                 onClick={() => {\r\n//                   // Modal will auto-close, violation is already recorded\r\n//                 }}\r\n//                 className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//               >\r\n//                 Continue Test\r\n//               </button>\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n//     </div>\r\n//   );\r\n// };\r\n\r\n// // Enhanced Test Container Component\r\n// // Fixed TestContainer component in StudentTestComponent.js\r\n\r\n// // Enhanced Test Container Component\r\n// const TestContainer = ({ studentId, socket }) => {\r\n//   const API_URL = 'http://localhost:5000/api';\r\n//   const [activeTest, setActiveTest] = useState(null);\r\n//   const [showTest, setShowTest] = useState(false);\r\n//   const [testResult, setTestResult] = useState(null);\r\n//   const [loading, setLoading] = useState(true);\r\n//   const [error, setError] = useState(null);\r\n\r\n//   // Check for active tests using your existing API structure\r\n//   useEffect(() => {\r\n//     const checkForActiveTests = async () => {\r\n//       try {\r\n//         setLoading(true);\r\n//         setError(null);\r\n        \r\n//         const token = localStorage.getItem('token');\r\n//         const deviceId = localStorage.getItem('deviceId');\r\n        \r\n//         if (!token) {\r\n//           console.log('No token found');\r\n//           setError('No authentication token found. Please log in again.');\r\n//           setLoading(false);\r\n//           return;\r\n//         }\r\n\r\n//         console.log('Checking for active tests...');\r\n//         console.log('Token:', token ? 'Present' : 'Missing');\r\n//         console.log('Device ID:', deviceId);\r\n\r\n//         // Check for active tests that target this student\r\n//         const response = await fetch(`${API_URL}/student/tests/active`, {\r\n//           method: 'GET',\r\n//           headers: {\r\n//             'Authorization': token,\r\n//             'X-Device-Id': deviceId,\r\n//             'Content-Type': 'application/json'\r\n//           }\r\n//         });\r\n\r\n//         console.log('Response status:', response.status);\r\n        \r\n//         if (!response.ok) {\r\n//           if (response.status === 401) {\r\n//             setError('Authentication failed. Please log in again.');\r\n//             return;\r\n//           } else if (response.status === 403) {\r\n//             setError('Access denied. Please contact your teacher.');\r\n//             return;\r\n//           }\r\n//           throw new Error(`Failed to fetch tests: ${response.status}`);\r\n//         }\r\n\r\n//         const tests = await response.json();\r\n//         console.log('Received tests:', tests);\r\n        \r\n//         if (tests && tests.length > 0) {\r\n//           // Filter tests that are actually active and not expired\r\n//           const currentTime = new Date();\r\n//           const availableTests = tests.filter(test => {\r\n//             const testStart = new Date(test.startTime);\r\n//             const testEnd = new Date(testStart.getTime() + (test.duration * 60 * 1000));\r\n            \r\n//             console.log('Test:', test._id);\r\n//             console.log('Current time:', currentTime);\r\n//             console.log('Test start:', testStart);\r\n//             console.log('Test end:', testEnd);\r\n//             console.log('Is active:', currentTime >= testStart && currentTime < testEnd);\r\n            \r\n//             return currentTime >= testStart && currentTime < testEnd;\r\n//           });\r\n          \r\n//           if (availableTests.length > 0) {\r\n//             console.log('Setting active test:', availableTests[0]);\r\n//             setActiveTest(availableTests[0]);\r\n//           } else {\r\n//             console.log('No available tests (all expired or not yet started)');\r\n//           }\r\n//         } else {\r\n//           console.log('No tests found');\r\n//         }\r\n//       } catch (error) {\r\n//         console.error('Error checking for active tests:', error);\r\n//         setError(`Error loading tests: ${error.message}`);\r\n//       } finally {\r\n//         setLoading(false);\r\n//       }\r\n//     };\r\n\r\n//     checkForActiveTests();\r\n\r\n//     // Check every 30 seconds for new tests\r\n//     const interval = setInterval(checkForActiveTests, 30000);\r\n//     return () => clearInterval(interval);\r\n//   }, [API_URL]);\r\n\r\n//   // Listen for test events from admin (if socket is available)\r\n//   useEffect(() => {\r\n//     if (socket) {\r\n//       const handleTestLaunched = (testData) => {\r\n//         console.log('Test launched event received:', testData);\r\n//         setActiveTest(testData);\r\n//       };\r\n\r\n//       const handleTestEnded = (data) => {\r\n//         console.log('Test ended event received:', data);\r\n//         if (activeTest && activeTest._id === data.testId) {\r\n//           setActiveTest(null);\r\n//           setShowTest(false);\r\n//         }\r\n//       };\r\n\r\n//       socket.on('test-launched', handleTestLaunched);\r\n//       socket.on('test-ended', handleTestEnded);\r\n\r\n//       return () => {\r\n//         socket.off('test-launched', handleTestLaunched);\r\n//         socket.off('test-ended', handleTestEnded);\r\n//       };\r\n//     }\r\n//   }, [socket, activeTest]);\r\n\r\n//   const handleStartTest = () => {\r\n//     console.log('Starting test:', activeTest);\r\n//     setShowTest(true);\r\n//   };\r\n\r\n//   const handleTestComplete = (result) => {\r\n//     console.log('Test completed:', result);\r\n//     setTestResult(result);\r\n//     setShowTest(false);\r\n//     setActiveTest(null);\r\n//   };\r\n\r\n//   if (loading) {\r\n//     return (\r\n//       <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n//         <div className=\"text-center\">\r\n//           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n//           <p className=\"text-gray-600\">Checking for active tests...</p>\r\n//           <p className=\"text-xs text-gray-400 mt-2\">This may take a moment</p>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (error) {\r\n//     return (\r\n//       <div className=\"min-h-screen bg-red-50 flex items-center justify-center\">\r\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\r\n//           <AlertTriangle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n//           <h2 className=\"text-xl font-bold text-gray-800 mb-2\">Error</h2>\r\n//           <p className=\"text-gray-600 mb-4\">{error}</p>\r\n//           <div className=\"space-x-2\">\r\n//             <button\r\n//               onClick={() => window.location.reload()}\r\n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//             >\r\n//               Retry\r\n//             </button>\r\n//             <button\r\n//               onClick={() => setError(null)}\r\n//               className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\r\n//             >\r\n//               Dismiss\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (showTest && activeTest) {\r\n//     return (\r\n//       <StudentTestComponent\r\n//         testId={activeTest._id || activeTest.id}\r\n//         onTestComplete={handleTestComplete}\r\n//         socket={socket}\r\n//       />\r\n//     );\r\n//   }\r\n\r\n//   if (testResult) {\r\n//     return (\r\n//       <div className=\"min-h-screen bg-green-50 flex items-center justify-center\">\r\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\r\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Test Complete!</h2>\r\n//           <div className=\"text-6xl font-bold text-blue-600 mb-4\">{testResult.score}%</div>\r\n//           <p className=\"text-gray-600 mb-6\">\r\n//             You answered {testResult.correct} out of {testResult.total} questions correctly.\r\n//           </p>\r\n//           {testResult.isAutoSubmit && (\r\n//             <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\r\n//               <p className=\"text-sm text-yellow-800\">\r\n//                 <strong>Note:</strong> Test was auto-submitted due to: {testResult.reason}\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n//           {testResult.violations > 0 && (\r\n//             <div className=\"bg-red-50 border border-red-200 rounded p-3 mb-4\">\r\n//               <p className=\"text-sm text-red-800\">\r\n//                 <strong>Security Violations:</strong> {testResult.violations} recorded\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n//           <button\r\n//             onClick={() => setTestResult(null)}\r\n//             className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\r\n//           >\r\n//             Continue\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   if (activeTest) {\r\n//     const now = new Date();\r\n//     const testStart = new Date(activeTest.startTime);\r\n//     const testEnd = new Date(testStart.getTime() + (activeTest.duration * 60 * 1000));\r\n//     const isTestTime = now >= testStart && now < testEnd;\r\n//     const isTestOver = now >= testEnd;\r\n    \r\n//     console.log('Active test found:', {\r\n//       testId: activeTest._id,\r\n//       now: now.toISOString(),\r\n//       start: testStart.toISOString(),\r\n//       end: testEnd.toISOString(),\r\n//       isTestTime,\r\n//       isTestOver\r\n//     });\r\n    \r\n//     if (isTestOver) {\r\n//       return (\r\n//         <div className=\"min-h-screen bg-red-50 flex items-center justify-center\">\r\n//           <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\r\n//             <AlertTriangle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\r\n//             <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Expired</h2>\r\n//             <p className=\"text-gray-600 mb-4\">\r\n//               The time limit for this test has passed.\r\n//             </p>\r\n//             <button \r\n//               onClick={() => setActiveTest(null)} \r\n//               className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//             >\r\n//               Continue\r\n//             </button>\r\n//           </div>\r\n//         </div>\r\n//       );\r\n//     }\r\n    \r\n//     return (\r\n//       <div className=\"min-h-screen bg-blue-50 flex items-center justify-center\">\r\n//         <div className=\"bg-white p-8 rounded-lg shadow-lg text-center max-w-md\">\r\n//           <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n//             <Calculator className=\"h-8 w-8 text-blue-600\" />\r\n//           </div>\r\n//           <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Test Available</h2>\r\n//           <p className=\"text-gray-600 mb-4\">\r\n//             {activeTest.testType.charAt(0).toUpperCase() + activeTest.testType.slice(1)} ‚Ä¢ {activeTest.duration} minutes ‚Ä¢ {activeTest.count} questions\r\n//           </p>\r\n//           <p className=\"text-sm text-gray-500 mb-4\">\r\n//             Difficulty: {activeTest.difficultyLevel}\r\n//           </p>\r\n          \r\n//           <div className=\"bg-blue-50 border border-blue-200 rounded p-3 mb-4\">\r\n//             <p className=\"text-sm text-blue-800\">\r\n//               <strong>Test ID:</strong> {activeTest._id}\r\n//             </p>\r\n//             <p className=\"text-sm text-blue-800\">\r\n//               <strong>Started:</strong> {testStart.toLocaleString()}\r\n//             </p>\r\n//           </div>\r\n          \r\n//           {isTestTime ? (\r\n//             <>\r\n//               <p className=\"text-sm text-gray-500 mb-6\">\r\n//                 Click below to start your test. Ensure you're in a quiet environment with stable internet.\r\n//               </p>\r\n//               <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4\">\r\n//                 <p className=\"text-sm text-yellow-800\">\r\n//                   <strong>Important:</strong> Test will run in fullscreen mode. Do not switch tabs or use keyboard shortcuts.\r\n//                 </p>\r\n//               </div>\r\n//               <button\r\n//                 onClick={handleStartTest}\r\n//                 className=\"bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 text-lg font-medium\"\r\n//               >\r\n//                 Start Test\r\n//               </button>\r\n//             </>\r\n//           ) : (\r\n//             <>\r\n//               <p className=\"text-sm text-gray-500 mb-4\">\r\n//                 Test starts at: {testStart.toLocaleString()}\r\n//               </p>\r\n//               <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3\">\r\n//                 <p className=\"text-sm text-yellow-800\">\r\n//                   Please wait for the scheduled start time.\r\n//                 </p>\r\n//               </div>\r\n//             </>\r\n//           )}\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   return (\r\n//     <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n//       <div className=\"text-center\">\r\n//         <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n//           <Clock className=\"h-8 w-8 text-gray-400\" />\r\n//         </div>\r\n//         <h2 className=\"text-xl text-gray-600\">No Active Tests</h2>\r\n//         <p className=\"text-gray-500 mt-2\">Check back later for new assignments.</p>\r\n        \r\n//         {/* Debug info */}\r\n//         <div className=\"mt-6 p-4 bg-gray-100 rounded text-xs text-left max-w-md\">\r\n//           <p><strong>Debug Info:</strong></p>\r\n//           <p>Token: {localStorage.getItem('token') ? 'Present' : 'Missing'}</p>\r\n//           <p>Device ID: {localStorage.getItem('deviceId') || 'Missing'}</p>\r\n//           <p>User ID: {localStorage.getItem('userId') || 'Missing'}</p>\r\n//           <p>Last checked: {new Date().toLocaleTimeString()}</p>\r\n//         </div>\r\n        \r\n//         <button\r\n//           onClick={() => window.location.reload()}\r\n//           className=\"mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n//         >\r\n//           Refresh\r\n//         </button>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// };\r\n\r\n// export default TestContainer;"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,KAAK,EAAEC,aAAa,EAAEC,IAAI,EAAEC,IAAI,EAAEC,UAAU,QAAQ,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE5E,MAAMC,oBAAoB,GAAGA,CAAC;EAAEC,MAAM;EAAEC,cAAc;EAAEC;AAAO,CAAC,KAAK;EAAAC,EAAA;EAAA,IAAAC,WAAA;EACnE,MAAMC,OAAO,GAAG,2BAA2B;EAE3C,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAC9C,MAAM,CAACqB,oBAAoB,EAAEC,uBAAuB,CAAC,GAAGtB,QAAQ,CAAC,CAAC,CAAC;EACnE,MAAM,CAACuB,OAAO,EAAEC,UAAU,CAAC,GAAGxB,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACyB,aAAa,EAAEC,gBAAgB,CAAC,GAAG1B,QAAQ,CAAC,CAAC,CAAC;EACrD,MAAM,CAAC2B,UAAU,EAAEC,aAAa,CAAC,GAAG5B,QAAQ,CAAC,SAAS,CAAC;EACvD,MAAM,CAAC6B,YAAY,EAAEC,eAAe,CAAC,GAAG9B,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAAC+B,UAAU,EAAEC,aAAa,CAAC,GAAGhC,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAACiC,YAAY,EAAEC,eAAe,CAAC,GAAGlC,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAACmC,YAAY,EAAEC,eAAe,CAAC,GAAGpC,QAAQ,CAAC,CAAC,CAAC;EAEnD,MAAMqC,gBAAgB,GAAGnC,MAAM,CAAC,IAAI,CAAC;EACrC,MAAMoC,YAAY,GAAGpC,MAAM,CAAC,IAAI,CAAC;EACjC,MAAMqC,QAAQ,GAAGrC,MAAM,CAAC,IAAI,CAAC;EAC7B,MAAMsC,oBAAoB,GAAGtC,MAAM,CAAC,IAAI,CAAC;;EAEzC;EACAD,SAAS,CAAC,MAAM;IACd,MAAMwC,UAAU,GAAGC,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC;IAClDF,UAAU,CAACG,WAAW,GAAG;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IACDF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,UAAU,CAAC;IAErC,OAAO,MAAM;MACXC,QAAQ,CAACG,IAAI,CAACE,WAAW,CAACN,UAAU,CAAC;IACvC,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMO,iBAAiB,GAAGA,CAACC,QAAQ,EAAEC,KAAK,EAAEC,eAAe,KAAK;IAC9D,MAAMC,SAAS,GAAG,EAAE;IAEpB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,KAAK,EAAEG,CAAC,EAAE,EAAE;MAC9B,IAAIC,QAAQ,EAAEC,aAAa;MAC3B,IAAIC,IAAI,EAAEC,IAAI;;MAEd;MACA,QAAQN,eAAe;QACrB,KAAK,MAAM;UACTK,IAAI,GAAGE,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC;UACzCH,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC;UACzC;QACF,KAAK,QAAQ;UACXJ,IAAI,GAAGE,IA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EAClC,CAAC;;EAED;EACA;;EAEA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACF,MAAMT,UAAU,GAAG,MAAAA,CAAOiB,YAAY,GAAG,KAAK,EAAEnB,MAAM,GAAG,EAAE,KAAK;IAC9D,IAAI7G,YAAY,EAAE;IAElBC,eAAe,CAAC,IAAI,CAAC;IAErB,IAAI;MAAA,IAAAgI,UAAA;MACF,MAAM;QAAEX,OAAO;QAAEC,KAAK;QAAEC;MAAM,CAAC,GAAGH,cAAc,CAAC,CAAC;MAClD,MAAMa,SAAS,GAAGzG,IAAI,CAACsG,KAAK,CAAC,CAAC7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG5C,YAAY,CAACiE,OAAO,IAAI,IAAI,CAAC;MACxE,MAAMnC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAC3C,MAAMC,QAAQ,GAAGF,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MACjD,MAAMmB,MAAM,GAAGpB,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,IAAI,WAAW;MAE5DO,OAAO,CAACkE,GAAG,CAAC,qBAAqB,EAAE;QAAE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AAEC,UAAU,EAAE;QAAW,CAAE;QAAA9B,QAAA,EACjN;MAED;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACqD,GAAA,CA9UID,aAAa;AAAAkC,GAAA,GAAblC,aAAa;AAgVnB,eAAeA,aAAa;;AAI5B;AACA;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA,IAAAD,EAAA,EAAAmC,GAAA;AAAAC,YAAA,CAAApC,EAAA;AAAAoC,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}